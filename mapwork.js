var mapwork=window.mapwork={};mapwork.ajaxtype=0;mapwork.actions={};mapwork.isIE=(navigator.userAgent.indexOf("MSIE")>=0)&&(navigator.userAgent.indexOf("Opera")<0);mapwork.IEVersion=0;if(mapwork.isIE){if(navigator.appName=="Microsoft Internet Explorer"){if(navigator.appVersion.match(/7./i)=="7."){mapwork.IEVersion=7}else{if(navigator.appVersion.match(/8./i)=="8."){mapwork.IEVersion=8}else{if(navigator.appVersion.match(/9./i)=="9."){mapwork.IEVersion=9}else{mapwork.IEVersion=6}}}}}mapwork.isIELess9=(navigator.userAgent.indexOf("MSIE")>=0)&&(navigator.userAgent.indexOf("Opera")<0);mapwork.isFirefox=navigator.userAgent.indexOf("Firefox")>=0;mapwork.isOpera=navigator.userAgent.indexOf("Opera")>=0;mapwork.supportSVG=document.createElementNS!=null;if(!mapwork.supportSVG){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var style=document.createStyleSheet();var VMLel=["line","stroke","path","polyline","fill","oval","shape"];for(var i=0,l=VMLel.length;i<l;i++){style.addRule("v\\:"+VMLel[i],"behavior: url(#default#VML);");style.addRule("v\\:"+VMLel[i],"antialias: true;")}}String.prototype.endsWith=function(str){if(str==null||str==""||this.length<str.length){return false}return(this.substring(this.length-str.length)==str)};String.prototype.startsWith=function(str){if(str==null||str==""||this.length<str.length){return false}return(this.substring(0,str.length)==str)};Array.remove=function(array,from,to){var rest=array.slice((to||from)+1||array.length);array.length=from<0?array.length+from:from;return array.push.apply(array,rest)};function printMap(printpage){window.print();return false}(function(){mapwork.version=1.7;mapwork.mapStyle1="sh1";mapwork.mapStyle2="sh2";mapwork.mapStyle=mapwork.mapStyle1;mapwork.serviceAddress0="http://127.0.0.1:80/";mapwork.serviceAddress1="http://172.16.0.119:8080/";mapwork.serviceAddress2="http://localhost:8080/";mapwork.serviceAddress3="/";mapwork.serviceAddress=mapwork.serviceAddress0;mapwork.configs={defaultLat:31.232156,defaultLon:121.470049,defaultZoom:15,"tileLayer_url":mapwork.serviceAddress+"gisserver/mt?v="+mapwork.version,"routeLayer_url":mapwork.serviceAddress+"gisserver/rr","searchLayer_url":mapwork.serviceAddress+"gisserver/ss","segmentQuery_url":mapwork.serviceAddress+"gisserver/bb",setAddress:function(address){mapwork.serviceAddress=address;mapwork.configs["tileLayer_url"]=mapwork.serviceAddress+"gisserver/mt?v="+mapwork.version;mapwork.configs["routeLayer_url"]=mapwork.serviceAddress+"gisserver/rr";mapwork.configs["searchLayer_url"]=mapwork.serviceAddress+"gisserver/ss",mapwork.configs["segmentQuery_url"]=mapwork.serviceAddress+"gisserver/bb"}}})();(function(){mapwork.Bounds=Bounds;var EXTEND=null;function Bounds(x1,y1,x2,y2){if(EXTEND){EXTEND.apply(this,arguments)}this.init(x1,y1,x2,y2)}Bounds.prototype={init:function(x1,y1,x2,y2){if(x1===undefined){this.setToNull()}else{if(x1<x2){this._minx=x1;this._maxx=x2}else{this._minx=x2;this._maxx=x1}if(y1<y2){this._miny=y1;this._maxy=y2}else{this._miny=y2;this._maxy=y1}}},setToNull:function(){this._minx=0;this._miny=0;this._maxx=-1;this._maxy=-1},isNull:function(){return this._maxx<this._minx},getWidth:function(){if(this.isNull()){return 0}else{return this._maxx-this._minx}},getHeight:function(){if(this.isNull()){return 0}else{return this._maxy-this._miny}},getMaxX:function(){return this._maxx},getMinX:function(){return this._minx},getMaxY:function(){return this._maxy},getMinY:function(){return this._miny},getCenterX:function(){return(this._minx+this._maxx)/2},getCenterY:function(){return(this._miny+this._maxy)/2},expandBy:function(distanceX,distanceY){if(this.isNull()){return}this._minx-=distanceX;this._miny-=distanceY;this._maxx+=distanceX;this._maxy+=distanceY;if(this._minx>this._maxx||this._miny>this._maxy){this.setToNull()}},expandToIncludePoint:function(x,y){if(this.isNull()){this._minx=x;this._miny=y;this._maxx=x;this._maxy=y}else{if(x<this._minx){this._minx=x}if(y<this._miny){this._miny=y}if(x>this._maxx){this._maxx=x}if(y>this._maxy){this._maxy=y}}},expandToIncludeBounds:function(bounds){if(this.isNull()){this._minx=bounds._minx;this._miny=bounds._miny;this._maxx=bounds._maxx;this._maxy=bounds._maxy}else{if(bounds._minx<this._minx){this._minx=bounds._minx}if(bounds._miny<this._miny){this._miny=bounds._miny}if(bounds._maxx>this._maxx){this._maxx=bounds._maxx}if(bounds._maxy>this._maxy){this._maxy=bounds._maxy}}},translate:function(transX,transY){if(this.isNull()){return}else{this.init(this._minx+transX,this._miny+transY,this._maxx+transX,this._maxy+transY)}},intersectBounds:function(bounds){if(this.isNull()||bounds.isNull()){return false}else{return bounds._minx<=this._maxx&&bounds._maxx>=this._minx&&bounds._miny<=this._maxy&&bounds._maxy>=this._miny}},intersectPoint:function(x,y){return x<=this._maxx&&x>=this._minx&&y<=this._maxy&&y>=this._miny},intersectRect:function(minX,minY,maxX,maxY){return this._minx<=maxX&&this._maxx>=minX&&this._miny<=maxY&&this._maxy>=minY},intersection:function(bounds){if(this.isNull()||bounds.isNull()||!this.intersectsBounds(bounds)){return new mapwork.Bounds(0,0,-1,-1)}else{var intMinX=this._minx<=bounds._minx?bounds._minx:this._minx;var intMinY=this._miny<=bounds._miny?bounds._miny:this._miny;var intMaxX=this._maxx>=bounds._maxx?bounds._maxx:this._maxx;var intMaxY=this._maxy>=bounds._maxy?bounds._maxy:this._maxy;return new mapwork.Bounds(intMinX,intMaxX,intMinY,intMaxY)}},overlapPoint:function(x,y){return this.intersectsPoint(x,y)},overlapBounds:function(bounds){return this.intersectsBounds(bounds)},containPoint:function(x,y){return x>=this._minx&&x<=this._maxx&&y>=this._miny&&y<=this._maxy},containBounds:function(bounds){if(this.isNull()||bounds.isNull()){return false}else{return bounds._minx>=this._minx&&bounds._maxx<=this._maxx&&bounds._miny>=this._miny&&bounds._maxy<=this._maxy}},equals:function(bounds){if(this.isNull()){return bounds.isNull()}else{return this._maxx==bounds.getMaxX()&&this._maxy==bounds.getMaxY()&&this._minx==bounds.getMinX()&&this._miny==bounds.getMinY()}},toString:function(){return"Bounds:("+this._minx+","+this._miny+" , "+this._maxx+","+this._maxy+")"}};if(EXTEND){mapwork.utils.inherits(Bounds,EXTEND)}})();(function(){function Base(){}mapwork.utils={inherits:function(subClass,superClass){var sub=subClass.prototype;Base.prototype=superClass.prototype;var sup=new Base();Base.prototype=null;for(prop in sub){sup[prop]=sub[prop]}subClass.prototype=sup;sup.constructor=subClass},extend:function(dest,src){for(var prop in src){dest[prop]=src[prop]}return dest},removeItem:function(array,item){var k=array.length;if(k<=0){return}while(k--){if(array[k]===item){array.splice(k,1);break}}},loadJsonData:function(url,listener,param){if(mapwork.ajaxtype==0){$.ajax({url:url,data:param,dataType:"json",cache:false,success:listener})}else{FlyJSONP.get({url:url,parameters:param,success:listener,error:function(errorMsg){}})}},loadXMLFile:function(url,listener,caller){$.ajax({url:url,dataType:"xml",cache:false,success:function(){listener.apply(caller,arguments)}})},getStyleWidth:function(control){var value=control.style.width;if(value.endsWith("px")){value=value.substring(0,value.length-2)}value=parseInt(value);return value},getStyleHeight:function(control){var value=control.style.height;if(value.endsWith("px")){value=value.substring(0,value.length-2)}value=parseInt(value);return value},getStyleTop:function(control){var value=control.style.top;if(value.endsWith("px")){value=value.substring(0,value.length-2)}value=parseInt(value);return value},getStyleLeft:function(control){var value=control.style.left;if(value.endsWith("px")){value=value.substring(0,value.length-2)}value=parseInt(value);return value},bindEvent:function(elementTarget,eventType,func){if(window.addEventListener){elementTarget.addEventListener(eventType,func,false)}else{if(window.attachEvent){elementTarget.attachEvent("on"+eventType,func)}}},unbindEvent:function(elementTarget,eventType,func){if(window.addEventListener){elementTarget.removeEventListener(eventType,func,false)}else{if(window.attachEvent){elementTarget.detachEvent("on"+eventType,func)}}},getWindowWidth:function(){var myWidth=0;if(typeof(window.innerWidth)=="number"){myWidth=window.innerWidth}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){myWidth=document.documentElement.clientWidth}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){myWidth=document.body.clientWidth}}}return myWidth},getWindowHeight:function(){var myHeight=0;if(typeof(window.innerHeight)=="number"){myHeight=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){myHeight=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){myHeight=document.body.clientHeight}}}return myHeight},getPageX:function(event){if(event.pageX||event.pageY){return event.pageX}else{return event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}},getPageY:function(event){if(event.pageX||event.pageY){return event.pageY}else{return event.clientY+document.body.scrollTop+document.documentElement.scrollTop}},getMapLayerX:function(event,mapLocation){if(mapwork.isIE){return event.x}else{return event.clientX-mapLocation._map._div.offsetLeft}},getMapLayerY:function(event,mapLocation){if(mapwork.isIE){return event.y}else{return event.clientY-mapLocation._map._div.offsetTop}},getOffset:function(event){var target=event.target;if(target.offsetLeft==undefined){target=target.parentNode}var pageCoord=getPageCoord(target);var eventCoord={x:window.pageXOffset+event.clientX,y:window.pageYOffset+event.clientY};var offset={offsetX:eventCoord.x-pageCoord.x,offsetY:eventCoord.y-pageCoord.y};return offset},getClientSize:function(){if(window.innerHeight){return{width:window.innerWidth,height:window.innerHeight}}else{if(document.documentElement&&document.documentElement.clientHeight){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}else{return{width:document.body.clientWidth,height:document.body.clientHeight}}}},getFitZoom:function(tileEdgeLen){var maxZoom=mapwork.MapLocation.LIMIT_MAX_ZOOM;var minZoom=mapwork.MapLocation.LIMIT_MIN_ZOOM;for(var i=maxZoom;i>=minZoom;i--){var zoomTileLen=Math.pow(2,8+i);if(tileEdgeLen>zoomTileLen){return i}}return minZoom}};function getPageCoord(element){var coord={x:0,y:0};while(element){coord.x+=element.offsetLeft;coord.y+=element.offsetTop;element=element.offsetParent}return coord}})();(function(){var ARC=Math.PI/180;mapwork.gisUtils={getMeterLength:function(ePosA,ePosB){var c=ePosA.getDLat()*ARC;var d=ePosA.getDLon()*ARC;var e=ePosB.getDLat()*ARC;var f=ePosB.getDLon()*ARC;var g=c-e;var h=d-f;var i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(g/2),2)+Math.cos(c)*Math.cos(e)*Math.pow(Math.sin(h/2),2)));return i*6378137},getDisplayLength:function(meterLen){if(meterLen>=1000){return(meterLen/1000).toFixed(2)+" 公里"}else{return meterLen.toFixed(2)+" 米"}}}})();(function(){mapwork.EarthPos=EarthPos;EarthPos.MAX_LAT=850511287;EarthPos.MIN_LAT=-850511287;EarthPos.SCALE_FACTOR=10000000;function EarthPos(lat,lon,isInt7){if(isInt7){this._latitude=lat;this._longitude=lon}else{this._latitude=Math.round(lat*EarthPos.SCALE_FACTOR);this._longitude=Math.round(lon*EarthPos.SCALE_FACTOR)}}EarthPos.prototype={getILat:function(){return this._latitude},getILon:function(){return this._longitude},getDLat:function(){return 1*this._latitude/EarthPos.SCALE_FACTOR},getDLon:function(){return 1*this._longitude/EarthPos.SCALE_FACTOR},convert2GlobalPos:function(){var posX,posY;posX=(1*this._longitude/EarthPos.SCALE_FACTOR+180)/360;posY=Math.log(Math.tan((1*this._latitude/EarthPos.SCALE_FACTOR+90)*Math.PI/360));posY=0.5-posY/2/Math.PI;return new mapwork.GlobalPos(posX,posY)},getLatLonString:function(){return this.getDLat()+","+this.getDLon()},equals:function(ePos){return this._latitide==ePos._latitide&&this._longitude===ePos._longitude},toString:function(){return"EarthPos:["+this._latitude+","+this._longitude+"]"}}})();(function(){mapwork.GlobalPos=GlobalPos;function GlobalPos(posX,posY){this.posX=posX;this.posY=posY}GlobalPos.prototype={getPosX:function(){return this.posX},getPosY:function(){return this.posY},convert2EarthPos:function(){var lat,lon;if(this._posY<0||this._posY>1){return null}lon=this.posX*360-Math.floor(this.posX)*360-180;if(this.posX==1){lon=180}lat=(0.5-this.posY)*2*Math.PI;lat=Math.atan(Math.exp(lat))/Math.PI*360-90;return new mapwork.EarthPos(lat,lon,false)},toString:function(){return"GlobalPos:["+this.posX+","+this.posY+"]"}}})();(function(){mapwork.SpriteImage=SpriteImage;var EXTEND=null;function SpriteImage(imageUrl,width,height,offsetX,offsetY){if(EXTEND){EXTEND.apply(this,arguments)}this._imageUrl=imageUrl;this._width=width;this._height=height;this._offsetX=offsetX;this._offsetY=offsetY}SpriteImage.prototype={wrapImage:function(image){image.src="images/transparent.png";image.style.width=this._width+"px";image.style.height=this._height+"px";image.style.background="url("+this._imageUrl+") no-repeat "+this._offsetX+"px "+this._offsetY+"px"},setOffset:function(offsetX,offsetY){this._offsetX=offsetX;this._offsetY=offsetY}};if(EXTEND){mapwork.utils.inherits(SpriteImage,EXTEND)}})();(function(){var _mKilometers="\u516c\u91cc";var _mMiles="\u82f1\u91cc";var _mMeters="\u7c73";var _mFeet="\u82f1\u5c3a";var arc=Math.PI/180;function round125(a){var b=a,c=0;if(b>1){while(b>=10){b=b/10;c=c+1}if(b>=5){b=5}else{if(b>=2){b=2}else{b=1}}while(c>0){b=b*10;c=c-1}}return b}function vd(a,b){var c=a.getDLat()*arc,d=a.getDLon()*arc,e=b.getDLat()*arc,f=b.getDLon()*arc,g=c-e,h=d-f,i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(g/2),2)+Math.cos(c)*Math.cos(e)*Math.pow(Math.sin(h/2),2)));return 6378137*i}mapwork.MapRulerBuilder={getOffsetLon4RangeLength:function(ePos,rangeLength){if(!ePos||rangeLength<=0){return null}var L1=Math.sin(1*rangeLength/6378137/2);var L2=L1*L1;var c=Math.cos(ePos.getDLat()*arc);var c2=c*c;var h=Math.asin(Math.sqrt(L2/c2))*2;var offLon=parseInt(10000000*h/arc+0.5);return offLon},createMapRuler:function(globalPos,zoom,edgeLen,maxLength){if(!globalPos){return null}if(!edgeLen){if(zoom||zoom==0){edgeLen=1<<(8+zoom)}else{return null}}var GlobalPos1=new mapwork.GlobalPos(globalPos.posX-maxLength/2/edgeLen,globalPos.posY);var GlobalPos2=new mapwork.GlobalPos(globalPos.posX+maxLength/2/edgeLen,globalPos.posY);var earthPos1=GlobalPos1.convert2EarthPos();var earthPos2=GlobalPos2.convert2EarthPos();return this.decideScale(earthPos1,earthPos2,maxLength)},decideScale:function(earthPos1,earthPos2,maxLength){if(earthPos1==null||earthPos2==null){return null}var c=vd(earthPos1,earthPos2);var d=round125(c);if(d<1){return null}var metricText,metricLength,g,meters=0;if(d>=1000){g=round125(c/1000);metricLength=Math.round(maxLength*g/(c/1000));metricText=parseInt(g)+" "+_mKilometers;meters=g*1000}else{metricLength=Math.round(maxLength*d/c);metricText=parseInt(d)+" "+_mMeters;meters=d}var h=c/1609.344,i=c*3.28084,fpsLength,fpsText,q,o;if(h>=1){q=round125(h);fpsLength=Math.round(maxLength*q/h);fpsText=parseInt(q)+" "+_mMiles}else{o=round125(i);fpsLength=Math.round(maxLength*o/i);fpsText=parseInt(o)+" "+_mFeet}return{fpsLength:fpsLength,metricLength:metricLength,fpsText:fpsText,metricText:metricText,meters:meters}}}})();(function(){var ePos0=new mapwork.EarthPos(312354340,1214671520,true);var gPos0=ePos0.convert2GlobalPos();mapwork.SHPosMapping={convertShPosToGlobalPos:function(x,y){x-=660606.640282;var gPosX=x/34280000+gPos0.posX;y=477300.294757-y;var gPosY=-y/34190000+gPos0.posY;return new mapwork.GlobalPos(gPosX,gPosY)},convertShPosToEarthPos:function(x,y){x-=660606.640282;var gPosX=x/34280000+gPos0.posX;y=477300.294757-y;var gPosY=-y/34190000+gPos0.posY;var gPos=new mapwork.GlobalPos(gPosX,gPosY);return gPos.convert2EarthPos()}}})();(function(){mapwork.Layer=Layer;var EXTEND=null;function Layer(layerId){if(EXTEND){EXTEND.apply(this,arguments)}this._layerId=layerId;this._div=document.createElement("div");if(typeof layerId==="string"){this._div.className=layerId}this._div.style.position="absolute"}Layer.prototype={getLayerId:function(){return this._layerId},setMap:function(map){this._map=map},getMap:function(){return this._map},getDiv:function(){return this._div},getClassName:function(){return this._div.className},setClassName:function(newClassName){this._div.className=newClassName},destroy:function(){},setLayerContainer:function(layerContainer){this._layerContainer=layerContainer},initLayer:function(){},draggedLayer:function(){},resizeLayer:function(){},changedLayerZoom:function(){}};if(EXTEND){mapwork.utils.inherits(Layer,EXTEND)}})();(function(){mapwork.eventBase={addListener:function(type,listener){this.getListeners(type).push(listener)},removeListener:function(type,listener){var listeners=getListeners(type);mapwork.utils.removeItem(listeners,listener)},fireEvent:function(type){var listeners=this.getListeners(type);for(var k in listeners){listeners[k].apply(this,arguments)}},getListeners:function(type){type=type.toLowerCase();if(!this._listeners){this._listeners={}}if(!this._listeners[type]){this._listeners[type]=[]}return this._listeners[type]}}})();(function(){mapwork.WebFrame=WebFrame;var EXTEND=null;function WebFrame(){if(EXTEND){EXTEND.apply(this,arguments)}}WebFrame.prototype={initFrame:function(){this._c=document.getElementById("c");this._n=document.getElementById("n");this._w=document.getElementById("w");this._e=document.getElementById("e");this._s=document.getElementById("s");this._w_hsp=document.getElementById("w_hsp");this._e_hsp=document.getElementById("e_hsp");this._dd=document.getElementById("dd");this._w_hsp.style.display=this._w.style.display;this._e_hsp.style.display=this._e.style.display;this._w_hsp.style.left=(this._w.offsetWidth+2)+"px";this._e_hsp.style.right=(this._e.offsetWidth)+"px";var self=this;var resetWindow=function(){self.resetSize()};window.onload=resetWindow;window.onresize=resetWindow;var mouseDownListener=function(event){onMouseDown.apply(self,arguments)};mapwork.utils.bindEvent(this._w_hsp,"mousedown",mouseDownListener);mapwork.utils.bindEvent(this._e_hsp,"mousedown",mouseDownListener)},isEnableW:function(){return this._w.style.display!="none"},disableW:function(){this._w.style.display="none";this._w_hsp.style.display="none";this.resetSize()},enableW:function(width){if(width){this._w.style.width=width+"px"}this._w.style.display="block";this._w_hsp.style.left=(this._w.offsetWidth+2)+"px";this._w_hsp.style.display="block";this.resetSize()},isEnableE:function(){return this._e.style.display!="none"},disableE:function(){this._e.style.display="none";this._e_hsp.style.display="none";this.resetSize()},enableE:function(width){if(width){this._e.style.width=width+"px"}this._e.style.display="block";this._e_hsp.style.right=this._e.offsetWidth+"px";this._e_hsp.style.display="block";this.resetSize()},resetSize:function(){var cOffsetTop=this._c.offsetTop;var marginLeft=0;if(this._w.style.display!="none"){marginLeft=this._w.offsetWidth;if(this._w_hsp.offsetWidth>0){marginLeft=this._w.offsetWidth+this._w_hsp.offsetWidth+2}}this._c.style["marginLeft"]=marginLeft+"px";var marginRight=0;if(this._e.style.display!="none"){marginRight=this._e.offsetWidth+this._e_hsp.offsetWidth+2}this._c.style["marginRight"]=marginRight+"px";var newHeight=mapwork.utils.getWindowHeight()-cOffsetTop-this._s.offsetHeight;this._w.style.height=newHeight+"px";this._e.style.height=newHeight+"px";this._c.style.height=newHeight+"px";this._w_hsp.style.height=newHeight+"px";this._e_hsp.style.height=newHeight+"px";this.onWindowResize()},onWindowResize:function(){}};function onMouseDown(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var webFrame=this;var dragDiv=webFrame._dd;var split=event.target;if(!split){split=event.srcElement}var offsetSplit=event.clientX-split.offsetLeft;dragDiv.style.left=split.offsetLeft+"px";dragDiv.style.top=split.offsetTop+"px";dragDiv.style.width=split.offsetWidth+"px";dragDiv.style.height=split.offsetHeight+"px";dragDiv.style.display="block";document.body.style.cursor="ew-resize";var documentWidth=document.width;function onMouseMove(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var xx=event.clientX-offsetSplit;if(xx>documentWidth){xx=documentWidth}dragDiv.style.left=xx+"px"}function onMouseUp(event){var xx;if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}if(split.id=="w_hsp"){xx=event.clientX-offsetSplit-2;webFrame.enableW(xx)}else{if(split.id=="e_hsp"){xx=event.clientX-offsetSplit+2+split.offsetWidth;xx=window.innerWidth-xx;webFrame.enableE(xx)}}document.body.style.cursor="default";mapwork.utils.unbindEvent(document,"mousemove",onMouseMove);mapwork.utils.unbindEvent(document,"mouseup",onMouseUp);dragDiv.style.display="none"}mapwork.utils.bindEvent(document,"mousemove",onMouseMove);mapwork.utils.bindEvent(document,"mouseup",onMouseUp)}if(EXTEND){mapwork.utils.inherits(WebFrame,EXTEND)}})();(function(){mapwork.WebPanel=WebPanel;var EXTEND=null;function WebPanel(){if(EXTEND){EXTEND.apply(this,arguments)}}WebPanel.prototype={initFrame:function(){var self=this;var resetWindow=function(){self.resetSize()};window.onload=resetWindow;window.onresize=resetWindow},resetSize:function(){this.onWindowResize()},onWindowResize:function(){}};if(EXTEND){mapwork.utils.inherits(WebPanel,EXTEND)}})();(function(){var CACHE_SIZE=64,cacheIndex=0,cacheNum=0,cacheImages={},cacheUrlArray=[CACHE_SIZE];mapwork.TileImageCache={getImage:function(url){return cacheImages[url]},cacheImage:function(url,image){if(cacheNum<CACHE_SIZE){cacheImages[url]=image;cacheUrlArray[cacheIndex]=url;cacheNum++}else{var bakUrl=cacheUrlArray[cacheIndex];delete cacheImages[bakUrl];cacheUrlArray[cacheIndex]=url;cacheImages[url]=image}cacheIndex++;if(cacheIndex>=CACHE_SIZE){cacheIndex=0}}}})();(function(){var imageTileStore=[],mapTileStore=[];mapwork.TileStore={getImageTile:function(){var tile=imageTileStore.pop();if(tile){return tile}else{var newTile=new mapwork.ImageTile();return newTile}},returnImageTile:function(tile){if(tile){imageTileStore.push(tile)}},getImageTileCount:function(){return imageTileStore.length},getMapTile:function(){var tile=mapTileStore.pop();if(tile){return tile}else{var newTile=new mapwork.MapTile();return newTile}},returnMapTile:function(tile){if(tile){mapTileStore.push(tile)}},getMapTileCount:function(){return mapTileStore.length}}})();(function(){mapwork.ImageTile=ImageTile;var EXTEND=null;function ImageTile(){if(EXTEND){EXTEND.apply(this,arguments)}this._layer=null;this._tileX=0;this._tileY=0;this._zoom=0;this._queued=false;this._loading=false;this._drawn=false;this._loadImage=true;if(this._loadImage){this._image=document.createElement("img");this._image.style.position="absolute";this._image.style.width="256px";this._image.style.height="256px";this._image.style["-moz-user-select"]="none";this._image.style["-webkit-user-select"]="none"}else{this._canvas=document.createElement("canvas");if(this._canvas&&this._canvas.getContext){this._context=this._canvas.getContext("2d")}this._canvas.style.position="absolute";this._canvas.style.width="256px";this._canvas.style.height="256px";this._canvas.width="256";this._canvas.height="256"}}ImageTile.prototype={addToLayer:function(layer,tileX,tileY,zoom,left,top){this._layer=layer;this._tileX=tileX;this._tileY=tileY;this._zoom=zoom;if(this._loadImage){layer.getDiv().appendChild(this._image)}else{layer.getDiv().appendChild(this._canvas)}this.moveTo(left,top)},offsetPos:function(offsetX,offsetY){this.moveTo(this._left+offsetX,this._top+offsetY)},moveTo:function(left,top){this._left=left;this._top=top;if(this._loadImage){this._image.style.left=(left)+"px";this._image.style.top=(top)+"px"}else{this._canvas.style.left=(left)+"px";this._canvas.style.top=(top)+"px"}},destroy:function(){this.clear();if(this._layer){this._layer=null}mapwork.TileStore.returnImageTile(this)},draw:function(){if(this._loadImage){var imageSrc=this._layer.makeTileUrl(this._tileX,this._tileY,this._zoom);if(!imageSrc){imageSrc="mapwork/images/empty.png"}var tileX=this._tileX;var tileY=this._tileY;var tile=this;this._image.onload=function(event){if(tile._tileX==tileX&&tile._tileY==tileY){tile._image.style.display="block"}};this._image.onerror=function(event){if(tile._tileX==tileX&&tile._tileY==tileY){}};try{this._image.src=imageSrc}catch(e){}}else{this._context.fillStyle="#000";this._context.clearRect(0,0,256,256);this._context.fillText(this._tileX+" "+this._tileY,30,30);this._context.strokeRect(2,2,252,252);this._canvas.style.display="block"}},clear:function(){if(this._loadImage){this._image.style.display="none";this._layer.getDiv().removeChild(this._image)}else{this._canvas.style.display="none";this._layer.getDiv().removeChild(this._canvas)}}};if(EXTEND){mapwork.utils.inherits(ImageTile,EXTEND)}})();(function(){mapwork.MapEvent=MapEvent;MapEvent.RESIZE="mapwork.mapresize";MapEvent.DRAGSTATUS_CHANGE="mapwork.dragstatuschange";MapEvent.LUKUANGSTATUS_CHANGE="mapwork.lukuangstatuschange";MapEvent.MOVING="mapwork.mapmoving";MapEvent.MOVE_END="mapwork.mapmoveend";MapEvent.ZOOM_END="mapwork.mapzoomend";MapEvent.TRACKLOAD_END="mapwork.trackloadend";MapEvent.FOCUSTRACKPOINT_CHANGED="mapwork.focustrackpointchanged";MapEvent.FOCUSTRACKUSER_CHANGED="mapwork.focustrackuserchanged";function MapEvent(){}})();(function(){mapwork.MapLocation=MapLocation;MapLocation.LIMIT_MAX_ZOOM=18;MapLocation.LIMIT_MIN_ZOOM=7;var EXTEND=null;function MapLocation(map,lat,lon,zoom){if(EXTEND){EXTEND.apply(this,arguments)}this._centerTileEdgeX=0;this._centerTileEdgeY=0;lat=lat||mapwork.configs.defaultLat;lon=lon||mapwork.configs.defaultLon;zoom=zoom||mapwork.configs.defaultZoom;this._maxZoom=MapLocation.LIMIT_MAX_ZOOM;this._minZoom=MapLocation.LIMIT_MIN_ZOOM;this._map=map;this._mapCenterEPos=new mapwork.EarthPos(lat,lon);this._mapCenterGPos=this._mapCenterEPos.convert2GlobalPos();this._zoom=zoom;if(zoom>MapLocation.LIMIT_MAX_ZOOM){this._zoom=MapLocation.LIMIT_MAX_ZOOM}else{if(zoom<MapLocation.LIMIT_MIN_ZOOM){this._zoom=MapLocation.LIMIT_MIN_ZOOM}}this._edgeNum=Math.pow(2,this._zoom);this._edgeLen=this._edgeNum*256;this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX;this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY}MapLocation.prototype={getCenterTileX:function(){return parseInt(this._centerTileEdgeX)},getCenterTileY:function(){return parseInt(this._centerTileEdgeY)},getLatitude:function(){return this._mapCenterEPos.getDLat()},getLongitude:function(){return this._mapCenterEPos.getDLon()},_movingMapCenterGlobalPos:function(gPos){this._mapCenterGPos=gPos;this._mapCenterEPos=this._mapCenterGPos.convert2EarthPos();this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX;this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY;this._map.fireEvent(mapwork.MapEvent.MOVING,this._map)},_movedToMapCenterGlobalPos:function(gPos){this._mapCenterGPos=gPos;this._mapCenterEPos=this._mapCenterGPos.convert2EarthPos();this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX;this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY;this._map.fireEvent(mapwork.MapEvent.MOVE_END,this._map)},_zoomToMapCenter:function(pos,zoom){if(!this.isValidZoom(zoom)){return}var gPos,ePos;if(pos instanceof mapwork.GlobalPos){gPos=pos;ePos=gPos.convert2EarthPos()}else{if(pos instanceof mapwork.EarthPos){ePos=pos;gPos=ePos.convert2GlobalPos()}else{return}}this._zoom=zoom;this._edgeNum=Math.pow(2,this._zoom);this._edgeLen=this._edgeNum*256;this._mapCenterGPos=gPos;this._mapCenterEPos=ePos;this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX;this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY;this._map.fireEvent(mapwork.MapEvent.ZOOM_END,this._map)},setZoom:function(zoom){if(!this.isValidZoom(zoom)){return}if(this._zoom===zoom){return}this._zoom=zoom;this._edgeNum=Math.pow(2,this._zoom);this._edgeLen=this._edgeNum*256;this._centerTileEdgeX=this._edgeNum*this._mapCenterGPos.posX;this._centerTileEdgeY=this._edgeNum*this._mapCenterGPos.posY;this._map.fireEvent(mapwork.MapEvent.ZOOM_END,this._map)},offsetZoom:function(zoomOffset){this.setZoom(this._zoom+zoomOffset)},getWindowLeftTopGlobalPos:function(){var gx=this._mapCenterGPos.posX-this._map._size.width/2/this._edgeLen;var gy=this._mapCenterGPos.posY-this._map._size.height/2/this._edgeLen;return new mapwork.GlobalPos(gx,gy)},getWindowRightBottomGlobalPos:function(){var gx=this._mapCenterGPos.posX+this._map._size.width/2/this._edgeLen;var gy=this._mapCenterGPos.posY+this._map._size.height/2/this._edgeLen;return new mapwork.GlobalPos(gx,gy)},isValidZoom:function(zoom){if(zoom<this._minZoom){return false}else{if(zoom>this._maxZoom){return false}}return true},getCenterTileEdgeX:function(){return this._centerTileEdgeX},getCenterTileEdgeY:function(){return this._centerTileEdgeY},getMapCenterGlobalPos:function(){return this._mapCenterGPos},getMapCenterEarthPos:function(){return this._mapCenterEPos},getGlobalPosFromMapPos:function(offsetPixelX,offsetPixelY){var gx=(offsetPixelX-this._map._size.width/2)/this._edgeLen+this._mapCenterGPos.posX;var gy=(offsetPixelY-this._map._size.height/2)/this._edgeLen+this._mapCenterGPos.posY;return new mapwork.GlobalPos(gx,gy)},getMapPosFromGlobalPos:function(gPos){var posX=(gPos.posX-this._mapCenterGPos.posX)*this._edgeLen+this._map._size.width/2;var posY=(gPos.posY-this._mapCenterGPos.posY)*this._edgeLen+this._map._size.height/2;return[posX,posY]},getEarthPosFromMapPos:function(offsetPixelX,offsetPixelY){var gPos=this.getGlobalPosFromMapPos(offsetPixelX,offsetPixelY);var ePos=gPos.convert2EarthPos();return ePos},getZoom:function(){return this._zoom},getEdgeNum:function(){return this._edgeNum},getEdgeLen:function(){return this._edgeLen},getMap:function(){return this._map},getCenterTileId:function(){return this.getCenterTileX()+","+this.getCenterTileY()+","+this.getZoom()},getWindowBounds:function(){var ltGPos=this.getWindowLeftTopGlobalPos();var rbGPos=this.getWindowRightBottomGlobalPos();var ltEPos=ltGPos.convert2EarthPos();var rbEPos=rbGPos.convert2EarthPos();var lon1=ltEPos.getILon();var lon2=rbEPos.getILon();if(lon2<lon1&&lon2<0){lon2=180000000}var arr=[ltEPos.getILat(),lon1,rbEPos.getILat(),lon2];return arr},getWindowGlobalPosBounds:function(){var offsetX=this._map._size.width/2/this._edgeLen;var offsetY=this._map._size.height/2/this._edgeLen;var gx1=this._mapCenterGPos.posX-offsetX;var gy1=this._mapCenterGPos.posY-offsetY;var gx2=this._mapCenterGPos.posX+offsetX;var gy2=this._mapCenterGPos.posY+offsetY;return new mapwork.Bounds(gx1,gy1,gx2,gy2)},getWindowPixelBounds:function(){var centerPixelX=this._edgeLen*this._mapCenterGPos.posX;var centerPixelY=this._edgeLen*this._mapCenterGPos.posY;var x1=centerPixelX-this._map._size.width/2;var x2=centerPixelX+this._map._size.width/2;var y1=centerPixelY-this._map._size.height/2;var y2=centerPixelY+this._map._size.height/2;return new mapwork.Bounds(x1,y1,x2,y2)},getPageX:function(event){if(mapwork.isIE&&mapwork.IEVersion<9){return event.x}else{return event.clientX-this._map._div.offsetLeft}},getPageY:function(event){if(mapwork.isIE&&mapwork.IEVersion<9){return event.y}else{return event.clientY-this._map._div.offsetTop}}};if(EXTEND){mapwork.utils.inherits(MapLocation,EXTEND)}})();(function(){mapwork.LayerContainer=LayerContainer;var EXTEND=mapwork.Layer;var utils=mapwork.utils;function LayerContainer(map){if(EXTEND){EXTEND.apply(this,arguments)}this._layerId="LayerContainer";this._basePos=null;this._initMapY=0;this._layers={};this._map=map;this._mapLocation=map.getMapLocation();this._div.style.position="absolute";this._div.id="layerContainer";this._layerOffsetPos=[0,0];this._div.style.left=this._layerOffsetPos[0]+"px";this._div.style.top=this._layerOffsetPos[1]+"px";this.initMapSize=false;this.initMapEvent();this.addLayer(new mapwork.TileLayer());this.addLayer(new mapwork.MapVectorLayer());this.addLayer(new mapwork.MapShadowLayer());this.addLayer(new mapwork.MapIconLayer());this.addLayer(new mapwork.MapLabelLayer());this.addLayer(new mapwork.MapPopLayer());this.addLayer(new mapwork.MapTipLayer())}LayerContainer.prototype={getLayerOffsetPos:function(){return this._layerOffsetPos},initMapEvent:function(){this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onMapResize,this);this._map.addEventListener(mapwork.MapEvent.MOVING,this.onMapMoving,this);this._map.addEventListener(mapwork.MapEvent.MOVE_END,this.onMapMoved,this);this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onMapZoom,this)},onMapResize:function(){var k;this.initMapSize=true;var mapSize=this._map.getSize();var edgeLen=this._mapLocation.getEdgeLen();if(this._basePos==null){for(k in this._layers){this._layers[k].initLayer()}var centerGPos=this._mapLocation.getMapCenterGlobalPos();this._basePos=[centerGPos.posX-1*mapSize.width/2/edgeLen,centerGPos.posY-1*mapSize.height/2/edgeLen]}else{var newGPosX=this._basePos[0]+(-this._layerOffsetPos[0]+mapSize.width/2)/edgeLen;var newGPosY=this._basePos[1]+(-this._layerOffsetPos[1]+mapSize.height/2)/edgeLen;this._mapLocation._movedToMapCenterGlobalPos(new mapwork.GlobalPos(newGPosX,newGPosY));for(k in this._layers){this._layers[k].resizeLayer()}}},onMapMoved:function(){if(!this.initMapSize){return}for(var k in this._layers){this._layers[k].draggedLayer()}},onMapZoom:function(){if(!this.initMapSize){return}this._layerOffsetPos=[0,0];this._div.style.left=this._layerOffsetPos[0]+"px";this._div.style.top=this._layerOffsetPos[1]+"px";for(var k in this._layers){this._layers[k].changedLayerZoom()}var mapCenterGPos=this._mapLocation.getMapCenterGlobalPos();var mapSize=this._map.getSize();var edgeLen=this._mapLocation.getEdgeLen();this._basePos=[mapCenterGPos.posX-1*mapSize.width/2/edgeLen,mapCenterGPos.posY-1*mapSize.height/2/edgeLen]},addLayer:function(layer){if(layer&&layer instanceof mapwork.Layer){var layerId=layer.getLayerId();if(layerId){this._layers[layerId]=layer;layer.setMap(this._map);layer.setLayerContainer(this);this._div.appendChild(layer.getDiv())}}},getLayer:function(layerId){return this._layers[layerId]},getLayers:function(){return this._layers},onMapMoving:function(){for(var k in this._layers){this._layers[k].draggedLayer()}},movingToMapCenter:function(pos){var gPos;if(pos instanceof mapwork.GlobalPos){gPos=pos}else{if(pos instanceof mapwork.EarthPos){gPos=pos.convert2GlobalPos()}else{return}}var mapLocation=this._map.getMapLocation(),edgeLen=mapLocation.getEdgeLen(),size=this._map.getSize();this._layerOffsetPos[0]=(this._basePos[0]-gPos.posX)*edgeLen+size.width/2;this._layerOffsetPos[1]=(this._basePos[1]-gPos.posY)*edgeLen+size.height/2;this._div.style.left=this._layerOffsetPos[0]+"px";this._div.style.top=this._layerOffsetPos[1]+"px";mapLocation._movingMapCenterGlobalPos(gPos)},movedToMapCenter:function(pos){var gPos;if(pos instanceof mapwork.GlobalPos){gPos=pos}else{if(pos instanceof mapwork.EarthPos){gPos=pos.convert2GlobalPos()}else{return}}var mapLocation=this._map.getMapLocation(),edgeLen=mapLocation.getEdgeLen(),size=this._map.getSize();this._layerOffsetPos[0]=(this._basePos[0]-gPos.posX)*edgeLen+size.width/2;this._layerOffsetPos[1]=(this._basePos[1]-gPos.posY)*edgeLen+size.height/2;this._div.style.left=this._layerOffsetPos[0]+"px";this._div.style.top=this._layerOffsetPos[1]+"px";mapLocation._movedToMapCenterGlobalPos(gPos)},movedMap:function(pixelX,pixelY){var mapLocation=this._map.getMapLocation(),edgeLen=mapLocation.getEdgeLen(),size=this._map.getSize();this._layerOffsetPos[0]+=pixelX;this._layerOffsetPos[1]+=pixelY;this._div.style.left=this._layerOffsetPos[0]+"px";this._div.style.top=this._layerOffsetPos[1]+"px";var newGPosX=this._basePos[0]+(-this._layerOffsetPos[0]+size.width/2)/edgeLen;var newGPosY=this._basePos[1]+(-this._layerOffsetPos[1]+size.height/2)/edgeLen;mapLocation._movedToMapCenterGlobalPos(new mapwork.GlobalPos(newGPosX,newGPosY))},movingMap:function(pixelX,pixelY){var mapLocation=this._map.getMapLocation(),edgeLen=mapLocation.getEdgeLen(),size=this._map.getSize();this._layerOffsetPos[0]+=pixelX;this._layerOffsetPos[1]+=pixelY;this._div.style.left=this._layerOffsetPos[0]+"px";this._div.style.top=this._layerOffsetPos[1]+"px";var newGPosX=this._basePos[0]+(-this._layerOffsetPos[0]+size.width/2)/edgeLen;var newGPosY=this._basePos[1]+(-this._layerOffsetPos[1]+size.height/2)/edgeLen;mapLocation._movingMapCenterGlobalPos(new mapwork.GlobalPos(newGPosX,newGPosY))},dragMap:function(newX,newY){this._div.style.left=newX+"px";this._div.style.top=newY+"px";for(var k in this._layers){this._layers[k].draggedLayer()}},onMouseDown:function(event,actionDiv){if(this._map.getMode()!=0){return}if(!this.initMapSize){return}if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}else{event.cancelBubble=true;event.returnValue=false;if(event.button!=1){return}}if(mapwork.DragRectControl.doDragRect){var dragRectControl=this._map.getControl(mapwork.DragRectControl.ID);if(dragRectControl){dragRectControl.startDrag(event,this._mapLocation,actionDiv)}return}var initDivX=this._layerOffsetPos[0];var initDivY=this._layerOffsetPos[1];var timeY=0,timeZ=0,draggingTimeOffset=0;var timeYPosX=0,timeYPosY=0,timeZPosX=0,timeZPosY=0;var self=this;var pageX=utils.getPageX(event),pageY=utils.getPageY(event),tmpX,tmpY;var draggingDiv=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}if(actionDiv){}var tx=utils.getPageX(event);var ty=utils.getPageY(event);timeZ=(new Date()).getTime();draggingTimeOffset=timeZ-timeY;timeY=timeZ;timeYPosX=timeZPosX;timeYPosY=timeZPosY;timeZPosX=tx;timeZPosY=ty;if(tmpX==tx&&tmpY==ty){}else{tmpX=tx;tmpY=ty;var xx=tx-pageX+initDivX-self._layerOffsetPos[0];var yy=ty-pageY+initDivY-self._layerOffsetPos[1];self.movingMap(xx,yy)}};var droppedDiv=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}if(actionDiv){}utils.unbindEvent(document,"mousemove",draggingDiv);utils.unbindEvent(document,"mouseup",droppedDiv);var tx=utils.getPageX(event);var ty=utils.getPageY(event);timeZ=(new Date()).getTime();draggingTimeOffset+=timeZ-timeY;timeZPosX=tx;timeZPosY=ty;if(draggingTimeOffset>0&&draggingTimeOffset<20){self.doAfterDragMove((timeZPosX-timeYPosX),(timeZPosY-timeYPosY))}else{var xx=tx-pageX+initDivX-self._layerOffsetPos[0];var yy=ty-pageY+initDivY-self._layerOffsetPos[1];self.movedMap(xx,yy)}};utils.bindEvent(document,"mousemove",draggingDiv);utils.bindEvent(document,"mouseup",droppedDiv)},doAfterDragMove:function(offsetPosX,offsetPosY){var stepNum=50;var stepX=offsetPosX*5/stepNum;var stepY=offsetPosY*5/stepNum;var index=0;var self=this;function offset(){self.movingMap(stepX,stepY);index++;if(index>=stepNum){if(interval){clearInterval(interval);interval=null;self.movedMap(0,0)}}}var interval=setInterval(offset,1)}};if(EXTEND){mapwork.utils.inherits(LayerContainer,EXTEND)}})();(function(){mapwork.Handler=Handler;var EXTEND=null;function Handler(){if(EXTEND){EXTEND.apply(this,arguments)}this._handlerId=null}Handler.prototype={getHandlerId:function(){return this._handlerId},setMap:function(map){this._map=map}};if(EXTEND){mapwork.utils.inherits(Handler,EXTEND)}})();(function(){mapwork.MeasureHandler=MeasureHandler;var utils=mapwork.utils;MeasureHandler.ID="MeasureHandler";var EXTEND=mapwork.Handler;function MeasureHandler(){if(EXTEND){EXTEND.apply(this,arguments)}this._handlerId=MeasureHandler.ID}MeasureHandler.prototype={beginMeasure:function(){this._map._div.style.cursor="crosshair";this._map.setMode(1)},stopMeasure:function(){this._map.setMode(0);this._map._div.style.cursor="default";if(this._measureLine){this._measureLine.doStop();this._measureLine=null;if(this._currMeasureLine){this._currMeasureLine.doRemove();this._currMeasureLine=null}utils.unbindEvent(document,"mousemove",this._onMouseMove)}},addMeasurePoint:function(event){if(!event){return}var mapLocation=this._map.getMapLocation();var tx=mapLocation.getPageX(event);var ty=mapLocation.getPageY(event);var ePos=mapLocation.getEarthPosFromMapPos(tx,ty);if(!this._measureLine){this._measureLine=new mapwork.MeasureLine(this._map);this._currMeasureLine=new mapwork.MeasureLine(this._map);this._currMeasureLine.setDash("5");utils.bindEvent(document,"mousemove",this._onMouseMove)}this._measureLine.addMeasurePos(ePos);this._currMeasureLine.clearPosList();this._currMeasureLine.addPos(ePos)},setMap:function(map){this._map=map;map.addEventListener("mouseup",this.onMouseUp,this);map.addEventListener("dblclick",this.onDblClick,this);var self=this;function onMouseMove(event){if(self._map.getMode()!=1){return}if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var mapLocation=self._map.getMapLocation();var tx=mapLocation.getPageX(event);var ty=mapLocation.getPageY(event);var size=self._map.getSize();var offsetX=0,offsetY=0;if(tx<0){offsetX=-1}else{if(tx>=size.width-10){offsetX=1}}if(ty<0){offsetY=-1}else{if(ty>=size.height-10){offsetY=1}}if(offsetX!=0||offsetY!=0){self.startMoving(offsetX,offsetY)}else{self.stopMoving()}var ePos=mapLocation.getEarthPosFromMapPos(tx,ty);var currMeasureLine=self._currMeasureLine;if(currMeasureLine){if(currMeasureLine.getPosCount()==1){currMeasureLine.addPos(ePos)}else{currMeasureLine.changeLastPos(ePos)}}}this._onMouseMove=onMouseMove},onMouseUp:function(event){if(this._map.getMode()!=1){return}if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){if(event.button==2){this.stopMeasure()}return}}else{event.cancelBubble=true;event.returnValue=false;if(event.button!=1){if(event.button==2){this.stopMeasure()}return false}}this.addMeasurePoint(event)},onDblClick:function(event){if(this._map.getMode()!=1){return}if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}else{event.cancelBubble=true;event.returnValue=false}this._measureLine.removeLastPos();this.stopMeasure();return false},startMoving:function(offsetX,offsetY){var layerContainer=this._map.getLayerContainer();function offset(){layerContainer.movingMap(-offsetX*2,-offsetY*2)}if(!this._movingInterval){this._movingInterval=setInterval(offset,1)}},stopMoving:function(){if(this._movingInterval){clearInterval(this._movingInterval);this._movingInterval=null}}};if(EXTEND){mapwork.utils.inherits(MeasureHandler,EXTEND)}})();(function(){mapwork.KeyHandler=KeyHandler;KeyHandler.ID="KeyHandler";var EXTEND=mapwork.Handler;function KeyHandler(){if(EXTEND){EXTEND.apply(this,arguments)}this._handlerId=KeyHandler.ID;this._offsetStep=5;this._isOverMap=false}KeyHandler.prototype={setMap:function(map){this._map=map;var self=this;mapwork.utils.bindEvent(this._map._div,"mouseover",function(event){self._isOverMap=true});mapwork.utils.bindEvent(this._map._div,"mouseout",function(event){self._isOverMap=false});mapwork.utils.bindEvent(document,"keydown",function(event){self.onKeyDown(event)});mapwork.utils.bindEvent(document,"keyup",function(event){self.onKeyUp(event)})},onKeyDown:function(event){if(!this._isOverMap){return}this._offsetStep+=2;var mapLocation=this._map.getMapLocation();var layerContainer=this._map.getLayerContainer();if(event.keyCode==38){layerContainer.movedMap(0,this._offsetStep)}else{if(event.keyCode==40){layerContainer.movedMap(0,-this._offsetStep)}else{if(event.keyCode==37){layerContainer.movedMap(this._offsetStep,0)}else{if(event.keyCode==39){layerContainer.movedMap(-this._offsetStep,0)}else{if(event.keyCode==33){mapLocation.offsetZoom(1)}else{if(event.keyCode==34){mapLocation.offsetZoom(-1)}else{if(event.keyCode==187){mapLocation.offsetZoom(1)}else{if(event.keyCode==189){mapLocation.offsetZoom(-1)}}}}}}}}},onKeyUp:function(event){if(!this._isOverMap){return}this._offsetStep=5}};if(EXTEND){mapwork.utils.inherits(KeyHandler,EXTEND)}})();(function(){mapwork.DragHandler=DragHandler;DragHandler.ID="DragHandler";var EXTEND=mapwork.Handler;function DragHandler(){if(EXTEND){EXTEND.apply(this,arguments)}this._handlerId=DragHandler.ID}DragHandler.prototype={setMap:function(map){this._map=map;var layerContainer=map.getLayerContainer();map.addEventListener("mousedown",layerContainer.onMouseDown,layerContainer)}};if(EXTEND){mapwork.utils.inherits(DragHandler,EXTEND)}})();(function(){mapwork.WheelHandler=WheelHandler;WheelHandler.ID="WheelHandler";var EXTEND=mapwork.Handler;function WheelHandler(){if(EXTEND){EXTEND.apply(this,arguments)}this.interval=0;this._handlerId=WheelHandler.ID;if(mapwork.isIE){this.interval=200}this._lastWheelTime=0}WheelHandler.prototype={setMap:function(map){this._map=map;var mouseScrollEvent="mousewheel";if(mapwork.isFirefox){mouseScrollEvent="DOMMouseScroll"}map.addEventListener(mouseScrollEvent,this.onMouseWheel,this)},onMouseWheel:function(event){var currWheelTime=new Date().getTime();if(Math.abs(currWheelTime-this._lastWheelTime)>200){this._lastWheelTime=currWheelTime}else{return}if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var mapLocation=this._map.getMapLocation();var delta=0;if(!event){event=window.event}if(event.wheelDelta==-120||event.wheelDelta==120){delta=event.wheelDelta/40;if(window.opera){delta=-delta}}else{if(event.detail){delta=-event.detail}}var newZoom=mapLocation.getZoom();if(delta==-3){newZoom--;this._isZoomUp=true}else{if(delta==3){newZoom++;this._isZoomUp=false}}if(!mapLocation.isValidZoom(newZoom)){return}var mouseX,mouseY;if(mapwork.isIE){mouseX=event.x;mouseY=event.y}else{mouseX=event.clientX-mapLocation._map._div.offsetLeft;mouseY=event.clientY-mapLocation._map._div.offsetTop}if(this.interval){var self=this;if(!this._timeoutId){this._timeoutId=window.setTimeout(function(){self.doWheel(mouseX,mouseY,mapLocation,newZoom)},this.interval)}}else{this.doWheel(mouseX,mouseY,mapLocation,newZoom)}},doWheel:function(mouseX,mouseY,mapLocation,newZoom){window.clearTimeout(this._timeoutId);this._timeoutId=null;this._wheelRectControl=this._map.getControl(mapwork.WheelRectControl.ID);if(this._wheelRectControl){this._wheelRectControl.doWheelFocus(this._isZoomUp,mouseX,mouseY)}var wheelGPos=mapLocation.getGlobalPosFromMapPos(mouseX,mouseY);var newEdgeLen=Math.pow(2,8+newZoom);var newGPosX=wheelGPos.posX+(this._map._size.width/2-mouseX)/newEdgeLen;var newGPosY=wheelGPos.posY+(this._map._size.height/2-mouseY)/newEdgeLen;this._map.zoomToMapCenter(new mapwork.GlobalPos(newGPosX,newGPosY),newZoom)}};if(EXTEND){mapwork.utils.inherits(WheelHandler,EXTEND)}})();(function(){mapwork.ClickLocationHandler=ClickLocationHandler;ClickLocationHandler.ID="ClickLocationHandler";var EXTEND=mapwork.Handler;function ClickLocationHandler(){if(EXTEND){EXTEND.apply(this,arguments)}this._handlerId=ClickLocationHandler.ID}ClickLocationHandler.prototype={setMap:function(map){this._map=map;map.addEventListener("mousedown",this.onMouseDown,this);map.addEventListener("dblclick",this.onClick,this);map.getPanelDivPos()},onMouseDown:function(event){if(this._map.getMode()!=0){return}this._mouseDownPos=[event.offsetX,event.offsetY]},onClick:function(event){if(this._map.getMode()!=0){return}if(this._mouseDownPos){var mapLocation=this._map.getMapLocation();var mapX=mapwork.utils.getMapLayerX(event,mapLocation);var mapY=mapwork.utils.getMapLayerY(event,mapLocation);var mouseUpPos=[event.offsetX,event.offsetY];if(mouseUpPos[0]==this._mouseDownPos[0]&&mouseUpPos[1]==this._mouseDownPos[1]){var offsetX=(this._map._size.width/2-mapX);var offsetY=(this._map._size.height/2-mapY);var layerContainer=this._map.getLayerContainer();layerContainer.movedMap(offsetX,offsetY);this._mouseDownPos=null}}}};if(EXTEND){mapwork.utils.inherits(ClickLocationHandler,EXTEND)}})();(function(){mapwork.RangeSearchHandler=RangeSearchHandler;RangeSearchHandler.ID="RangeSearchHandler";var EXTEND=mapwork.Handler;function RangeSearchHandler(){if(EXTEND){EXTEND.apply(this,arguments)}this._handlerId=RangeSearchHandler.ID}RangeSearchHandler.prototype={setMap:function(map){this._map=map;this._vectorlayer=this._map.getLayer(mapwork.MapVectorLayer.ID);this._mapPopLayer=this._map.getLayer(mapwork.MapPopLayer.ID);this._mapLabelLayer=this._map.getLayer(mapwork.MapLabelLayer.ID);this._rangeSearchDiv=document.createElement("div");$(this._rangeSearchDiv).addClass("rangeSearch");$(this._rangeSearchDiv).append("<div class = 'searchType'>"+"<a name='JTSK' href='javascript:void(0);'>交通实况</a>"+"<a name='JTZB' href='javascript:void(0);'>交通直播</a>"+"<a name='YDP' href='javascript:void(0);'>诱导牌</a>"+"<a name='TextBoard' href='javascript:void(0);'>可变信息板</a>"+"<a name='Travel' href='javascript:void(0);'>旅游景点</a>"+"</div>"+"<div class = 'toolsContainer'>"+"<div class = 'title'>"+"<form name='rangeSearchForm'>"+"<input type='text' id='rangeSearchName'/>"+"<input type='image' id='rangeSearchButton' src='images/btn_tips_search.gif'>"+"</form>"+"</div>"+"<div class = 'content'>"+"<div class = 'aroundRule'>"+"<div class = 'ruleBg'></div>"+"<div class = 'ruleBar'></div>"+"<div class = 'ruleCursor'></div>"+"</div>"+"<div class = 'scale'>"+"<span style='left: 0%' class='tall'><ins style='margin-left: -4px; '>0</ins></span>"+"<span style='left: 10%'></span>"+"<span style='left: 20%' class='tall'><ins style='margin-left: -10.5px; '>1km</ins></span>"+"<span style='left: 30%'></span>"+"<span style='left: 40%' class='tall'><ins style='margin-left: -10.5px; '>2km</ins></span>"+"<span style='left: 50%'></span>"+"<span style='left: 60%' class='tall'><ins style='margin-left: -10.5px; '>3km</ins></span>"+"<span style='left: 70%'></span>"+"<span style='left: 80%' class='tall'><ins style='margin-left: -10.5px; '>4km</ins></span>"+"<span style='left: 90%'></span>"+"<span style='left: 100%' class='tall'><ins style='margin-left: -10.5px; '>5km</ins></span>"+"</div>"+"</div>"+"</div>");this._$RuleCursor=$(this._rangeSearchDiv).find(".ruleCursor");this._ruleCursor=this._$RuleCursor.get(0);this._ruleBar=$(this._rangeSearchDiv).find(".ruleBar").get(0);var self=this;mapwork.utils.bindEvent(this._ruleCursor,"click",function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}});mapwork.utils.bindEvent(this._ruleCursor,"mousedown",function(event){self.dragRuleCursor(event)});this._aroundRule=$(this._rangeSearchDiv).find(".aroundRule").get(0);mapwork.utils.bindEvent(this._aroundRule,"click",function(event){self._ruleCursorOffsetX=event.offsetX;self._currentRadius=event.offsetX*20;self.doAnimate(event.offsetX);self.doSearch()});var rangeSearchForm=$(this._rangeSearchDiv).find("form[name='rangeSearchForm']").get(0);rangeSearchForm.onsubmit=function(){self.doSearch();return false};$(this._rangeSearchDiv).find(".searchType > a").each(function(){this.onclick=function(){var tag=$(this).html();$(self._rangeSearchDiv).find("#rangeSearchName").val(tag);self.doSearch()}});this._pinOffsetY=34;this._defaultRadius=500;var menu=this._map.getMenu();var searchGroup=new mapwork.MenuGroup("search",2);searchGroup.addMenuItem("周边搜索",function(){self.doMenu(menu.getMousePos())});menu.addMenuGroup(searchGroup)},doMenu:function(mousePos){var mapLocation=this._map.getMapLocation();var ePos=mapLocation.getEarthPosFromMapPos(mousePos.posX,mousePos.posY);this.openRangeSearchControl(ePos)},openRangeSearchControl:function(ePos){var self=this;var closeTip=function(){self.doClose()};this._map.openTip(ePos,"周边搜索",this._rangeSearchDiv,"",this._pinOffsetY,closeTip);var radius=this._currentRadius?this._currentRadius:this._defaultRadius;this.createControl(ePos,radius);this._ruleCursorOffsetX=radius/20;this._ruleCursor.style.left=radius/20+"px";this._ruleBar.style.width=radius/20+"px"},createControl:function(ePos,radius){if(!this._searchCircle){this._searchCircle=new mapwork.MapCircle("rangeSearchCircle");this._searchCircle.setColor("#1791fc");this._searchCircle.setFillColor("#1791fc");this._searchCircle.setFillOpacity("0.2");this._searchCircle.setStrokeOpacity("0.8");this._searchCircle.setWidth("1")}this._searchCircle.setCenterPos(ePos);this._searchCircle.setRadius(radius);this._vectorlayer.addElement(this._searchCircle);this._vectorlayer.resetElement(this._searchCircle);var eEdgePos=this._searchCircle.getEEdgePos();if(!this._radiusLine){this._radiusLine=new mapwork.MapPath("radiusLine");this._radiusLine.setDash("5,5");this._radiusLine.setColor("#1791fc");this._radiusLine.setWidth("1")}this._radiusLine.clearPosList();this._radiusLine.addPos(ePos);this._radiusLine.addPos(eEdgePos);this._vectorlayer.addElement(this._radiusLine);this._vectorlayer.resetElement(this._radiusLine);if(eEdgePos){if(!this._circleLabel){this._circleLabel=new mapwork.MapLabel("circleLabel")}this._circleLabel.setPos(eEdgePos);this._circleLabel.setName(radius+"米");this._circleLabel._offsetPos=[6,-13];this._mapLabelLayer.addElement(this._circleLabel);this._mapLabelLayer.resetElement(this._circleLabel)}if(eEdgePos){if(!this._ball){this._ball=new mapwork.MapIcon("boll","images/ball.png","images/ball.png",[5,5],100);var self=this}this._ball.setPos(eEdgePos);this._mapPopLayer.addElement(this._ball);this._mapPopLayer.resetElement(this._ball)}if(!this._pin){this._pin=new mapwork.MapDraggableIcon("pin","images/arrow.png","images/arrow.png",[11,this._pinOffsetY],100);var self=this;this._pin.setDraggedFunc(function(){var draggedEPos=self._pin.getEarthPos();if(draggedEPos){ePos=draggedEPos}self.openRangeSearchControl(ePos);self.doSearch()});this._pinShadow=new mapwork.MapIcon("pinShadow","images/arrowshadow.png","images/arrowshadow.png",[0,22],90);this._pin.setShadowIcon(this._pinShadow)}var self=this;this._pin.getHtmlObj().onclick=function(){self.openRangeSearchControl(ePos)};this._pin.setPos(ePos);this._pinShadow.setPos(ePos);this._mapPopLayer.addElement(this._pin);this._mapPopLayer.addElement(this._pinShadow);this._mapPopLayer.resetElement(this._pin);this._mapPopLayer.resetElement(this._pinShadow)},doClose:function(){if(this._searchCircle){this._searchCircle.doRemove();this._searchCircle=null}if(this._radiusLine){this._radiusLine.doRemove();this._radiusLine=null}if(this._circleLabel){this._circleLabel.doRemove();this._circleLabel=null}if(this._ball){this._ball.doRemove();this._ball=null}if(!this._searched){this.closePin()}},closePin:function(){this._pin.doRemove();this._pinShadow.doRemove();this._pin=null;this._pinShadow=null},dragRuleCursor:function(event){this._pressX=mapwork.utils.getPageX(event);if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}this._$RuleCursor.addClass("ruleCursorHover");var self=this;var dragging=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}var offsetX=self._ruleCursorOffsetX+mapwork.utils.getPageX(event)-self._pressX;if(offsetX>=0&&offsetX<=250){self.doAnimate(offsetX)}};var dropped=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}$(document).unbind("mousemove",dragging);$(document).unbind("mouseup",dropped);self._$RuleCursor.removeClass("ruleCursorHover");self._ruleCursorOffsetX=self._$RuleCursor.position().left;self._currentRadius=self._$RuleCursor.position().left*20;self.doSearch()};$(document).bind("mousemove",dragging);$(document).bind("mouseup",dropped)},doAnimate:function(offsetX){this._ruleCursor.style.left=offsetX+"px";this._ruleBar.style.width=offsetX+"px";this.setCircleRadius(offsetX);this.setCircleLabel(offsetX);this.setRadiusLine();this.setBall()},setCircleRadius:function(offsetX){this._searchCircle.setRadius(offsetX*20);this._vectorlayer.resetElement(this._searchCircle)},setCircleLabel:function(offsetX){var length=parseInt(offsetX*20);this._circleLabel.setName(length+"米");var newEPos=this._searchCircle.getEEdgePos();this._circleLabel.setPos(newEPos);this._mapLabelLayer.resetElement(this._circleLabel)},setRadiusLine:function(){this._radiusLine.clearPosList();var eCenterPos=this._searchCircle.getECenterPos();var eEdgePos=this._searchCircle.getEEdgePos();this._radiusLine.addPos(eCenterPos);this._radiusLine.addPos(eEdgePos);this._vectorlayer.resetElement(this._radiusLine)},setBall:function(){var newEPos=this._searchCircle.getEEdgePos();this._ball.setPos(newEPos);this._mapPopLayer.resetElement(this._ball)},doSearch:function(name){var searchName=name?name:$(this._rangeSearchDiv).find("#rangeSearchName").val();if($.trim(searchName)==""){return}$(this._rangeSearchDiv).find("#rangeSearchName").val(searchName);this._searched=true;var currentModule=this._map._currentModule;if(currentModule){currentModule.doRemoveIconList()}var listLayer=this._map.getLayer("moduleListLayer");if(listLayer){listLayer.empty()}var searchModule=this._map.getModule(mapwork.Search.ID);searchModule.init();searchModule.setSearchHandler(this);this._map._currentModule=searchModule;searchModule.setSearchType("range");var epos=this._searchCircle._eCenterPos;var radius=this._searchCircle._radius;searchModule.setSearchCenterEPos(epos);searchModule.setSearchRadius(radius);searchModule.doPageQuery(null,null,searchName)}};if(EXTEND){mapwork.utils.inherits(RangeSearchHandler,EXTEND)}})();(function(){mapwork.Control=Control;var EXTEND=null;function retrunFalse(){return false}function Control(){if(EXTEND){EXTEND.apply(this,arguments)}this._div=document.createElement("div");this._div.style.position="absolute";this._controlId=null}Control.prototype={getControlId:function(){return this._controlId},setMap:function(map){this._map=map},getMap:function(){return this._map},appendToDiv:function(wrapDiv){wrapDiv.appendChild(this._div)},getDiv:function(){return this._div},createImage:function(appendDiv,name,url,left,top,clickListener){var image=document.createElement("img");if(name){image.name=name}image.src=url;image.style.position="absolute";image.style.left=left+"px";image.style.top=top+"px";image.ondragstart=retrunFalse;if(appendDiv){appendDiv.appendChild(image)}if(clickListener){var self=this;mapwork.utils.bindEvent(image,"mousedown",function(){clickListener.apply(self,arguments)})}return image},createAbsoluteSpan:function(appendDiv,name,text,left,top){var span=document.createElement("span");if(name){span.name=name}if(text){span.innerText=text;span.style.position="absolute";span.style.left=left+"px";span.style.top=top+"px"}if(appendDiv){appendDiv.appendChild(span)}return span},createRelativeSpan:function(appendDiv,name,text,left,top){var span=document.createElement("span");if(name){span.name=name}if(text){span.innerText=text;span.style.position="relative";span.style.left=left+"px";span.style.top=top+"px"}if(appendDiv){appendDiv.appendChild(span)}return span},createDiv:function(appendDiv,name){var div=document.createElement("div");if(name){div.name=name}if(appendDiv){appendDiv.appendChild(div)}return div}};if(EXTEND){mapwork.utils.inherits(Control,EXTEND)}})();(function(){mapwork.MenuControl=MenuControl;MenuControl.ID="MenuControl";var EXTEND=mapwork.Control;function MenuControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=MenuControl.ID;this._div.className="menuControl";this._div.style["zIndex"]=9999;this._div.style.position="absolute";this._div.style.display="none"}MenuControl.prototype={buildMenuDiv:function(){if(!this._isBuildMenu){this._menu.buildMenuDiv(this._div);this._isBuildMenu=true}},setMap:function(map){this._map=map;this._menu=map.getMenu();var self=this;function menuFunc(event){self.showMenu(event);return false}if(mapwork.isIE){this._map._div.oncontextmenu=function(){event.returnValue=false;event.cancelBubble=true;menuFunc(event)}}else{this._map._div.oncontextmenu=menuFunc}this._map._div.onclick=function(){self.hideMenu()}},showMenu:function(event){if(this._map.getMode()!=0){return}var pageX,pageY;if(mapwork.isIE){pageX=event.x;pageY=event.y}else{var mapLocation=this._map.getMapLocation();pageX=event.clientX-mapLocation._map._div.offsetLeft;pageY=event.clientY-mapLocation._map._div.offsetTop}if(this._menu.getMenuGroupCount()>0){this.buildMenuDiv();this._menu.setMousePos(pageX,pageY);this._div.style.top=pageY+"px";this._div.style.left=pageX+"px";this._div.style.display="block"}},hideMenu:function(){this._div.style.display="none"}};if(EXTEND){mapwork.utils.inherits(MenuControl,EXTEND)}})();(function(){mapwork.SimpleZoomControl=SimpleZoomControl;SimpleZoomControl.ID="SimpleZoomControl";var EXTEND=mapwork.Control;function SimpleZoomControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._div.style["zIndex"]=1001;this._div.style.position="absolute";this._div.style.top="0px";this._div.style.left="0px";this._controlId=SimpleZoomControl.ID}SimpleZoomControl.prototype={setMap:function(map){this._map=map;this.createImage(this._div,"zoomdown","images/zoomrulerup.png",20,20,this.onClick);this.createImage(this._div,"zoomup","images/zoomrulerdown.png",50,20,this.onClick)},onClick:function(event){var target=event.target;if(target.name=="zoomdown"){this._map.getMapLocation().offsetZoom(1)}else{if(target.name=="zoomup"){this._map.getMapLocation().offsetZoom(-1)}}}};if(EXTEND){mapwork.utils.inherits(SimpleZoomControl,EXTEND)}})();(function(){mapwork.DetailZoomControl=DetailZoomControl;DetailZoomControl.ID="DetailZoomControl";var EXTEND=mapwork.Control;var ImgZoomRectEnable="images/zoomrectenable.png";var ImgZoomRectDisable="images/zoomrectdisable.png";var orientRects={"up":[[27,8,43,22],[25,10,45,20],[23,12,47,18],[22,14,22,14],[22,14,49,16],[29,6,41,24],[31,4,39,25],[32,3,38,27],[33,2,37,28]],"left":[[9,26,23,42],[7,28,26,39],[5,30,28,37],[3,32,29,36],[11,24,21,44],[13,23,19,45],[14,21,18,47]],"right":[[46,27,62,40],[44,30,65,38],[42,31,67,36],[48,25,60,43],[50,23,59,45],[52,21,56,47]],"down":[[27,46,43,60],[24,48,46,58],[22,51,48,55],[29,44,42,62],[31,42,39,64],[33,40,37,66]]};var rulerButtonWidth=32;var rulerButtonHeight=23;var rulerWidth=12;var rulerHeight=146;var usedMinZoom=7;var usedMaxZoom=18;var usedZooms=usedMaxZoom-usedMinZoom+2;function DetailZoomControl(displayZoomText){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=DetailZoomControl.ID;this._div.style["zIndex"]=1002;this._div.style.position="absolute";this._div.style.top="10px";this._div.style.left="10px";this._div.style.width="50px";this._div.style.height="300px";this._div.style["-moz-user-select"]="none";this._div.style["-webkit-user-select"]="none";if(displayZoomText==undefined){displayZoomText=true}this._displayZoomText=displayZoomText===true}DetailZoomControl.prototype={setMap:function(map){this._map=map;this._orientImage=this.createImage(this._div,"zoomorient","images/zoomorient.png",5,5,this.onClick);this._rulerButton=this.createImage(this._div,"zoomruler","images/zoomruler.png",35,77+rulerButtonHeight-2,this.onClick);this._rulerUpButton=this.createImage(this._div,"zoomrulerup","images/zoomrulerup.png",25,77,this.onClick);this._rulerDownButton=this.createImage(this._div,"zoomrulerdown","images/zoomrulerdown.png",25,77+rulerButtonHeight+rulerHeight-4,this.onClick);this._sliderButton=this.createImage(this._div,"zoomslider","images/zoomslider.png",25,75,this.onClick);if(this._displayZoomText){this._zoomLabel=this.createAbsoluteSpan(this._div,"zoomLabel","10",55,105);this._zoomLabel.style.font="normal 12px Verdana";this._zoomLabel.style.color="#646464"}this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onMapZoom,this);this._map.addEventListener(mapwork.MapEvent.DRAGSTATUS_CHANGE,this.changeDragStatus,this);this.resetSlider()},onClick:function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var target=event.target;if(!target){target=event.srcElement}var offsetX=event.offsetX;var offsetY=event.offsetY;if(offsetX==undefined||offsetY==undefined){var offset=mapwork.utils.getOffset(event);offsetX=offset.offsetX;offsetY=offset.offsetY}var mapLocation=this._map.getMapLocation();if(target.name=="zoomorient"){if(event.stopImmediatePropagation){event.stopImmediatePropagation()}else{event.cancelBubble=true}var layerContainer=this._map.getLayerContainer();for(var k in orientRects){var item=orientRects[k];if(item.length>0){var isInRect=false;for(var i=0;i<item.length;i++){var rect=item[i];if(offsetX>=rect[0]&&offsetX<=rect[2]&&offsetY>=rect[1]&&offsetY<=rect[3]){isInRect=true;break}}if(isInRect){if(k==="up"){layerContainer.movedMap(0,200);return}else{if(k==="left"){layerContainer.movedMap(200,0);return}else{if(k==="right"){layerContainer.movedMap(-200,0);return}else{if(k==="down"){layerContainer.movedMap(0,-200);return}}}}}}}}else{if(target.name=="zoomruler"){if(event.stopImmediatePropagation){event.stopImmediatePropagation()}else{event.cancelBubble=true}if(offsetY>=0&&offsetY<=rulerHeight){this.setSliderPos(offsetY)}}else{if(target.name=="zoomrulerup"){mapLocation.offsetZoom(1)}else{if(target.name=="zoomrulerdown"){mapLocation.offsetZoom(-1)}else{if(target.name=="zoomslider"){}else{if(target.name=="zoomrect"){mapwork.DragRectControl.doDragRect=!mapwork.DragRectControl.doDragRect;this.changeDragStatus()}else{if(target.name=="center"){}}}}}}}},onMapZoom:function(event){this.resetSlider()},setSliderPos:function(yPos){var thezoom=(yPos-5)*usedZooms;thezoom=thezoom/rulerHeight;var zoom=usedMaxZoom-parseInt(thezoom);var oldZoom=this._map.getMapLocation().getZoom();if(zoom!=oldZoom){this._map.getMapLocation().setZoom(zoom)}},resetSlider:function(){var zoom=this._map.getMapLocation().getZoom();if(!zoom){if(zoom!==0){return}}var rulerTop=mapwork.utils.getStyleTop(this._rulerButton);var newY=(rulerHeight*(usedMaxZoom-zoom)/usedZooms+rulerTop+5);if(this._displayZoomText){this._zoomLabel.innerText=""+zoom;this._zoomLabel.style.top=(newY-2)+"px"}this._sliderButton.style.top=newY+"px"},changeDragStatus:function(){if(mapwork.DragRectControl.doDragRect){this._zoomRectImg.src=ImgZoomRectDisable}else{this._zoomRectImg.src=ImgZoomRectEnable}}};if(EXTEND){mapwork.utils.inherits(DetailZoomControl,EXTEND)}})();(function(){mapwork.CenterCrossControl=CenterCrossControl;CenterCrossControl.ID="CenterCrossControl";var EXTEND=mapwork.Control;function CenterCrossControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=CenterCrossControl.ID;this._div.style["zIndex"]=9700;this._div.style.position="absolute";this._div.style.top="0px";this._div.style.left="0px";this._imageWidth=19;this._imageHeight=19}CenterCrossControl.prototype={setMap:function(map){this._map=map;this._crossImage=this.createImage(this._div,"center","images/center.gif",0,0);this._crossWidth=mapwork.utils.getStyleWidth(this._crossImage);this._crossHeight=mapwork.utils.getStyleHeight(this._crossImage);this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onMapResize,this)},onMapResize:function(){var size=this._map.getSize();var x=size.width/2-this._imageWidth/2;var y=size.height/2-this._imageHeight/2;this._crossImage.style.left=x+"px";this._crossImage.style.top=y+"px"}};if(EXTEND){mapwork.utils.inherits(CenterCrossControl,EXTEND)}})();(function(){mapwork.MapScaleControl=MapScaleControl;MapScaleControl.ID="MapScaleControl";var EXTEND=mapwork.Control;function MapScaleControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=MapScaleControl.ID;this._div.style["zIndex"]=9900;this._div.style.position="absolute";this._div.style.right="10px";this._div.style.bottom="10px"}MapScaleControl.prototype={setMap:function(map){this._map=map;this._scaleDiv=this.createDiv(this._div,"scalediv");this._scaleDiv.style["position"]="absolute";this._scaleDiv.style["border"]="0px";this._scaleDiv.style["textAlign"]="center";this._scaleDiv.style["align"]="center";this._scaleDiv.style["borderColor"]="#000";this._scaleDiv.style.bottom="0px";this._scaleDiv.style.right="0px";this._scaleDiv.style.height="20px";this._scaleDiv.align="center";this._scaleLabel=this.createRelativeSpan(this._scaleDiv,"scaleLabel","",0,-15);this._scaleLabel.style.font='normal 12px "宋体",Verdana';this._scaleLabel.style.color="black";this._scaleLabel.align="center";this._scaleLabel.style.width="100%";var rulerDiv=this.createDiv(this._scaleDiv,"scalediv");rulerDiv.style["position"]="absolute";rulerDiv.style["background"]="#000";rulerDiv.style["width"]="100%";rulerDiv.style["bottom"]="4px";rulerDiv.style["height"]="2px";rulerDiv.style["fontSize"]="0px";rulerDiv.style["left"]="0px";rulerDiv=this.createDiv(this._scaleDiv,"scalediv");rulerDiv.style["position"]="absolute";rulerDiv.style["background"]="#000";rulerDiv.style["width"]="1px";rulerDiv.style["left"]="0px";rulerDiv.style["height"]="10px";rulerDiv.style["bottom"]="0px";rulerDiv.style["fontSize"]="0px";rulerDiv=this.createDiv(this._scaleDiv,"scalediv");rulerDiv.style["position"]="absolute";rulerDiv.style["background"]="#000";rulerDiv.style["width"]="1px";rulerDiv.style["height"]="10px";rulerDiv.style["bottom"]="0px";rulerDiv.style["fontSize"]="0px";rulerDiv.style["right"]="0px";this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onReset,this);this._map.addEventListener(mapwork.MapEvent.MOVE_END,this.onReset,this);this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onReset,this)},setRightLength:function(len){this._div.style.right=(len+10)+"px"},onReset:function(){var mapLocation=this._map.getMapLocation();var rulerLen=160;var size=this._map.getSize();if(rulerLen>=size.width/3){rulerLen=parseInt(size.width/3)}var edgeLen=mapLocation.getEdgeLen();var mapCenter=mapLocation.getMapCenterGlobalPos();var ruler=mapwork.MapRulerBuilder.createMapRuler(mapCenter,mapLocation.getZoom(),edgeLen,rulerLen);if(ruler){this._scaleDiv.style.display="block";this._scaleLabel.innerText=ruler.metricText;if(mapwork.isFirefox){this._scaleLabel.textContent=ruler.metricText}if(ruler.metricLength){this._scaleDiv.style.width=ruler.metricLength+"px"}this._scaleDiv.align="center"}else{this._scaleDiv.style.display="none"}}};if(EXTEND){mapwork.utils.inherits(MapScaleControl,EXTEND)}})();(function(){mapwork.MapPosInfoControl=MapPosInfoControl;MapPosInfoControl.ID="MapPosInfoControl";var EXTEND=mapwork.Control;function MapPosInfoControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=MapPosInfoControl.ID;this._div.style["zIndex"]=9800;this._div.style.position="absolute";this._div.style.left="5px";this._div.style.bottom="5px"}MapPosInfoControl.prototype={setMap:function(map){this._map=map;this._posInfoLabel=this.createRelativeSpan(this._div,"posInfoLabel");this._posInfoLabel.style.display="inline";this._posInfoLabel.style.font="normal 12px \u5b8b\u4f53,Verdana";this._posInfoLabel.style.color="black";this._posInfoLabel.style["float"]="left";this._posInfoLabel.style.padding="1px";this._posInfoLabel.style.background="white";this._posInfoLabel.style.cursor="default";this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onMapReset,this);this._map.addEventListener(mapwork.MapEvent.MOVING,this.onMapReset,this);this._map.addEventListener(mapwork.MapEvent.MOVE_END,this.onMapReset,this);this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onMapReset,this)},onMapReset:function(){var mapLocation=this._map.getMapLocation();var mapCenterEPos=mapLocation.getMapCenterEarthPos();var info="Center:("+mapCenterEPos.getLatLonString()+")["+mapLocation.getCenterTileId()+"]";this._posInfoLabel.innerText=info}};if(EXTEND){mapwork.utils.inherits(MapPosInfoControl,EXTEND)}})();(function(){mapwork.WheelRectControl=WheelRectControl;WheelRectControl.ID="WheelRectControl";var EXTEND=mapwork.Control;function WheelRectControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=WheelRectControl.ID;this._div1=document.createElement("div");this._div1.style.position="absolute";this._div1.style["zIndex"]=1003;this._div1.style["borderTop"]="2px solid #f00";this._div1.style["borderLeft"]="2px solid #f00";this._div1.style.width="10px";this._div1.style.height="10px";this._div2=document.createElement("div");this._div2.style["zIndex"]=1003;this._div2.style.position="absolute";this._div2.style["borderBottom"]="2px solid #f00";this._div2.style["borderRight"]="2px solid #f00";this._div2.style.width="10px";this._div2.style.height="10px";this._div3=document.createElement("div");this._div3.style.position="absolute";this._div3.style["zIndex"]=1003;this._div3.style["borderBottom"]="2px solid #f00";this._div3.style["borderLeft"]="2px solid #f00";this._div3.style.width="10px";this._div3.style.height="10px";this._div4=document.createElement("div");this._div4.style["zIndex"]=1003;this._div4.style.position="absolute";this._div4.style["borderTop"]="2px solid #f00";this._div4.style["borderRight"]="2px solid #f00";this._div4.style.width="10px";this._div4.style.height="10px";this._wheelFocusTime=null;this._wheelFocusX=0;this._wheelFocusY=0;this._wheelFocusLen=0;this._isZoomUp=false;this.disableDivs()}WheelRectControl.prototype={appendToDiv:function(wrapDiv){wrapDiv.appendChild(this._div1);wrapDiv.appendChild(this._div2);wrapDiv.appendChild(this._div3);wrapDiv.appendChild(this._div4)},redraw:function(){this._div1.style.left=(this._wheelFocusX-this._wheelFocusLen)+"px";this._div1.style.top=(this._wheelFocusY-this._wheelFocusLen)+"px";this._div2.style.left=(this._wheelFocusX+this._wheelFocusLen)+"px";this._div2.style.top=(this._wheelFocusY+this._wheelFocusLen)+"px";this._div3.style.left=(this._wheelFocusX-this._wheelFocusLen)+"px";this._div3.style.top=(this._wheelFocusY+this._wheelFocusLen)+"px";this._div4.style.left=(this._wheelFocusX+this._wheelFocusLen)+"px";this._div4.style.top=(this._wheelFocusY-this._wheelFocusLen)+"px"},doWheelFocus:function(isZoomUp,x,y){this._isZoomUp=isZoomUp;this._wheelFocusX=x;this._wheelFocusY=y;this._wheelFocusLen=30;this._div1.style.display="block";this._div2.style.display="block";this._div3.style.display="block";this._div4.style.display="block";if(!this._wheelFocusTime){var self=this;function doTheWheel(){self.doWheelFocusIt()}this._wheelFocusTime=setInterval(doTheWheel,100)}},disableDivs:function(){this._div1.style.display="none";this._div1.style.left="-1000px";this._div1.style.top="-1000px";this._div2.style.display="none";this._div2.style.left="-1000px";this._div2.style.top="-1000px";this._div3.style.display="none";this._div3.style.left="-1000px";this._div3.style.top="-1000px";this._div4.style.display="none";this._div4.style.left="-1000px";this._div4.style.top="-1000px"},doWheelFocusIt:function(){if(this._isZoomUp){this._wheelFocusLen-=3}else{this._wheelFocusLen+=3}this.redraw();if(this._wheelFocusLen>=40||this._wheelFocusLen<20){if(this._wheelFocusTime){clearInterval(this._wheelFocusTime);this._wheelFocusTime=null;this.redraw();this.disableDivs()}}}};if(EXTEND){mapwork.utils.inherits(WheelRectControl,EXTEND)}})();(function(){mapwork.DragRectControl=DragRectControl;DragRectControl.ID="DragRectControl";var EXTEND=mapwork.Control;DragRectControl.doDragRect=false;var utils=mapwork.utils;function DragRectControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=DragRectControl.ID;this._div.style["zIndex"]=9800;this._div.style.position="absolute";this._div.style.border="1px solid #E88C2B";this._div.style["backgroundColor"]="rgba(232, 140, 43, 0.5)";this._div.style.left="-1000px";this._div.style.top="-1000px";this._div.style.width="0px";this._div.style.height="0px"}DragRectControl.prototype={startDrag:function(event){var self=this;if(mapwork.isIE){this._pageX=event.x;this._pageY=event.y}else{var mapLocation=this._map.getMapLocation();this._pageX=event.clientX-mapLocation._map._div.offsetLeft;this._pageY=event.clientY-mapLocation._map._div.offsetTop}this._div.style.display="block";this._div.style.left=this._pageX+"px";this._div.style.top=this._pageY+"px";this._div.style.width="0px";this._div.style.height="0px";function draggingFunc(event){self.draggingDiv.call(self,event)}function droppedFunc(event){self.droppedDiv.call(self,event)}this.draggingFunc=draggingFunc;this.droppedFunc=droppedFunc;utils.bindEvent(document,"mousemove",draggingFunc);utils.bindEvent(document,"mouseup",droppedFunc)},draggingFunc:function(event){this.draggingDiv.call(this,event)},draggingDiv:function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var tx,ty;if(mapwork.isIE){tx=event.x;ty=event.y}else{var mapLocation=this._map.getMapLocation();tx=event.clientX-mapLocation._map._div.offsetLeft;ty=event.clientY-mapLocation._map._div.offsetTop}this._div.style.left=Math.min(this._pageX,tx)+"px";this._div.style.top=Math.min(this._pageY,ty)+"px";this._div.style.width=Math.abs(tx-this._pageX)+"px";this._div.style.height=Math.abs(ty-this._pageY)+"px"},droppedDiv:function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}utils.unbindEvent(document,"mousemove",this.draggingFunc);utils.unbindEvent(document,"mouseup",this.droppedFunc);var tx,ty;if(mapwork.isIE){tx=event.x;ty=event.y}else{var mapLocation=this._map.getMapLocation();tx=event.clientX-mapLocation._map._div.offsetLeft;ty=event.clientY-mapLocation._map._div.offsetTop}this._div.style.display="none";this._div.style.left="-1000px";this._div.style.top="-1000px";this._div.style.width="0px";this._div.style.height="0px";this.zoomToRect(this._pageX,this._pageY,tx,ty);DragRectControl.doDragRect=false;this._map.fireEvent(mapwork.MapEvent.DRAGSTATUS_CHANGE,this._map)},zoomToRect:function(x0,y0,x1,y1){if(Math.abs(x1-x0)==0||Math.abs(y1-y0)==0){}else{var x0Pos=Math.min(x0,x1);var y0Pos=Math.min(y0,y1);var x1Pos=Math.max(x0,x1);var y1Pos=Math.max(y0,y1);var mapLocation=this._map.getMapLocation();var startGPos=mapLocation.getGlobalPosFromMapPos(x0Pos,y0Pos);var endGPos=mapLocation.getGlobalPosFromMapPos(x1Pos,y1Pos);var bounds=new mapwork.Bounds();bounds.expandToIncludePoint(startGPos.getPosX(),startGPos.getPosY());bounds.expandToIncludePoint(endGPos.getPosX(),endGPos.getPosY());this._map.fitBounds(bounds)}}};if(EXTEND){mapwork.utils.inherits(DragRectControl,EXTEND)}})();(function(){mapwork.OverviewControl=OverviewControl;OverviewControl.ID="OverviewControl";var EXTEND=mapwork.Control;var utils=mapwork.utils;function OverviewControl(isOpen){if(EXTEND){EXTEND.apply(this,arguments)}this._width=125;this._height=125;this._controlId=OverviewControl.ID;this._div.style["zIndex"]=9900;this._div.style.position="absolute";this._div.style.border="2px solid #84A9D2";this._div.style["backgroundColor"]="#FFF";this._div.style.overflow="hidden";this._div.style["-webkit-user-select"]="none";this._div.style.right="0px";this._div.style.bottom="0px";this._bgRect=new mapwork.MapShadowRect("MapShadowRect");if(isOpen){this._isOpen=true}else{this._isOpen=false}}OverviewControl.prototype={setMap:function(map){this._map=map;this._mapLocation=map.getMapLocation();this.createOverviewMap();this.createToggleButton();this.resetBGMap();this.resetCurrectMapSizeRect();if(this._isOpen){this._div.style.width=this._width+"px";this._div.style.height=this._height+"px";this._toggleImage.style.left="0px";this._toggleImage.style.top="0px"}else{this._div.style.width="17px";this._div.style.height="17px";this._toggleImage.style.left="-19px";this._toggleImage.style.top="0px"}utils.bindEvent(this._div,"mousedown",function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}else{event.cancelBubble=true;event.returnValue=false;if(event.button!=1){return}}});utils.bindEvent(this._div,"click",function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}else{event.cancelBubble=true;event.returnValue=false;if(event.button!=1){return}}});this._mapScaleControl=this._map.getControl(mapwork.MapScaleControl.ID);this.setScaleControlOffset();this._map.addEventListener(mapwork.MapEvent.RESIZE,this.onMapResize,this);this._map.addEventListener(mapwork.MapEvent.MOVING,this.onMapMoving,this);this._map.addEventListener(mapwork.MapEvent.MOVE_END,this.onMapMoved,this);this._map.addEventListener(mapwork.MapEvent.ZOOM_END,this.onMapZoom,this)},createOverviewMap:function(){var self=this;this._oMap=new mapwork.Map(this._div,{zoom:self._mapLocation.getZoom()-4});this._oMapLocation=this._oMap.getMapLocation();this._oMapLocation._minZoom-=4;var tileLayer=new mapwork.TileLayer("tileLayer");this._oMap.addLayer(tileLayer);this._layerContainer=this._oMap.getLayerContainer();this._shadowLayer=this._layerContainer.getLayer(mapwork.MapShadowLayer.ID);this._shadowLayer.addElement(this._bgRect);if(mapwork.isIE){this._bgRect.setStyle({"position":"absolute","border":"1px solid #f00","backgroundColor":"#f00","filter":"alpha(opacity=40)"})}else{this._bgRect.setStyle({"position":"absolute","border":"1px solid #f00","backgroundColor":"#f00","opacity":0.4})}this._rectFGDiv=document.createElement("div");this._rectFGDiv.style.position="absolute";this._rectFGDiv.style.border="2px solid #000";this._rectFGDiv.style.zIndex=10000;var contentDiv=document.createElement("div");contentDiv.style.position="absolute";contentDiv.style.backgroundColor="#fff";contentDiv.style.opacity=0.01;this._rectFGDiv.appendChild(contentDiv);this._div.appendChild(this._rectFGDiv);var self=this;utils.bindEvent(this._rectFGDiv,"mousedown",function(event){self.onMouseDown.call(self,event)})},createToggleButton:function(){var toggleDiv=document.createElement("div");toggleDiv.style.position="absolute";toggleDiv.style.width="19px";toggleDiv.style.height="19px";toggleDiv.style.right="-1px";toggleDiv.style.bottom="-1px";toggleDiv.style.overflow="hidden";toggleDiv.style.zIndex=10000;this._div.appendChild(toggleDiv);this._toggleImage=document.createElement("img");toggleDiv.appendChild(this._toggleImage);this._toggleImage.style.left="0px";this._toggleImage.style.top="0px";this._toggleImage.src="images/eagleeyerect.png";this._toggleImage.style.position="absolute";var self=this;utils.bindEvent(toggleDiv,"mouseup",function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}else{event.cancelBubble=true;event.returnValue=false;if(event.button!=1){return}}self.doToggle()})},getDivBounds:function(){var $Div=$(this._div);var offset=$Div.offset();var width=$Div.width();var height=$Div.height();return new mapwork.Bounds(offset.left,offset.top,offset.left+width,offset.top+height)},getFGRectBounds:function(){var jFGRect=$(this._rectFGDiv);var offset=jFGRect.offset();var width=jFGRect.width();var height=jFGRect.height();return new mapwork.Bounds(offset.left,offset.top,offset.left+width,offset.top+height)},getFGRectCenterGPos:function(divBounds,fgRectBounds){var mapOffsetX=fgRectBounds.getCenterX()-divBounds.getMinX();var mapOffsetY=fgRectBounds.getCenterY()-divBounds.getMinY();var fgRectGPos=this._oMapLocation.getGlobalPosFromMapPos(mapOffsetX,mapOffsetY);return fgRectGPos},setScaleControlOffset:function(){if(this._isOpen){if(this._mapScaleControl){this._mapScaleControl.setRightLength(130)}}else{if(this._mapScaleControl){this._mapScaleControl.setRightLength(20)}}},doToggle:function(){if(this._isOpen){this._isOpen=!this._isOpen;this._toggleImage.style.left="-19px";this._toggleImage.style.top="0px";this._div.style.width="17px";this._div.style.height="17px"}else{this._isOpen=!this._isOpen;var mapCenterGPos=this._mapLocation.getMapCenterGlobalPos();var zoom=this._mapLocation.getZoom()-4;this._oMap.zoomToMapCenter(mapCenterGPos,zoom);var mapLTGPos=this._mapLocation.getWindowLeftTopGlobalPos();var mapRBGPos=this._mapLocation.getWindowRightBottomGlobalPos();this._bgRect.setLeftTopGlobalPos(mapLTGPos);this._bgRect.setRightBottomGlobalPos(mapRBGPos);this._toggleImage.style.left="0px";this._toggleImage.style.top="0px";this._div.style.width=this._width+"px";this._div.style.height=this._height+"px";this._shadowLayer.initLayer();this.resetCurrectMapSizeRect()}this.setScaleControlOffset()},resetBGMap:function(){var mapLocation=this._map.getMapLocation();var mapLTGPos=mapLocation.getWindowLeftTopGlobalPos();var mapRBGPos=mapLocation.getWindowRightBottomGlobalPos();this._bgRect.setLeftTopGlobalPos(mapLTGPos);this._bgRect.setRightBottomGlobalPos(mapRBGPos);this._shadowLayer.initLayer()},resetCurrectMapSizeRect:function(offsetX,offsetY){if(!offsetX){offsetX=0}if(!offsetY){offsetY=0}var mapSize=this._map.getSize();var rectWidth=mapSize.width/16;var rectHeight=mapSize.height/16;this._rectFGDiv.style.width=rectWidth+"px";this._rectFGDiv.style.height=rectHeight+"px";this._rectFGDiv.style.left=(this._width/2-rectWidth/2+offsetX)+"px";this._rectFGDiv.style.top=(this._height/2-rectHeight/2+offsetY)+"px"},onMapMoving:function(){if(!this._isOpen){return}var mapLocation=this._map.getMapLocation();var mapCenterGPos=mapLocation.getMapCenterGlobalPos();this._oMap.movingToMapCenter(mapCenterGPos)},onMapMoved:function(){var mapLocation=this._map.getMapLocation();var mapCenterGPos=mapLocation.getMapCenterGlobalPos();this._oMap.movedToMapCenter(mapCenterGPos);this.resetBGMap();this.resetCurrectMapSizeRect()},onMapResize:function(){this._oMap.resetSize({"width":this._width,"height":this._height});if(!this._isOpen){return}this.resetBGMap();this.resetCurrectMapSizeRect()},onMapZoom:function(){if(!this._isOpen){return}var mapLocation=this._map.getMapLocation();var mapCenterGPos=mapLocation.getMapCenterGlobalPos();var zoom=mapLocation.getZoom()-4;this._oMap.zoomToMapCenter(mapCenterGPos,zoom);this.resetBGMap();this.resetCurrectMapSizeRect()},doMoving:function(offsetX,offsetY){this._movingOffsetX=offsetX;this._movingOffsetY=offsetY;var self=this;function offset(){self._layerContainer.movingMap(-self._movingOffsetX,-self._movingOffsetY)}if(!this._movingInterval){this._movingInterval=setInterval(offset,1)}},stopMoving:function(){if(this._movingInterval){clearInterval(this._movingInterval);this._movingInterval=null}},onMouseDown:function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}else{event.cancelBubble=true;event.returnValue=false;if(event.button!=1){return}}var pageX=utils.getPageX(event),pageY=utils.getPageY(event);var self=this;var draggingDiv=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var tx=utils.getPageX(event);var ty=utils.getPageY(event);self.resetCurrectMapSizeRect(tx-pageX,ty-pageY);var divBounds=self.getDivBounds();var fgBounds=self.getFGRectBounds();if(!divBounds.containBounds(fgBounds)){var offsetX=0,offsetY=0;if(fgBounds.getMinX()<divBounds.getMinX()){offsetX=-1}else{if(fgBounds.getMaxX()>divBounds.getMaxX()){offsetX=1}}if(fgBounds.getMinY()<divBounds.getMinY()){offsetY=-1}else{if(fgBounds.getMaxY()>divBounds.getMaxY()){offsetY=1}}if(offsetX!=0||offsetY!=0){self.doMoving(offsetX,offsetY)}else{self.stopMoving()}}else{self.stopMoving()}};var droppedDiv=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}utils.unbindEvent(document,"mousemove",draggingDiv);utils.unbindEvent(document,"mouseup",droppedDiv);var divBounds=self.getDivBounds();var bgBounds=self._bgRect.getPixelBounds();var fgBounds=self.getFGRectBounds();var fgRectCenterGPos=self.getFGRectCenterGPos(divBounds,fgBounds);if(divBounds.containBounds(fgBounds)){if(bgBounds.intersectBounds(fgBounds)){self._map.slidingToMapCenter(fgRectCenterGPos,function(){self.resetCurrectMapSizeRect()})}else{self._map.movedToMapCenter(fgRectCenterGPos);self.resetCurrectMapSizeRect()}}else{self.stopMoving();self._map.movedToMapCenter(fgRectCenterGPos);self.resetCurrectMapSizeRect()}};utils.bindEvent(document,"mousemove",draggingDiv);utils.bindEvent(document,"mouseup",droppedDiv)}};if(EXTEND){mapwork.utils.inherits(OverviewControl,EXTEND)}})();(function(){mapwork.MapChannelInfoControl=MapChannelInfoControl;MapChannelInfoControl.ID="MapChannelInfoControl";var EXTEND=mapwork.Control;function MapChannelInfoControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=MapChannelInfoControl.ID;this._div.style["zIndex"]=9800}MapChannelInfoControl.prototype={addItem:function(type,typeName,num,listener){},init:function(router){this._router=router;var jsonDate=this._router._currRouterLine._jsonData;var poiList=jsonDate["poi"];$(this._div).find(".ctrl_menu").empty();for(var i in poiList){var poi=poiList[i];var type=poi["type"];var typeName=poi["name"];var num=poi["items"].length;this._$Menu.append("		<li name='"+type+"'>"+"			<span class='itemCheck'></span>"+"			<span class='icon' style='background:url(images/"+type+".png)'></span>"+"			<span class='name'>"+typeName+"<span>"+"			<span class='number'>"+num+"个</span>"+"		</li>");if(num==0){this._$Menu.find("li:last").addClass("itemDisabled")}}var self=this;this._$Menu.find("li:not(.itemDisabled)").each(function(){$(this).hover(function(){$(this).addClass("on");$(this).find(".itemCheck").addClass("on")},function(){$(this).removeClass("on");$(this).find(".itemCheck").removeClass("on")});$(this).click(function(){$(this).find(".itemCheck").toggleClass("click");var isShow=false;if($(this).find(".itemCheck").hasClass("click")){isShow=true}self._router.showPOI($(this).attr("name"),isShow)})});this.show()},setMap:function(map){this._map=map;$(this._div).addClass("channelInfoControl");$(this._div).append("<div class='title'>途经信息</div>"+"<div class='content'>"+"	<ul class='ctrl_menu'>"+"	</ul>"+"	<div class='drop'>"+"		<img src='images/drapdown.png'/>"+"	</div>"+"</div>");var self=this;$(this._div).find(".title,.drop").click(function(){var img=$(self._div).find(".drop > img");var speed=250;if($(self._$Menu).css("display")!="none"){$(self._div).animate({width:"60px",height:"31px"},speed);self._$Menu.hide();img.attr("src","images/drapdown.png")}else{$(self._div).animate({width:"160px",height:"118px"},speed);self._$Menu.show(speed);img.attr("src","images/drapup.png")}});this._$Menu=$(this._div).find(".ctrl_menu")},show:function(){$(this._div).show()},hide:function(){$(this._div).hide()}};if(EXTEND){mapwork.utils.inherits(MapChannelInfoControl,EXTEND)}})();(function(){mapwork.RuleControl=RuleControl;RuleControl.ID="RuleControl";var EXTEND=mapwork.Control;function RuleControl(){if(EXTEND){EXTEND.apply(this,arguments)}this._controlId=RuleControl.ID;this._div.style["zIndex"]=9800}RuleControl.prototype={init:function(){this.show()},setMap:function(map){this._map=map},show:function(){$(this._div).show()},hide:function(){$(this._div).hide()}};if(EXTEND){mapwork.utils.inherits(RuleControl,EXTEND)}})();(function(){mapwork.MapElement=MapElement;var EXTEND=null;var ElementIndex1=0;var ElementIndex2=0;function MapElement(id){if(EXTEND){EXTEND.apply(this,arguments)}this._id=id;this._elementId=ElementIndex1+"_"+ElementIndex2;ElementIndex1++;if(ElementIndex1>100000000){ElementIndex2++;ElementIndex1=0}this._htmlObj=null}MapElement.prototype={getElementId:function(){return this._elementId},getId:function(){return this._id},getLayer:function(){return this._layer},setLayer:function(layer){this._layer=layer},isDisplayAtZoom:function(zoom){return true},getHtmlObj:function(){return this._htmlObj},doRemove:function(){if(this._layer){this._layer.removeElement(this)}},show:function(){this._htmlObj.style.display="block"},hide:function(){this._htmlObj.style.display="none"},updateMapPos:function(size,edgeLen,mapCenterGPos,layerOffsetPos){}};if(EXTEND){mapwork.utils.inherits(MapElement,EXTEND)}})();(function(){mapwork.MapLabel=MapLabel;var EXTEND=mapwork.MapElement;function MapLabel(id,label,pos,offsetPos){if(EXTEND){EXTEND.apply(this,arguments)}this._id=id;if(!offsetPos){offsetPos=[0,0]}else{this._offsetPos=offsetPos}this._div=document.createElement("div");this._div.style.position="absolute";this._div.style["whiteSpace"]="nowrap";this._div.style.border="1px solid #4C4C4C";this._div.style.padding="2px 7px";this._div.style["-webkit-box-shadow"]="rgb(160, 160, 160) 2px 2px 8px";this._div.style["box-shadow"]="rgb(160, 160, 160) 2px 2px 8px";this._div.style["lineHeight"]="15px";this._div.style["fontWeight"]="bold";this._div.style["backgroundColor"]="#FFF";this._div.style["borderRadius"]="5px";this._htmlObj=this._div;this._contentDiv=document.createElement("div");this._div.appendChild(this._contentDiv);this._labelSpan=document.createElement("span");this._labelSpan.style["backgroundColor"]="#FFF";this._labelSpan.style["fontSize"]="12px";this._labelSpan.style["cursor"]="default";this._contentDiv.appendChild(this._labelSpan);this.setName(label);if(pos){this.setPos(pos)}}MapLabel.prototype={setName:function(name){this._labelSpan.innerHTML=name},getName:function(){return this._labelSpan.innerHTML},setPos:function(pos){if(pos instanceof mapwork.EarthPos){var gPos=pos.convert2GlobalPos();if(gPos){this._gPos=gPos;this._ePos=pos}this._div.style.display="block"}else{if(pos instanceof mapwork.GlobalPos){var ePos=pos.convert2EarthPos();if(ePos){this._gPos=pos;this._ePos=ePos}this._div.style.display="block"}}},getEarthPos:function(){return this._ePos},getGlobalPos:function(){return this._gPos},updateMapPos:function(size,edgeLen,mapCenterGPos,layerOffsetPos){var px=size.width/2+edgeLen*(this._gPos.posX-mapCenterGPos.posX)-layerOffsetPos[0];var py=size.height/2+edgeLen*(this._gPos.posY-mapCenterGPos.posY)-layerOffsetPos[1];if(this._offsetPos){px+=this._offsetPos[0];py+=this._offsetPos[1]}this._div.style.left=px+"px";this._div.style.top=py+"px"}};if(EXTEND){mapwork.utils.inherits(MapLabel,EXTEND)}})();(function(){mapwork.MapIcon=MapIcon;var utils=mapwork.utils;var EXTEND=mapwork.MapElement;var maxIndex=100;function MapIcon(id,defaultIcon,hoverIcon,offsetPos,zIndex){if(EXTEND){EXTEND.apply(this,arguments)}this._zIndex=zIndex;this._defaultIcon=defaultIcon;this._hoverIcon=hoverIcon;this._offsetPos=offsetPos;this.init()}MapIcon.prototype={init:function(){this._htmlObj=document.createElement("img");this._htmlObj.style.position="absolute";this._htmlObj.style.cursor="pointer";this.setIcon(this._defaultIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=this._zIndex}},setIcon:function(icon){if(typeof icon==="string"){this._htmlObj.src=icon}else{if(icon instanceof mapwork.SpriteImage){icon.wrapImage(this._htmlObj)}}},setHoverImage:function(){this.setIcon(this._hoverIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=101}},setDefaultImage:function(){this.setIcon(this._defaultIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=this._zIndex}},setContent:function(content){this._content=content},getEarthPos:function(){return this._ePos},getGlobalPos:function(){return this._gPos},setEarthPos:function(ePos){if(ePos){var gPos=ePos.convert2GlobalPos();if(gPos){this._gPos=gPos;this._ePos=ePos}this._htmlObj.style.display="block"}},setPos:function(pos){if(pos instanceof mapwork.EarthPos){var gPos=pos.convert2GlobalPos();if(gPos){this._gPos=gPos;this._ePos=pos}this._htmlObj.style.display="block"}else{if(pos instanceof mapwork.GlobalPos){var ePos=pos.convert2EarthPos();if(ePos){this._gPos=pos;this._ePos=ePos}this._htmlObj.style.display="block"}}},updateMapPos:function(size,edgeLen,mapCenterGPos,layerOffsetPos){var px=size.width/2+edgeLen*(this._gPos.posX-mapCenterGPos.posX)-layerOffsetPos[0];var py=size.height/2+edgeLen*(this._gPos.posY-mapCenterGPos.posY)-layerOffsetPos[1];if(this._offsetPos){px-=this._offsetPos[0];py-=this._offsetPos[1]}this._htmlObjPos=[px,py];this._htmlObj.style.left=px+"px";this._htmlObj.style.top=py+"px"},setFocus:function(){this.setHoverImage()},clearFocus:function(){this.setDefaultImage()},doClickFocus:function(){},doFocus:function(){this.setHoverImage();this._htmlObj.style["zIndex"]=maxIndex},doDeFocus:function(){this.setDefaultImage();this._htmlObj.style["zIndex"]=0},addEventListener:function(eventType,listener,caller,obj){utils.bindEvent(this._htmlObj,eventType,function(event){listener.call(caller,event,obj)})}};if(EXTEND){mapwork.utils.inherits(MapIcon,EXTEND)}})();(function(){mapwork.MapDraggableIcon=MapDraggableIcon;var EXTEND=mapwork.MapIcon;var utils=mapwork.utils;function MapDraggableIcon(){if(EXTEND){EXTEND.apply(this,arguments)}this._bindDraggableEvent()}MapDraggableIcon.prototype={_bindDraggableEvent:function(){var self=this;mapwork.utils.bindEvent(this._htmlObj,"mousedown",function(event){self.onMouseDown(event)})},setDraggedFunc:function(draggedFunc){this._draggedFunc=draggedFunc},setShadowIcon:function(icon){this._shadowIcon=icon},onMouseDown:function(event){if(this._layer._map.getMode()!=0){return}this._pressX=utils.getPageX(event);this._pressY=utils.getPageY(event);if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}else{event.cancelBubble=true;event.returnValue=false;if(event.button!=1){return}}var self=this;this._isDragged=false;var draggingDiv=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var x=utils.getPageX(event);var y=utils.getPageY(event);self._isDragged=true;self._htmlObj.style.left=(self._htmlObjPos[0]+x-self._pressX)+"px";self._htmlObj.style.top=(self._htmlObjPos[1]+y-self._pressY)+"px";var shadowIcon=self._shadowIcon;if(shadowIcon){shadowIcon._htmlObj.style.left=(shadowIcon._htmlObjPos[0]+x-self._pressX)+"px";shadowIcon._htmlObj.style.top=(shadowIcon._htmlObjPos[1]+y-self._pressY)+"px"}};var droppedDiv=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}mapwork.utils.unbindEvent(document,"mousemove",draggingDiv);mapwork.utils.unbindEvent(document,"mouseup",droppedDiv);if(self._isDragged){var mapLocation=self._layer._map.getMapLocation();var edgeLen=mapLocation.getEdgeLen();var x=utils.getPageX(event);var y=utils.getPageY(event);var newGPosX=self._gPos.posX+(x-self._pressX)/edgeLen;var newGPosY=self._gPos.posY+(y-self._pressY)/edgeLen;var ePos=new mapwork.GlobalPos(newGPosX,newGPosY).convert2EarthPos();self.setEarthPos(ePos);self._htmlObjPos=[self._htmlObjPos[0]+x-self._pressX,self._htmlObjPos[1]+y-self._pressY];self._htmlObj.style.left=self._htmlObjPos[0]+"px";self._htmlObj.style.top=self._htmlObjPos[1]+"px";if(self._draggedFunc){self._draggedFunc.call(self,ePos)}}};mapwork.utils.bindEvent(document,"mousemove",draggingDiv);mapwork.utils.bindEvent(document,"mouseup",droppedDiv)}};if(EXTEND){mapwork.utils.inherits(MapDraggableIcon,EXTEND)}})();(function(){mapwork.MapShadowRect=MapShadowRect;var EXTEND=mapwork.MapElement;function MapShadowRect(){if(EXTEND){EXTEND.apply(this,arguments)}this._div=document.createElement("div");this._htmlObj=this._div;this._ltGPos=null;this._rbGPos=null}MapShadowRect.prototype={setStyle:function(style){if(style){for(var k in style){this._div.style[k]=style[k]}}},getLeftTopGlobalPos:function(){return this._ltGPos},setLeftTopGlobalPos:function(ltGPos){this._ltGPos=ltGPos},getRightBottomGlobalPos:function(){return this._rbGPos},setRightBottomGlobalPos:function(rbGPos){this._rbGPos=rbGPos},updateMapPos:function(size,edgeLen,mapCenterGPos,layerOffsetPos){if(this._ltGPos&&this._rbGPos){var p1x=size.width/2+edgeLen*(this._ltGPos.posX-mapCenterGPos.posX)-layerOffsetPos[0];var p1y=size.height/2+edgeLen*(this._ltGPos.posY-mapCenterGPos.posY)-layerOffsetPos[1];var p2x=size.width/2+edgeLen*(this._rbGPos.posX-mapCenterGPos.posX)-layerOffsetPos[0];var p2y=size.height/2+edgeLen*(this._rbGPos.posY-mapCenterGPos.posY)-layerOffsetPos[1];this._p1x=p1x;this._p1y=p1y;this._div.style.left=p1x+"px";this._div.style.top=p1y+"px";this._div.style.width=(p2x-p1x)+"px";this._div.style.height=(p2y-p1y)+"px"}},setPixelOffset:function(offsetX,offsetY){this._div.style.left=(this._p1x+offsetX)+"px";this._div.style.top=(this._p1y+offsetY)+"px"},getPixelBounds:function(){var $Div=$(this._div);var offset=$Div.offset();var width=$Div.width();var height=$Div.height();return new mapwork.Bounds(offset.left,offset.top,offset.left+width,offset.top+height)}};if(EXTEND){mapwork.utils.inherits(MapShadowRect,EXTEND)}})();(function(){mapwork.MapIconLabel=MapIconLabel;var EXTEND=mapwork.MapIcon;function MapIconLabel(id,defaultIcon,hoverIcon,imageOffset,zIndex){if(EXTEND){EXTEND.apply(this,arguments)}this.init()}MapIconLabel.prototype={init:function(){this._htmlObj=document.createElement("div");this._htmlObj.style.position="absolute";this._htmlObj.style["textAlign"]="center";this._image=document.createElement("img");this._htmlObj.appendChild(this._image);this._labelDiv=document.createElement("p");this._labelDiv.style["backgroundColor"]="#FFF";this._labelDiv.style["fontSize"]="12px";this._labelDiv.style["cursor"]="default";this._htmlObj.appendChild(this._labelDiv);this.setIcon(this._defaultIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=this._zIndex}},setIcon:function(icon){if(typeof icon==="string"){this._image.src=icon}else{if(icon instanceof mapwork.SpriteImage){icon.wrapImage(this._image)}}},setLabel:function(label){this._labelDiv.innerHTML=label},setHoverImage:function(){this.setIcon(this._hoverIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=101}this._labelDiv.style["fontWeight"]="bold"},setDefaultImage:function(){this.setIcon(this._defaultIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=this._zIndex}this._labelDiv.style["fontWeight"]="normal"}};if(EXTEND){mapwork.utils.inherits(MapIconLabel,EXTEND)}})();(function(){mapwork.MapTip=MapTip;var tipHtml='<div class="tips_jt" id="tips_jt"><img src="images/bg_tips_04.png" class="png"></div>'+'<div class="tips_box">'+'<div class="tips_top"></div>'+'<div class="tips_close" id="tips_close"><img src="images/tips_close_02.gif"></div>'+'<div class="tips_main">'+'<div class="tips_content">'+"</div>"+'<div class="tips_tail">'+"</div>"+"</div>";var EXTEND=mapwork.MapElement;function MapTip(map){if(EXTEND){EXTEND.apply(this,arguments)}this._map=map;this._tipDiv=document.createElement("div");this._tipDiv.className="tips_02";this._tipDiv.id="tips_02";this._tipDiv.style.display="none";this._htmlObj=this._tipDiv;mapwork.utils.bindEvent(this._tipDiv,"mousedown",function(event){if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}})}MapTip.prototype={setTrigger:function(mapElement){this._trigger=mapElement},getTrigger:function(){return this._trigger},open:function(ePos,name,contentDiv,tailDiv,offsetTop,closeCallback){this._tipDiv.style.display="none";if(!ePos){return}this._closeCallback=closeCallback;this._offsetTop=offsetTop;if(!this._offsetTop){this._offsetTop=0}if(!this._isInit){this.initTip()}if(!this._shadowIcon){this.initShadow()}this._tipEPos=ePos;this._tipGPos=ePos.convert2GlobalPos();this._$TipTop.empty();if(name){this._$TipTop.append(name)}this._$TipContent.empty();if(contentDiv){this._$TipContent.append(contentDiv)}this._$TipTail.empty();if(tailDiv){this._$TipTail.append(tailDiv)}this._tipDiv.style.display="block";this.showShadow();this._layer.resetElement(this);this.fitWindow()},fitWindow:function(){var mapLocation=this._map.getMapLocation();var size=this._map.getSize();var mapBounds=mapLocation.getWindowPixelBounds();var tipPos=this.getTipPixelPos();var tipBounds=this.getTipBounds();if(mapBounds.containBounds(tipBounds)){}else{mapBounds.expandBy(200,200);if(mapBounds.containPoint(tipPos[0],tipPos[1])){var mapCenterX=mapBounds.getCenterX();var mapCenterY=mapBounds.getCenterY();if(tipBounds.getHeight()>size.height/2){tipPos[1]-=tipBounds.getHeight()-size.height/2+5}var offsetX=mapCenterX-tipPos[0];var offsetY=mapCenterY-tipPos[1];var stepNum=50;var stepX=offsetX/stepNum;var stepY=offsetY/stepNum;var layerContainer=this._map.getLayerContainer();var index=0;function offset(){layerContainer.movedMap(stepX,stepY);index++;if(index>=stepNum){if(interval){clearInterval(interval);interval=null}}}var interval=setInterval(offset,1)}else{var flyToGPos=this._tipGPos;if(tipBounds.getHeight()>size.height/2){var gPosX=flyToGPos.getPosX();var gPosY=flyToGPos.getPosY();var edgeLen=mapLocation.getEdgeLen();gPosY-=(tipBounds.getHeight()-size.height/2+5)/edgeLen;flyToGPos=new mapwork.GlobalPos(gPosX,gPosY)}this._map.movedToMapCenter(flyToGPos)}}},initShadow:function(){var id="shadow";var iconUrl="images/bg_tips_03.png";var hoverIconUrl=null;var iconOffset=[190,172+this._offsetTop];this._shadowIcon=new mapwork.MapIcon(id,iconUrl,hoverIconUrl,iconOffset);this._mapShadowLayer=this._map.getLayer(mapwork.MapShadowLayer.ID);this._mapShadowLayer.addElement(this._shadowIcon)},showShadow:function(){if(this._tipEPos){this._shadowIcon.setEarthPos(this._tipEPos);this._shadowIcon.show();this._mapShadowLayer.initLayer()}},initTip:function(){this._isInit=true;this._tipDiv.innerHTML=tipHtml;this._$TipTop=$(this._tipDiv).find(".tips_top");this._$TipContent=$(this._tipDiv).find(".tips_content");this._$TipTail=$(this._tipDiv).find(".tips_tail");var self=this;$("#tips_close").click(function(event){self.doHide();if(self._closeCallback){self._closeCallback.call()}})},getTipBounds:function(){var tipWidth=this._tipDiv.clientWidth;var tipHeight=this._tipDiv.clientHeight;var mapLocation=this._map.getMapLocation();var edgeLen=mapLocation.getEdgeLen();var tipPixelX=edgeLen*this._tipGPos.posX;var tipPixelY=edgeLen*this._tipGPos.posY;var x1=tipPixelX-182;var x2=tipPixelX-182+tipWidth;var y1=tipPixelY-tipHeight-this._offsetTop;var y2=tipPixelY;return new mapwork.Bounds(x1,y1,x2,y2)},getTipPixelPos:function(){var mapLocation=this._map.getMapLocation();var edgeLen=mapLocation.getEdgeLen();var tipPixelX=edgeLen*this._tipGPos.posX;var tipPixelY=edgeLen*this._tipGPos.posY;return[tipPixelX,tipPixelY]},doHide:function(){if(this._shadowIcon){this._tipDiv.style.display="none";this._shadowIcon.hide()}},isDisplay:function(){return this._tipDiv.style.display!="none"},updateMapPos:function(size,edgeLen,mapCenterGPos,layerOffsetPos){if(this._tipGPos){var tipHeight=this._tipDiv.clientHeight;var px=size.width/2+edgeLen*(this._tipGPos.posX-mapCenterGPos.posX)-layerOffsetPos[0]-182;var py=size.height/2+edgeLen*(this._tipGPos.posY-mapCenterGPos.posY)-layerOffsetPos[1]-tipHeight-this._offsetTop;this._tipDiv.style.left=px+"px";this._tipDiv.style.top=py+"px"}}};if(EXTEND){mapwork.utils.inherits(MapTip,EXTEND)}})();(function(){mapwork.MapPath=MapPath;var EXTEND=mapwork.MapElement;function MapPath(id){if(EXTEND){EXTEND.apply(this,arguments)}if(mapwork.supportSVG){this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this._svg.style.zIndex=1;this._svg.style.position="absolute";this._svg.setAttribute("version","1.1");this._svg.setAttribute("type","system");this._svg.setAttribute("baseProfile","full");this._svg.setAttribute("pointer-events","none");this._htmlObj=this._svg;this._element=document.createElementNS("http://www.w3.org/2000/svg","path");this._element.setAttribute("stroke-width",4);this._element.setAttribute("stroke-dasharray","solid");this._element.setAttribute("stroke-linejoin","round");this._element.setAttribute("stroke-linecap","round");this._element.setAttribute("stroke","#0099ff");this._element.setAttribute("fill","none");this._element.setAttribute("pointer-events","auto");this._element.setAttribute("stroke-opacity","1.0");this._svg.appendChild(this._element)}else{this._element=document.createElement("v:shape");this._element.style.zIndex=1;this._element.style.position="absolute";this._element.style.top="0px";this._element.style.left="0px";this._element.style.width="1000px";this._element.style.height="1000px";this._element.strokeWeight="4px";this._element.strokeColor="#0099ff";this._element.filled="false";this._elementStroke=document.createElement("v:stroke");this._elementStroke.endcap="round";this._element.appendChild(this._elementStroke);this._htmlObj=this._element}this._ePosList=[];this._gPosList=[]}MapPath.prototype={setZIndex:function(zIndex){if(mapwork.supportSVG){this._svg.style.zIndex=zIndex}else{this._element.style.zIndex=zIndex}},setDash:function(dash){if(mapwork.supportSVG){this._element.setAttribute("stroke-dasharray",dash)}else{this._elementStroke.dashstyle="ShortDash"}},setWidth:function(width){if(mapwork.supportSVG){this._element.setAttribute("stroke-width",width)}else{this._element.strokeWeight=width+"px"}},setOpacity:function(opacity){if(mapwork.supportSVG){this._element.setAttribute("stroke-opacity",opacity)}else{this._elementStroke.opacity=opacity}},setColor:function(color){if(mapwork.supportSVG){this._element.setAttribute("stroke",color)}else{this._element.strokeColor=color}},setSVGAttr:function(key,value){this._svg.setAttribute(key,value)},setSVGElementAttr:function(key,value){this._element.setAttribute(key,value)},addPos:function(pos){if(pos instanceof mapwork.EarthPos){this._ePosList.push(pos);this._gPosList.push(pos.convert2GlobalPos())}else{if(pos instanceof mapwork.GlobalPos){this._gPosList.push(pos);this._ePosList.push(pos.convert2EarthPos())}}},setEPosArray:function(ePosArray){this._ePosList=[];this._gPosList=[];this._ePosList=ePosArray;for(var k in ePosArray){var ePos=ePosArray[k];this._gPosList.push(ePos.convert2GlobalPos())}},setGPosArray:function(gPosArray){this._ePosList=[];this._gPosList=[];this._gPosList=gPosArray;for(var k in gPosArray){var gPos=gPosArray[k];this._ePosList.push(gPos.convert2EarthPos())}},clearPosList:function(){this._ePosList=[];this._gPosList=[]},getPosCount:function(){return this._ePosList.length},changeLastPos:function(pos){if(this._ePosList.length>0){this._gPosList.pop();if(pos instanceof mapwork.EarthPos){this._ePosList.push(pos);this._gPosList.push(pos.convert2GlobalPos())}else{if(pos instanceof mapwork.GlobalPos){this._gPosList.push(pos);this._ePosList.push(pos.convert2EarthPos())}}}},getCanvas:function(){return this._svg},updateMapPos:function(size,edgeLen,mapCenterGPos,layerOffsetPos){var ss,k,px,py,gPos;var bounds=new mapwork.Bounds();if(mapwork.supportSVG){ss="M";for(k in this._gPosList){gPos=this._gPosList[k];px=size.width/2+edgeLen*(gPos.posX-mapCenterGPos.posX)-layerOffsetPos[0];py=size.height/2+edgeLen*(gPos.posY-mapCenterGPos.posY)-layerOffsetPos[1];bounds.expandToIncludePoint(px,py);if(k>0){ss+=" "}ss+=px+","+py}this._svg.style.left=(bounds.getMinX()-20)+"px";this._svg.style.top=(bounds.getMinY()-20)+"px";this._svg.style.width=(bounds.getWidth()+40)+"px";this._svg.style.height=(bounds.getHeight()+40)+"px";this._svg.setAttribute("viewBox",""+(bounds.getMinX()-20)+" "+(bounds.getMinY()-20)+" "+(bounds.getWidth()+40)+" "+(bounds.getHeight()+40));if(ss.length<=1){ss+="0,0"}this._element.setAttribute("d",ss)}else{ss="";for(i=0;i<this._gPosList.length;i++){gPos=this._gPosList[i];px=Math.round(1*size.width/2+edgeLen*(gPos.posX-mapCenterGPos.posX)-layerOffsetPos[0]);py=Math.round(1*size.height/2+edgeLen*(gPos.posY-mapCenterGPos.posY)-layerOffsetPos[1]);if(i==0){ss+="m "+px+","+py}else{if(i==1){ss+=" l "+px+","+py}else{ss+=","+px+","+py}}}this._element.path=ss}}};if(EXTEND){mapwork.utils.inherits(MapPath,EXTEND)}})();(function(){mapwork.MapCircle=MapCircle;var EXTEND=mapwork.MapElement;function MapCircle(id){if(EXTEND){EXTEND.apply(this,arguments)}if(mapwork.supportSVG){this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this._svg.style.zIndex=1;this._svg.style.position="absolute";this._svg.setAttribute("version","1.1");this._svg.setAttribute("type","system");this._svg.setAttribute("baseProfile","full");this._svg.setAttribute("pointer-events","none");this._htmlObj=this._svg;this._element=document.createElementNS("http://www.w3.org/2000/svg","circle");this._element.setAttribute("stroke-width",4);this._element.setAttribute("stroke-dasharray","solid");this._element.setAttribute("stroke-linejoin","round");this._element.setAttribute("stroke-linecap","round");this._element.setAttribute("stroke","#0099ff");this._element.setAttribute("fill","red");this._element.setAttribute("pointer-events","auto");this._element.setAttribute("stroke-opacity",1);this._element.setAttribute("fill-opacity",1.2);this._svg.appendChild(this._element)}else{this._element=document.createElement("v:oval");this._element.style.zIndex=1;this._element.style.position="absolute";this._element.strokeWeight="4px";this._element.strokeColor="#0099ff";this._element.filled="true";this._element.fillColor="red";this._elementStroke=document.createElement("v:stroke");this._elementStroke.endcap="round";this._element.appendChild(this._elementStroke);this._elementFill=document.createElement("v:fill");this._elementFill.endcap="round";this._element.appendChild(this._elementFill);this._htmlObj=this._element}this._gCenterPos=null;this._eCenterPos=null;this._gEdgePos=null;this._eEdgePos=null;this._radius=0}MapCircle.prototype={setZIndex:function(zIndex){if(mapwork.supportSVG){this._svg.style.zIndex=zIndex}else{this._element.style.zIndex=zIndex}},setDash:function(dash){if(mapwork.supportSVG){this._element.setAttribute("stroke-dasharray",dash)}else{this._elementStroke.dashstyle="ShortDash"}},setWidth:function(width){if(mapwork.supportSVG){this._element.setAttribute("stroke-width",width)}else{this._element.strokeWeight=width+"px"}},setStrokeOpacity:function(opacity){if(mapwork.supportSVG){this._element.setAttribute("stroke-opacity",opacity)}else{this._elementStroke.opacity=opacity}},setFillOpacity:function(opacity){if(mapwork.supportSVG){this._element.setAttribute("fill-opacity",opacity)}else{this._elementFill.opacity=opacity}},setFillColor:function(color){if(mapwork.supportSVG){this._element.setAttribute("fill",color)}else{this._element.fill=color}},setColor:function(color){if(mapwork.supportSVG){this._element.setAttribute("stroke",color)}else{this._element.strokeColor=color}},setSVGAttr:function(key,value){this._svg.setAttribute(key,value)},setSVGElementAttr:function(key,value){this._element.setAttribute(key,value)},setCenterPos:function(pos){if(!pos){this._eCenterPos=null;this._gCenterPos=null}else{if(pos instanceof mapwork.EarthPos){this._eCenterPos=pos;this._gCenterPos=pos.convert2GlobalPos()}else{if(pos instanceof mapwork.GlobalPos){this._gCenterPos=pos;this._eCenterPos=pos.convert2EarthPos()}}}},getECenterPos:function(){return this._eCenterPos},setEdgePos:function(pos){if(!pos){this._eEdgePos=null;this._gEdgePos=null}else{if(pos instanceof mapwork.EarthPos){this._eEdgePos=pos;this._gEdgePos=pos.convert2GlobalPos()}else{if(pos instanceof mapwork.GlobalPos){this._gEdgePos=pos;this._eEdgePos=pos.convert2EarthPos()}}}},getEEdgePos:function(){return this._eEdgePos},setRadius:function(length){this._gEdgePos=null;this._eEdgePos=null;this._radius=length},getRadius:function(){return this._radius},clearPos:function(){this._gCenterPos=null;this._eCenterPos=null;this._gEdgePos=null;this._eEdgePos=null},getCanvas:function(){return this._svg},updateMapPos:function(size,edgeLen,mapCenterGPos,layerOffsetPos){var cx,cy,ex,ey,r;if(!this._gEdgePos){var offsetLon=mapwork.MapRulerBuilder.getOffsetLon4RangeLength(this._eCenterPos,this._radius);if(offsetLon){this._eEdgePos=new mapwork.EarthPos(this._eCenterPos.getILat(),this._eCenterPos.getILon()+offsetLon,true);this._gEdgePos=this._eEdgePos.convert2GlobalPos()}}if(!this._gEdgePos){return}var bounds=new mapwork.Bounds();cx=size.width/2+edgeLen*(this._gCenterPos.posX-mapCenterGPos.posX)-layerOffsetPos[0];cy=size.height/2+edgeLen*(this._gCenterPos.posY-mapCenterGPos.posY)-layerOffsetPos[1];ex=size.width/2+edgeLen*(this._gEdgePos.posX-mapCenterGPos.posX)-layerOffsetPos[0];ey=size.height/2+edgeLen*(this._gEdgePos.posY-mapCenterGPos.posY)-layerOffsetPos[1];r=Math.sqrt((cx-ex)*(cx-ex)+(cy-ey)*(cy-ey));if(mapwork.supportSVG){bounds.expandToIncludePoint(cx-r,cy-r);bounds.expandToIncludePoint(cx+r,cy+r);this._element.setAttribute("cx",cx);this._element.setAttribute("cy",cy);this._element.setAttribute("r",r);this._svg.style.left=(bounds.getMinX()-20)+"px";this._svg.style.top=(bounds.getMinY()-20)+"px";this._svg.style.width=(bounds.getWidth()+40)+"px";this._svg.style.height=(bounds.getHeight()+40)+"px";this._svg.setAttribute("viewBox",""+(bounds.getMinX()-20)+" "+(bounds.getMinY()-20)+" "+(bounds.getWidth()+40)+" "+(bounds.getHeight()+40))}else{this._element.style.left=(cx-r)+"px";this._element.style.top=(cy-r)+"px";this._element.style.width=(r*2)+"px";this._element.style.height=(r*2)+"px"}}};if(EXTEND){mapwork.utils.inherits(MapCircle,EXTEND)}})();(function(){mapwork.MapSearchCircle=MapSearchCircle;var EXTEND=mapwork.MapCircle;function MapSearchCircle(){if(EXTEND){EXTEND.apply(this,arguments)}if(mapwork.supportSVG){this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg");this._svg.style.zIndex=1;this._svg.style.position="absolute";this._svg.setAttribute("version","1.1");this._svg.setAttribute("type","system");this._svg.setAttribute("baseProfile","full");this._svg.setAttribute("pointer-events","none");this._htmlObj=this._svg;this._element=document.createElementNS("http://www.w3.org/2000/svg","circle");this._element.setAttribute("stroke-width",4);this._element.setAttribute("stroke-dasharray","solid");this._element.setAttribute("stroke-linejoin","round");this._element.setAttribute("stroke-linecap","round");this._element.setAttribute("stroke","#0099ff");this._element.setAttribute("fill","red");this._element.setAttribute("pointer-events","auto");this._element.setAttribute("stroke-opacity",1);this._element.setAttribute("fill-opacity",1.2);this._svg.appendChild(this._element)}else{this._element=document.createElement("v:oval");this._element.style.zIndex=1;this._element.style.position="absolute";this._element.strokeWeight="4px";this._element.strokeColor="#0099ff";this._element.filled="true";this._element.fillColor="red";this._elementStroke=document.createElement("v:stroke");this._elementStroke.endcap="round";this._element.appendChild(this._elementStroke);this._elementFill=document.createElement("v:fill");this._elementFill.endcap="round";this._element.appendChild(this._elementFill);this._htmlObj=this._element}var self=this;mapwork.utils.bindEvent(this._element,"mousedown",function(event){self.onMouseDown(event)})}MapSearchCircle.prototype={updateMapPos:function(size,edgeLen,mapCenterGPos,layerOffsetPos){var cx,cy,ex,ey,r;if(!this._gEdgePos){var offsetLon=mapwork.MapRulerBuilder.getOffsetLon4RangeLength(this._eCenterPos,this._radius);if(offsetLon){this._eEdgePos=new mapwork.EarthPos(this._eCenterPos.getILat(),this._eCenterPos.getILon()+offsetLon,true);this._gEdgePos=this._eEdgePos.convert2GlobalPos()}}if(!this._gEdgePos){return}var bounds=new mapwork.Bounds();cx=size.width/2+edgeLen*(this._gCenterPos.posX-mapCenterGPos.posX)-layerOffsetPos[0];cy=size.height/2+edgeLen*(this._gCenterPos.posY-mapCenterGPos.posY)-layerOffsetPos[1];ex=size.width/2+edgeLen*(this._gEdgePos.posX-mapCenterGPos.posX)-layerOffsetPos[0];ey=size.height/2+edgeLen*(this._gEdgePos.posY-mapCenterGPos.posY)-layerOffsetPos[1];r=Math.sqrt((cx-ex)*(cx-ex)+(cy-ey)*(cy-ey));if(mapwork.supportSVG){bounds.expandToIncludePoint(cx-r,cy-r);bounds.expandToIncludePoint(cx+r,cy+r);this._element.setAttribute("cx",cx);this._element.setAttribute("cy",cy);this._element.setAttribute("r",r);this._svg.style.left=(bounds.getMinX()-20)+"px";this._svg.style.top=(bounds.getMinY()-20)+"px";this._svg.style.width=(bounds.getWidth()+40)+"px";this._svg.style.height=(bounds.getHeight()+40)+"px";this._svg.setAttribute("viewBox",""+(bounds.getMinX()-20)+" "+(bounds.getMinY()-20)+" "+(bounds.getWidth()+40)+" "+(bounds.getHeight()+40))}else{this._element.style.left=(cx-r)+"px";this._element.style.top=(cy-r)+"px";this._element.style.width=(r*2)+"px";this._element.style.height=(r*2)+"px"}},onMouseDown:function(event){var map=this._layer.getMap();map.setMode(2);if(event.stopPropagation){event.stopPropagation();event.preventDefault();if(event.button!=0){return}}else{event.cancelBubble=true;event.returnValue=false;if(event.button!=1){return}}var self=this;var tx0=mapwork.utils.getPageX(event),ty0=mapwork.utils.getPageY(event);var bakCenterGPosX=self._gCenterPos.posX,bakCenterGPosY=self._gCenterPos.posY;var edgeLen=map.getMapLocation().getEdgeLen();var draggingDiv=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}var tx=mapwork.utils.getPageX(event);var ty=mapwork.utils.getPageY(event);var newX=bakCenterGPosX+(tx-tx0)/edgeLen;var newY=bakCenterGPosY+(ty-ty0)/edgeLen;self.setCenterPos(new mapwork.GlobalPos(newX,newY));self.setEdgePos(null);self._layer.resetElement(self)};var droppedDiv=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}mapwork.utils.unbindEvent(document,"mousemove",draggingDiv);mapwork.utils.unbindEvent(document,"mouseup",droppedDiv);map.setMode(0)};mapwork.utils.bindEvent(document,"mousemove",draggingDiv);mapwork.utils.bindEvent(document,"mouseup",droppedDiv)}};if(EXTEND){mapwork.utils.inherits(MapSearchCircle,EXTEND)}})();(function(){mapwork.MeasureLabel=MeasureLabel;var EXTEND=mapwork.MapLabel;function MeasureLabel(id,label,pos,offsetPos,measureLine){if(EXTEND){EXTEND.apply(this,arguments)}this._measureLine=measureLine}MeasureLabel.prototype={setFirst:function(){this.setName("\u8d77\u70b9");this._div.style.color="#0A0"},setLast:function(){this.setName("\u603b\u957f:"+this.getName());this._div.style.color="#f00";var deleteImage=document.createElement("img");deleteImage.style.cursor="pointer";deleteImage.style.width="10px";deleteImage.style.height="10px";deleteImage.style["verticalAlign"]="top";deleteImage.style["marginLeft"]="3px";deleteImage.style["marginTop"]="2px";deleteImage.src="images/measuredelete.png";deleteImage.title="\u5220\u9664\u6b64\u7ebf";this._contentDiv.appendChild(deleteImage);var self=this;deleteImage.onclick=function(){self._measureLine.doRemove.call(self._measureLine)}}};if(EXTEND){mapwork.utils.inherits(MeasureLabel,EXTEND)}})();(function(){mapwork.MeasureLine=MeasureLine;MeasureLine.INDEX=0;var EXTEND=mapwork.MapPath;function MeasureLine(map){if(EXTEND){EXTEND.apply(this,arguments)}this._map=map;this._id="Measure"+MeasureLine.INDEX++;this._iconLayer=this._map.getLayer(mapwork.MapIconLayer.ID);this._labelLayer=this._map.getLayer(mapwork.MapLabelLayer.ID);this._vectorLayer=this._map.getLayer(mapwork.MapVectorLayer.ID);this.setWidth(3);this.setOpacity(0.5);this.setColor("#f00");this._vectorLayer.addElement(this);this._mapIconStore={};this._mapLabelStore={};this._length=0}MeasureLine.prototype={createIconId:function(){return this._id+"_I"+this.getPosCount()},createLabelId:function(){return this._id+"_L"+this.getPosCount()},addPos:function(pos){if(pos instanceof mapwork.EarthPos){this._ePosList.push(pos);this._gPosList.push(pos.convert2GlobalPos())}else{if(pos instanceof mapwork.GlobalPos){this._gPosList.push(pos);this._ePosList.push(pos.convert2EarthPos())}}this._vectorLayer.resetElement(this)},clearPosList:function(){this._ePosList=[];this._gPosList=[];this._vectorLayer.resetElement(this)},removeLastPos:function(){var posCount=this.getPosCount();if(posCount>0){var lastIconId=this.createIconId();var mapIcon=this._mapIconStore[lastIconId];this._iconLayer.removeElement(mapIcon);delete this._mapIconStore[lastIconId];var lastLabelId=this.createLabelId();var mapLabel=this._mapLabelStore[lastLabelId];this._labelLayer.removeElement(mapLabel);delete this._mapLabelStore[lastLabelId];this._ePosList.pop();this._gPosList.pop()}},changeLastPos:function(pos){if(this._ePosList.length>0){this._ePosList.pop();this._gPosList.pop();if(pos instanceof mapwork.EarthPos){this._ePosList.push(pos);this._gPosList.push(pos.convert2GlobalPos())}else{if(pos instanceof mapwork.GlobalPos){this._gPosList.push(pos);this._ePosList.push(pos.convert2EarthPos())}}}this._vectorLayer.resetElement(this)},addMeasurePos:function(pos,isLast){this.addPos(pos);var posCount=this.getPosCount();if(posCount>1){var ePosY=this._ePosList[posCount-2];var ePosZ=this._ePosList[posCount-1];this._length+=mapwork.gisUtils.getMeterLength(ePosY,ePosZ)}var id=this.createIconId();var mapIcon=new mapwork.MapIcon(id,"images/measurepoint.png",null,[5.5,5.5]);this._mapIconStore[id]=mapIcon;mapIcon.setPos(pos);this._iconLayer.addElement(mapIcon);this._iconLayer.resetElement(mapIcon);id=this.createLabelId();var labelName=mapwork.gisUtils.getDisplayLength(this._length);var mapLabel=new mapwork.MeasureLabel(id,labelName,pos,[10,-10],this);if(posCount==1){mapLabel.setFirst()}this._mapLabelStore[id]=mapLabel;this._labelLayer.addElement(mapLabel);this._labelLayer.resetElement(mapLabel)},changeLastMeasurePos:function(pos){this.changeLastPos(pos)},doStop:function(){if(this._length<=0){this.doRemove()}else{var lastLabelId=this.createLabelId();var measureLabel=this._mapLabelStore[lastLabelId];if(measureLabel){measureLabel.setLast()}}},doRemove:function(){this._vectorLayer.removeElement(this);for(var k in this._mapIconStore){this._mapIconStore[k].doRemove()}this._mapIconStore={};for(k in this._mapLabelStore){this._mapLabelStore[k].doRemove()}this._mapLabelStore={}}};if(EXTEND){mapwork.utils.inherits(MeasureLine,EXTEND)}})();(function(){mapwork.TileLayer=TileLayer;TileLayer.ID="tileLayer";var EXTEND=mapwork.Layer;var TileStore=mapwork.TileStore;function TileLayer(layerId){if(EXTEND){EXTEND.apply(this,arguments)}if(layerId){this._layerId=layerId}else{this._layerId=TileLayer.ID}if(typeof this._layerId==="string"){this._div.className=this._layerId}this._div.style["zIndex"]=0;this._urlPath=mapwork.configs[this._layerId+"_url"]+"&dataset="+mapwork.mapStyle;this._grid=[]}function resetColumn(tileLayer,mapCenter,mapZoom,edgeLen,size){var grid=tileLayer._grid;var tile,newX,i,theRow;var viewTileX1=Math.floor((mapCenter.posX*edgeLen-size.width/2)/256);var viewTileX2=Math.floor((mapCenter.posX*edgeLen+size.width/2)/256);var row=grid[0];if(!row){return}var tileA=row[0];while(viewTileX1<tileA._tileX){newX=tileA._tileX-1;for(i=0;i<grid.length;i++){theRow=grid[i];tile=theRow.pop();tile.destroy();tile=TileStore.getImageTile();var posX=theRow[0]._left-256;var posY=theRow[0]._top;tile.addToLayer(tileLayer,newX,theRow[0]._tileY,mapZoom,posX,posY);tile.draw();theRow.unshift(tile)}tileA=row[0]}var tileZ=row[row.length-1];while(viewTileX2>tileZ._tileX){newX=tileZ._tileX+1;for(i=0;i<grid.length;i++){theRow=grid[i];tile=theRow.shift();tile.destroy();tile=TileStore.getImageTile();posX=theRow[theRow.length-1]._left+256;posY=theRow[theRow.length-1]._top;tile.addToLayer(tileLayer,theRow[theRow.length-1]._tileX+1,theRow[theRow.length-1]._tileY,mapZoom,posX,posY);tile.draw();theRow.push(tile)}tileZ=row[row.length-1]}}function resetRow(tileLayer,mapCenter,mapZoom,edgeLen,size){var row,tile,i,posX,posY;var grid=tileLayer._grid;var viewTileY1=Math.floor((mapCenter.posY*edgeLen-size.height/2)/256);var viewTileY2=Math.floor((mapCenter.posY*edgeLen+size.height/2)/256);var rowA=grid[0];while(viewTileY1<rowA[0]._tileY){row=grid.pop();grid.unshift(row);var colsNum=row.length;for(i=0;i<colsNum;i++){row[i].destroy();tile=TileStore.getImageTile();posX=rowA[i]._left;posY=rowA[i]._top-256;tile.addToLayer(tileLayer,rowA[i]._tileX,rowA[i]._tileY-1,mapZoom,posX,posY);tile.draw();row[i]=tile}rowA=grid[0]}var rowZ=grid[grid.length-1];while(viewTileY2>rowZ[0]._tileY){row=grid.shift();grid.push(row);for(i=0;i<row.length;i++){row[i].destroy();tile=TileStore.getImageTile();posX=rowZ[i]._left;posY=rowZ[i]._top+256;tile.addToLayer(tileLayer,rowZ[i]._tileX,rowZ[i]._tileY+1,mapZoom,posX,posY);tile.draw();row[i]=tile}rowZ=grid[grid.length-1]}}TileLayer.prototype={setMap:function(map){this._map=map;this._mapLocation=this._map.getMapLocation()},getMapZoom:function(){return this._mapLocation.getZoom()},getMapCenterGlobalPos:function(){return this._mapLocation.getMapCenterGlobalPos()},getEdgeNum:function(){return this._mapLocation.getEdgeNum()},getEdgeLen:function(){return this._mapLocation.getEdgeLen()},getSize:function(){return this._map.getSize()},initLayer:function(){this.resetLayer()},resetLayer:function(){var row,tile;while(this._grid.length>0){row=this._grid.pop();while(row.length>0){tile=row.pop();if(tile){tile.destroy()}}}var mapZoom=this.getMapZoom();var mapCenterGPos=this.getMapCenterGlobalPos();var edgeNum=this.getEdgeNum();var edgeLen=this.getEdgeLen();var size=this.getSize();if(size.width<=0||size.height<=0){return}var centerTileEdgeX=edgeNum*mapCenterGPos.posX;var centerTileEdgeY=edgeNum*mapCenterGPos.posY;var centerTileX=Math.floor(centerTileEdgeX);var centerTileY=Math.floor(centerTileEdgeY);var centerPosX=size.width/2+0.05;var centerPosY=size.height/2+0.05;var tileX1=Math.floor((mapCenterGPos.posX*edgeLen-size.width/2)/256);var tileY1=Math.floor((mapCenterGPos.posY*edgeLen-size.height/2)/256);var tileX2=Math.ceil((mapCenterGPos.posX*edgeLen+size.width/2)/256);var tileY2=Math.ceil((mapCenterGPos.posY*edgeLen+size.height/2)/256);var rectLocateX=parseInt((centerTileEdgeX-centerTileX)*256);var rectLocateY=parseInt((centerTileEdgeY-centerTileY)*256);var centerTilePosX=centerPosX-rectLocateX;var centerTilePosY=centerPosY-rectLocateY;this._rows=tileY2-tileY1+1;this._cols=tileX2-tileX1+1;for(var r=0;r<this._rows;r++){row=[];this._grid.push(row);for(var c=0;c<this._cols;c++){tile=TileStore.getImageTile();row.push(tile);var posX=centerTilePosX+256*(c+tileX1-centerTileX);var posY=centerTilePosY+256*(r+tileY1-centerTileY);tile.addToLayer(this,c+tileX1,r+tileY1,mapZoom,posX,posY);tile.draw()}}},draggedLayer:function(gPos){var mapZoom=this.getMapZoom();var mapCenterGPos=null;if(gPos){mapCenterGPos=gPos}else{mapCenterGPos=this.getMapCenterGlobalPos()}var edgeLen=this.getEdgeLen();var size=this.getSize();if(size.width<=0||size.height<=0){return}resetColumn(this,mapCenterGPos,mapZoom,edgeLen,size);resetRow(this,mapCenterGPos,mapZoom,edgeLen,size)},resizeLayer:function(){var i,tile,posX,posY,newX,theRow,row;var mapZoom=this.getMapZoom();var mapCenterGPos=this.getMapCenterGlobalPos();var edgeLen=this.getEdgeLen();var size=this.getSize();if(size.width<=0||size.height<=0){return}var viewTileX1=Math.floor((mapCenterGPos.posX*edgeLen-size.width/2)/256);var viewTileY1=Math.floor((mapCenterGPos.posY*edgeLen-size.height/2)/256);var viewTileX2=Math.ceil((mapCenterGPos.posX*edgeLen+size.width/2)/256);var viewTileY2=Math.ceil((mapCenterGPos.posY*edgeLen+size.height/2)/256);this._rows=viewTileY2-viewTileY1+1;this._cols=viewTileX2-viewTileX1+1;var grid=this._grid;var rowA=grid[0];while(viewTileY1<rowA[0]._tileY){row=[];grid.unshift(row);var colsNum=rowA.length;for(i=0;i<colsNum;i++){tile=TileStore.getImageTile();posX=rowA[i]._left;posY=rowA[i]._top-256;tile.addToLayer(this,rowA[i]._tileX,rowA[i]._tileY-1,mapZoom,posX,posY);tile.draw();row.push(tile)}rowA=grid[0]}var rowZ=grid[grid.length-1];while(viewTileY2>rowZ[0]._tileY){row=[];grid.push(row);colsNum=rowZ.length;for(i=0;i<colsNum;i++){tile=TileStore.getImageTile();posX=rowZ[i]._left;posY=rowZ[i]._top+256;tile.addToLayer(this,rowZ[i]._tileX,rowZ[i]._tileY+1,mapZoom,posX,posY);tile.draw();row.push(tile)}rowZ=grid[grid.length-1]}row=grid[0];while(viewTileX1<row[0]._tileX){newX=row[0]._tileX-1;for(i=0;i<grid.length;i++){theRow=grid[i];tile=TileStore.getImageTile();posX=theRow[0]._left-256;posY=theRow[0]._top;tile.addToLayer(this,newX,theRow[0]._tileY,mapZoom,posX,posY);tile.draw();theRow.unshift(tile)}}while(viewTileX2>row[row.length-1]._tileX){newX=row[row.length-1]._tileX+1;for(i=0;i<grid.length;i++){theRow=grid[i];tile=TileStore.getImageTile();posX=theRow[theRow.length-1]._left+256;posY=theRow[theRow.length-1]._top;tile.addToLayer(this,theRow[theRow.length-1]._tileX+1,theRow[theRow.length-1]._tileY,mapZoom,posX,posY);tile.draw();theRow.push(tile)}}},changedLayerZoom:function(){this.resetLayer()},changeUrl:function(){this._urlPath=mapwork.configs[this._layerId+"_url"]+"&dataset="+mapwork.mapStyle;for(var k in this._grid){var row=this._grid[k];for(var j in row){row[j].draw()}}},setUrlPath:function(newUrl){if(!newUrl){return}if(this._urlPath==newUrl){return}this._urlPath=newUrl;this.changeUrl()},getUrlPath:function(){return this._urlPath},makeTileUrl:function(x,y,zoom){if(this._urlPath){return this._urlPath+"&x="+x+"&y="+y+"&zoom="+zoom}return null}};if(EXTEND){mapwork.utils.inherits(TileLayer,EXTEND)}})();(function(){mapwork.MapElementLayer=MapElementLayer;var EXTEND=mapwork.Layer;function MapElementLayer(){if(EXTEND){EXTEND.apply(this,arguments)}this._elementStore={}}MapElementLayer.prototype={addElement:function(mapElement){if(mapElement&&mapElement.getHtmlObj()){this._elementStore[mapElement.getElementId()]=mapElement;this._div.appendChild(mapElement.getHtmlObj());mapElement.setLayer(this)}},removeElement:function(mapElement){if(mapElement){this._div.removeChild(mapElement.getHtmlObj());delete this._elementStore[mapElement.getElementId()];mapElement.setLayer(null)}},resetElement:function(mapElement){if(mapElement&&mapElement.isDisplayAtZoom(zoom)){var mapLocation=this._map.getMapLocation();var mapCenterGPos=mapLocation.getMapCenterGlobalPos();var edgeLen=mapLocation.getEdgeLen();var size=this._map.getSize();var layerOffsetPos=this._layerContainer.getLayerOffsetPos();var zoom=mapLocation.getZoom();mapElement.updateMapPos(size,edgeLen,mapCenterGPos,layerOffsetPos)}else{mapElement.hide()}},resetLayer:function(){var mapLocation=this._map.getMapLocation();var mapCenterGPos=mapLocation.getMapCenterGlobalPos();var edgeLen=mapLocation.getEdgeLen();var size=this._map.getSize();var layerOffsetPos=this._layerContainer.getLayerOffsetPos();var zoom=mapLocation.getZoom();for(var k in this._elementStore){var mapElement=this._elementStore[k];if(mapElement.isDisplayAtZoom(zoom)){mapElement.updateMapPos(size,edgeLen,mapCenterGPos,layerOffsetPos)}else{mapElement.hide()}}},initLayer:function(){this.resetLayer()},changedLayerZoom:function(){this.resetLayer()}};if(EXTEND){mapwork.utils.inherits(MapElementLayer,EXTEND)}})();(function(){mapwork.MapVectorLayer=MapVectorLayer;MapVectorLayer.ID="MapVectorLayer";var EXTEND=mapwork.MapElementLayer;function MapVectorLayer(){if(EXTEND){EXTEND.apply(this,arguments)}this._layerId=MapVectorLayer.ID;if(typeof this._layerId==="string"){this._div.className=this._layerId}this._div.style["zIndex"]=200}MapVectorLayer.prototype={doTest:function(){var pathId="Path"+new Date().getTime();var path=new mapwork.MapPath(pathId);path.addPos(new mapwork.EarthPos(31.241696,121.491722));path.addPos(new mapwork.EarthPos(31.245733,121.499576));path.addPos(new mapwork.EarthPos(31.242907,121.525453));this.addElement(path);var mapCircle=new mapwork.MapCircle("circle1");mapCircle.setCenterPos(new mapwork.EarthPos(31.230248,121.450051));mapCircle.setEdgePos(new mapwork.EarthPos(31.235496,121.457389));mapCircle.setStrokeOpacity(0.5);mapCircle.setFillOpacity(0.2);this.addElement(mapCircle);mapCircle=new mapwork.MapCircle("circle2");mapCircle.setCenterPos(new mapwork.EarthPos(31.2503813,121.4802679));mapCircle.setRadius(1000);mapCircle.setStrokeOpacity(0.8);mapCircle.setFillOpacity(0.6);this.addElement(mapCircle);this.initLayer()}};if(EXTEND){mapwork.utils.inherits(MapVectorLayer,EXTEND)}})();(function(){mapwork.MapShadowLayer=MapShadowLayer;MapShadowLayer.ID="MapShadowLayer";var EXTEND=mapwork.MapElementLayer;function MapShadowLayer(){if(EXTEND){EXTEND.apply(this,arguments)}this._layerId=MapShadowLayer.ID;if(typeof this._layerId==="string"){this._div.className=this._layerId}this._div.style["zIndex"]=300}MapShadowLayer.prototype={};if(EXTEND){mapwork.utils.inherits(MapShadowLayer,EXTEND)}})();(function(){mapwork.MapIconLayer=MapIconLayer;MapIconLayer.ID="MapIconLayer";var EXTEND=mapwork.MapElementLayer;function MapIconLayer(layerId){if(EXTEND){EXTEND.apply(this,arguments)}if(layerId){this._layerId=layerId}else{this._layerId=MapIconLayer.ID}if(typeof this._layerId==="string"){this._div.className=this._layerId}this._div.style["zIndex"]=400}MapIconLayer.prototype={empty:function(){$(this._div).empty()}};if(EXTEND){mapwork.utils.inherits(MapIconLayer,EXTEND)}})();(function(){mapwork.MapLabelLayer=MapLabelLayer;MapLabelLayer.ID="MapLabelLayer";var EXTEND=mapwork.MapElementLayer;function MapLabelLayer(){if(EXTEND){EXTEND.apply(this,arguments)}this._layerId=MapLabelLayer.ID;if(typeof this._layerId==="string"){this._div.className=this._layerId}this._div.style["zIndex"]=500}MapLabelLayer.prototype={};if(EXTEND){mapwork.utils.inherits(MapLabelLayer,EXTEND)}})();(function(){mapwork.MapPopLayer=MapPopLayer;MapPopLayer.ID="MapPopLayer";var EXTEND=mapwork.MapElementLayer;function MapPopLayer(){if(EXTEND){EXTEND.apply(this,arguments)}this._layerId=MapPopLayer.ID;if(typeof this._layerId==="string"){this._div.className=this._layerId}this._div.style["zIndex"]=600}MapPopLayer.prototype={};if(EXTEND){mapwork.utils.inherits(MapPopLayer,EXTEND)}})();(function(){mapwork.MapTipLayer=MapTipLayer;MapTipLayer.ID="MapTipLayer";var EXTEND=mapwork.MapElementLayer;function MapTipLayer(){if(EXTEND){EXTEND.apply(this,arguments)}this._layerId=MapTipLayer.ID;if(typeof this._layerId==="string"){this._div.className=this._layerId}this._div.style["zIndex"]=800}MapTipLayer.prototype={};if(EXTEND){mapwork.utils.inherits(MapTipLayer,EXTEND)}})();(function(){mapwork.Map=Map;var utils=mapwork.utils;var EXTEND=null;function Map(wrapDiv,options){if(EXTEND){EXTEND.apply(this,arguments)}this._div=document.createElement("div");this._controlsDiv=document.createElement("div");this._controlsDiv.style.zIndex=10000;this._div.className="mapcontainer";utils.extend(this,options);this._div.style.width="100%";this._div.style.height="100%";this._div.style.position="relative";this._div.style.cursor="default";this._div.style.overflow="hidden";if(wrapDiv){if(typeof wrapDiv==="string"){wrapDiv=document.getElementById(wrapDiv);if(wrapDiv){wrapDiv.appendChild(this._div)}}else{wrapDiv.appendChild(this._div)}}this._mapPos={"x":0,"y":0};this._size={"width":0,"height":0};this._modules={};this._mapLocation=new mapwork.MapLocation(this,this.lat,this.lon,this.zoom);this._controls={};this._layerContainer=new mapwork.LayerContainer(this);this._div.appendChild(this._layerContainer._div);this._div.appendChild(this._controlsDiv);this._handlers={};this._mode=0;this._menu=new mapwork.Menu(this);var mapTipLayer=this._layerContainer.getLayer(mapwork.MapTipLayer.ID);if(mapTipLayer){this._tip=new mapwork.MapTip(this);mapTipLayer.addElement(this._tip)}}Map.prototype={setMode:function(mode){this._mode=mode},getMode:function(){return this._mode},destroy:function(){if(this._controls){for(var i=this._controls.length;i>=0;i--){this._controls[i].destroy()}this._controls=null}},resetSize:function(size){if(size){this._size.width=size.width;this._size.height=size.height}else{this._size.width=this._div.clientWidth;this._size.height=this._div.clientHeight}this.fireEvent(mapwork.MapEvent.RESIZE,this)},addLayer:function(layer){this._layerContainer.addLayer(layer)},getLayerContainer:function(){return this._layerContainer},getLayer:function(layerId){return this._layerContainer.getLayer(layerId)},addControl:function(control){if(control instanceof mapwork.Control){var controlId=control.getControlId();if(controlId){this._controls[controlId]=control;control.setMap(this);control.appendToDiv(this._controlsDiv)}}},getControl:function(controlId){return this._controls[controlId]},addHandler:function(handler){if(handler instanceof mapwork.Handler){var handlerId=handler.getHandlerId();if(handlerId){this._handlers[handlerId]=handler;handler.setMap(this)}}},getHandler:function(handlerId){return this._handlers[handlerId]},getSize:function(){return this._size},getMapPos:function(){return this._mapPos},getMenu:function(){return this._menu},getMapLocation:function(){return this._mapLocation},addEventListener:function(eventType,listener,caller,params){if(eventType.startsWith("mapwork.")){this.addListener(eventType,function(){listener.call(caller,params)})}else{utils.bindEvent(this._div,eventType,function(event){listener.call(caller,event,params)})}},openTip:function(ePos,name,appendDiv,tailDiv,offsetTop,closeCallback){if(this._tip){this._tip.open(ePos,name,appendDiv,tailDiv,offsetTop,closeCallback)}},hideTip:function(){if(this._tip){this._tip.doHide()}},isTipDisplay:function(){if(this._tip){return this._tip.isDisplay()}return false},movedToMapCenter:function(pos){this._layerContainer.movedToMapCenter(pos)},movingToMapCenter:function(pos){this._layerContainer.movingToMapCenter(pos)},zoomToMapCenter:function(pos,zoom){if(this._mapLocation.getZoom()===zoom){this._layerContainer.movedToMapCenter(pos)}else{this._mapLocation._zoomToMapCenter(pos,zoom)}},slidingToMapCenter:function(pos,listener,stepNum){var gPos;if(pos instanceof mapwork.GlobalPos){gPos=pos}else{if(pos instanceof mapwork.EarthPos){gPos=pos.convert2GlobalPos()}else{return}}var edgeLen=this._mapLocation.getEdgeLen();var mapCenterGPos=this._mapLocation.getMapCenterGlobalPos();var offsetX=(mapCenterGPos.posX-gPos.posX)*edgeLen;var offsetY=(mapCenterGPos.posY-gPos.posY)*edgeLen;if(!stepNum){stepNum=50}var stepX=offsetX/stepNum;var stepY=offsetY/stepNum;var layerContainer=this._layerContainer;var index=0;function offset(){layerContainer.movedMap(stepX,stepY);index++;if(index>=stepNum){if(interval){clearInterval(interval);interval=null;if(listener){listener.call()}}}}var interval=setInterval(offset,1)},fitBounds:function(bounds){if(bounds.isNull()){return}var width=this._size.width;var height=this._size.height;if(width>0&&height>0){var centerGPosX=(bounds.getMinX()+bounds.getMaxX())/2;var centerGPosY=(bounds.getMinY()+bounds.getMaxY())/2;var widthEdgeLen=width/bounds.getWidth();var heightEdgeLen=height/bounds.getHeight();var minEdgeLen=widthEdgeLen;if(heightEdgeLen<minEdgeLen){minEdgeLen=heightEdgeLen}var fitZoom=mapwork.utils.getFitZoom(minEdgeLen);this.zoomToMapCenter(new mapwork.GlobalPos(centerGPosX,centerGPosY),fitZoom)}},addModule:function(module){if(module instanceof mapwork.Module){var moduleId=module.getModuleId();if(moduleId){this._modules[moduleId]=module;module.setMap(this)}}},getModule:function(moduleId){var module=this._modules[moduleId];if(!module){return this._modules[mapwork.CommonModuleItem.ID]}return module},openModule:function(moduleId){if(!this._modules[moduleId]){return}var module=this._modules[moduleId];module.init();module.doListQuery();module.doPageQuery();this._currentModule=module}};if(EXTEND){mapwork.utils.inherits(Map,EXTEND)}mapwork.utils.extend(Map.prototype,mapwork.eventBase)})();(function(){mapwork.MenuGroup=MenuGroup;var EXTEND=null;function MenuGroup(groupName,groupIndex){if(EXTEND){EXTEND.apply(this,arguments)}this._groupName=groupName;this._groupIndex=groupIndex;this._menuArray=[]}MenuGroup.prototype={addMenuItem:function(menuName,menuListener){this._menuArray.push({"name":menuName,"listener":menuListener})},getMenuItemCount:function(){return this._menuArray.length},getMenuArray:function(){return this._menuArray},compareTo:function(menuGroup){return this._groupIndex-menuGroup._groupIndex}};if(EXTEND){mapwork.utils.inherits(MenuGroup,EXTEND)}})();(function(){mapwork.Menu=Menu;var EXTEND=null;function Menu(map){if(EXTEND){EXTEND.apply(this,arguments)}this._map=map;this._menuGroupArray=[];var zoom=new mapwork.MenuGroup("zoom",20);zoom.addMenuItem("放大",function(){map.getMapLocation().offsetZoom(1)});zoom.addMenuItem("缩小",function(){map.getMapLocation().offsetZoom(-1)});this.addMenuGroup(zoom)}Menu.prototype={setMousePos:function(posX,posY){this._mousePos={"posX":+posX,"posY":+posY}},getMousePos:function(){return this._mousePos},getMenuGroupCount:function(){return this._menuGroupArray.length},addMenuGroup:function(menuGroup){if(menuGroup instanceof mapwork.MenuGroup){this._menuGroupArray.push(menuGroup)}},buildMenuDiv:function(wrapDiv){var k,j,li,item,group;this.sortMenu();for(k in this._menuGroupArray){if(k>0){li=document.createElement("LI");wrapDiv.appendChild(li);li.className="menuLiLine"}group=this._menuGroupArray[k];var menuArray=group.getMenuArray();if(menuArray.length>0){for(j in menuArray){item=menuArray[j];li=document.createElement("LI");li.innerHTML=item["name"];wrapDiv.appendChild(li);li.className="menuLiNormal";li.onclick=item["listener"];li.onmouseover=function(){this.className="menuLiMouseOver"};li.onmouseout=function(){this.className="menuLiNormal"}}}}},sortMenu:function(){this._menuGroupArray=this._menuGroupArray.sort(function(a,b){return a.compareTo(b)})}};if(EXTEND){mapwork.utils.inherits(Menu,EXTEND)}})();(function(){mapwork.RouterLine=RouterLine;RouterLine.INDEX=0;var EXTEND=mapwork.MapPath;function RouterLine(){if(EXTEND){EXTEND.apply(this,arguments)}this._id="router_"+RouterLine.INDEX++;this.setWidth(6);this.setOpacity(0.7);this.setColor("#24409c")}RouterLine.prototype={setJsonData:function(data){this._jsonData=data;this.clearPosList();var segments=data.segments;for(var index in segments){var segment=segments[index];var ePosArray=[];var points=segment["points"];var pointsArray=points.split(",");var lat,lon;for(var k=0;k<pointsArray.length;k+=2){if(k==0){lat=parseInt(pointsArray[k]);lon=parseInt(pointsArray[k+1])}else{lat+=parseInt(pointsArray[k]);lon+=parseInt(pointsArray[k+1])}var ePos=new mapwork.EarthPos(lat*10,lon*10,true);this.addPos(ePos);ePosArray.push(ePos)}segment["ePosArray"]=ePosArray}},getJsonData:function(){return this._jsonData}};if(EXTEND){mapwork.utils.inherits(RouterLine,EXTEND)}})();(function(){mapwork.RouterHandler=RouterHandler;RouterHandler.ID="RouterHandler";var EXTEND=mapwork.Handler;function RouterHandler(){if(EXTEND){EXTEND.apply(this,arguments)}this._handlerId=RouterHandler.ID}RouterHandler.prototype={setMap:function(map){this._map=map;this._router=new mapwork.Router(map,true);var self=this;var menu=this._map.getMenu();var routerMenu=new mapwork.MenuGroup("\u5bfb\u8def",1);function doMeun(isStart){var mapLocation=self._map.getMapLocation();var mousePos=menu.getMousePos();var ePos=mapLocation.getEarthPosFromMapPos(mousePos.posX,mousePos.posY);self._router.setRoutePos(ePos,isStart)}routerMenu.addMenuItem("\u4ee5\u6b64\u4e3a\u8d77\u70b9",function(){doMeun(true)});routerMenu.addMenuItem("\u4ee5\u6b64\u4e3a\u7ec8\u70b9",function(){doMeun(false)});menu.addMenuGroup(routerMenu)}};if(EXTEND){mapwork.utils.inherits(RouterHandler,EXTEND)}})();(function(){var html='<div class="search_title">'+'	<span class="left back"><a href="javascript:void(0);">返回</a></span>'+"</div>"+'<div class="container">'+'<div class="bus_main" id="bus_scroll">'+"</div>"+"</div>"+'<div class="busline">'+'	<div class="left">'+'    	<span><a href="#" title="">重选起终点</a></span>'+'        <span><a href="#" title="">纠错</a></span>'+"    </div>"+'    <div class="right">'+"    	<span>查看：</span>"+'        <span><a href="#" title="">返程</a></span>'+"    </div>"+"</div>";var jConentDiv=$(html);var jContainerDiv=jConentDiv.find(".bus_main");mapwork.RouterSideBar=RouterSideBar;var EXTEND=mapwork.SideBar;RouterSideBar.selectObject=null;function RouterSideBar(router,wrapDiv){if(EXTEND){EXTEND.apply(this,arguments)}this._wrapDiv=wrapDiv;this._jWrapDiv=$(wrapDiv);this._jWrapDiv.empty();this._router=router}RouterSideBar.prototype={init:function(){$("#indexbox").hide();var self=this;jConentDiv.find(".left.back > a").click(function(){self.clean();self._router.clean()});this._jWrapDiv.append(jConentDiv);this._jWrapDiv.show();this.adjustSideBarHeight()},adjustSideBarHeight:function(){jContainerDiv.height($("#w").height()-$(".mb_line").outerHeight()-$(".busline").outerHeight()-$(".busline:last").outerHeight())},resize:function(){this.adjustSideBarHeight()},onListQueryResult:function(routerLine){var data=routerLine.getJsonData();var segmentArray=data["segments"];if(data){function wrapContent(index,info){return $('<div class="list">'+'	<div class="list_top">'+'     <div class="index">'+(parseInt(index)+1)+". "+"</div>"+'		<div class="list_title">'+info+"</div>"+"	</div>"+"</div>")}var routeType=data["routeType"];var from=data["fromName"];var to=data["toName"];var totallen=data["totallen"];var totaltime=data["totaltime"];var self=this;jContainerDiv.html('	<div class="bus_show">'+'    	<ul class="bus_menu">'+'            <li id="bm1" class="on">最少时间</li>'+'            <li id="bm2" class="off">最短路程</li>'+"        </ul>"+'        <div class="bus_result">'+'        	<div class="dis" id="bms1">'+'            	<div class="bs_top">'+'                	<span class="padlr10"><b>全程</b></span>'+"                    <span></span>"+"                </div>"+'                <div class="bs_start">'+'                	<span class="bs_title"></span>'+"                </div>"+'                <div class="listbox" id="resultbox">'+"                </div>"+'                <div class="bs_end"></div>'+"            </div>"+"        </div>"+"    </div>");this._jListbox=jContainerDiv.find(".listbox");jContainerDiv.find(".bs_start .bs_title").html(from);jContainerDiv.find(".bs_end").html(to);if(totallen&&totaltime){jContainerDiv.find(".bs_top").find("span:last").html("约"+totallen+"/ "+totaltime)}else{jContainerDiv.find(".bs_top").html("抱歉，没有找到从["+from+"]到["+to+"]的路线")}if(self._router._routeType=="t"){var bm1=jContainerDiv.find("#bm1");bm1.siblings().removeClass("on");bm1.siblings().addClass("off");bm1.addClass("on")}else{var bm2=jContainerDiv.find("#bm2");bm2.siblings().removeClass("on");bm2.siblings().addClass("off");bm2.addClass("on")}jConentDiv.find(".bus_menu > #bm1").click(function(){self._router._routeType="t";self._router.doRoute()});jConentDiv.find(".bus_menu > #bm2").click(function(){self._router._routeType="l";self._router.doRoute()});for(var i in segmentArray){var segment=segmentArray[i];var jContent=segment["content"];if(!jContent){jContent=wrapContent(i,segment.info);segment["content"]=jContent}if(jContent){var div=jContent.get(0);div.segment=segment;jContent.hover(function(){$(this).addClass("on");self._router.hoverSegment(this.segment)},function(){$(this).removeClass("on");self._router.hoverSegment(null)});jContent.click(function(){var selectedObject=mapwork.RouterSideBar.selectObject;if(selectedObject&&selectedObject!=$(this)){selectedObject.removeClass("clicked")}mapwork.RouterSideBar.selectObject=$(this);$(this).addClass("clicked");self._router.focusSegment(this.segment)});this._jListbox.append(jContent)}}}jContainerDiv.mCustomScrollbar({scrollButtons:{enable:true}})},clean:function(){$("div[name='indexDiv']").show();$("#sidebar").hide();jConentDiv.find(".bus_menu > #bm1").removeClass("off");jConentDiv.find(".bus_menu > #bm1").addClass("on");jConentDiv.find(".bus_menu > #bm2").removeClass("on");jConentDiv.find(".bus_menu > #bm2").addClass("off");this.reset()},reset:function(){if(this._jListbox){this._jListbox.empty()}this._jWrapDiv.empty()}};if(EXTEND){mapwork.utils.inherits(RouterSideBar,EXTEND)}})();(function(){mapwork.Router=Router;var EXTEND=null;function Router(map,locateRoutePosOnRoadFirst){if(EXTEND){EXTEND.apply(this,arguments)}this._map=map;var RouterId="routeLayer";this._urlPath=mapwork.configs[RouterId+"_url"];this._routeType="t";this._locateRoutePosOnRoadFirst=locateRoutePosOnRoadFirst;this._vectorLayer=this._map.getLayer(mapwork.MapVectorLayer.ID);this._popLayer=this._map.getLayer(mapwork.MapPopLayer.ID);this._startPopo=new mapwork.MapDraggableIcon("startPopo","images/routestart.png","images/routestart.png",[15,40],1);this._endPopo=new mapwork.MapDraggableIcon("endPopo","images/routeend.png","images/routeend.png",[15,40],1);var self=this;this._startPopo.setDraggedFunc(function(newEPos){self.setRoutePos(newEPos,true)});this._endPopo.setDraggedFunc(function(newEPos){self.setRoutePos(newEPos,false)});this._focusRouteLine=new mapwork.RouterLine();this._hoverRouteLine=new mapwork.RouterLine();this._focusRouteLine.setColor("#62d8ff");this._hoverRouteLine.setColor("#62d8ff");this._focusRouteLine.setWidth(3);this._hoverRouteLine.setWidth(3);this._focusRouteLine.setZIndex(9);this._hoverRouteLine.setZIndex(10);this._focusRouteLine.setOpacity(1);this._hoverRouteLine.setOpacity(1);this._routerLines={}}Router.prototype={setRoutePos:function(ePos,isStart){if(this._locateRoutePosOnRoadFirst){if(!this._urlPath){return}var url=this._urlPath+"?v="+ePos.getILat()+","+ePos.getILon();var self=this;function onResult(data){if(data.pos){var arr=data.pos.split(",");if(arr.length==2){var lat=Number(arr[0]);var lon=Number(arr[1]);var ePos=new mapwork.EarthPos(lat,lon,true);if(isStart){self._startEPos=ePos}else{self._endEPos=ePos}self.setRoutePopoPos(ePos,isStart);self.clearAllRouteLines();self.doRoute()}else{if(isStart){self.setRoutePopoPos(self._startEPos,isStart)}else{self.setRoutePopoPos(self._endEPos,isStart)}}}else{if(data.error){if(isStart){self.setRoutePopoPos(self._startEPos,isStart)}else{self.setRoutePopoPos(self._endEPos,isStart)}}}}mapwork.utils.loadJsonData(url,function(json){onResult(json)})}else{this.setRoutePopoPos(ePos,isStart);if(isStart){this._startEPos=ePos}else{this._endEPos=ePos}this.clearAllRouteLines();this.doRoute()}},setRoutePopoPos:function(ePos,isStart){if(isStart){this._startPopo.setEarthPos(ePos);if(!this._startPopo.getLayer()){this._popLayer.addElement(this._startPopo)}this._popLayer.resetElement(this._startPopo)}else{this._endPopo.setEarthPos(ePos);if(!this._endPopo.getLayer()){this._popLayer.addElement(this._endPopo)}this._popLayer.resetElement(this._endPopo)}},doRoute:function(){if(this._currRouterLine){this._currRouterLine.doRemove()}this._focusRouteLine.doRemove();this._hoverRouteLine.doRemove();this.clearChannelInfoIcons();this._currRouterLine=this._routerLines[this._routeType];if(this._currRouterLine){this._vectorLayer.addElement(this._currRouterLine);this._vectorLayer.resetElement(this._currRouterLine);this.openSideBar(this._currRouterLine);this.openChannelInfoControl(this);return}if(this._startEPos&&this._endEPos){var url=this._urlPath+"?p="+this._startEPos.getILat()+","+this._startEPos.getILon()+","+this._endEPos.getILat()+","+this._endEPos.getILon()+"&type="+this._routeType;var self=this;function onResult(data){self.onRouteResult(data,self._routeType)}mapwork.utils.loadJsonData(url,function(json){onResult(json)})}},onRouteResult:function(data,routeType){if(!data){return}var currentModule=this._map._currentModule;if(currentModule&&currentModule!=this){currentModule.clean()}this._currRouterLine=new mapwork.RouterLine();this._currRouterLine.setJsonData(data);this._routerLines[routeType]=this._currRouterLine;this._vectorLayer.addElement(this._currRouterLine);this._vectorLayer.resetElement(this._currRouterLine);this.openSideBar(this._currRouterLine);this.openChannelInfoControl()},openSideBar:function(routerLine){this._jSideBarDiv=$("#sidebar");this._sideBarDiv=this._jSideBarDiv.get(0);if(!this._sideBar){this._sideBar=new mapwork.RouterSideBar(this,this._sideBarDiv)}this._map._currentModule=this;this._sideBar.reset();this._sideBar.init();this._sideBar.onListQueryResult(routerLine)},openChannelInfoControl:function(){if(!this._channelInfoControl){this._channelInfoControl=this._map.getControl(mapwork.MapChannelInfoControl.ID)}this._channelInfoControl.init(this)},focusSegment:function(segment){this._focusRouteLine.clearPosList();if(segment){var ePosArray=segment.ePosArray;if(ePosArray){this._focusRouteLine.setEPosArray(ePosArray)}}if(!this._focusRouteLine.getLayer()){this._vectorLayer.addElement(this._focusRouteLine)}this._vectorLayer.resetElement(this._focusRouteLine)},hoverSegment:function(segment){this._hoverRouteLine.clearPosList();if(segment){var ePosArray=segment.ePosArray;if(ePosArray){this._hoverRouteLine.setEPosArray(ePosArray)}}if(!this._hoverRouteLine.getLayer()){this._vectorLayer.addElement(this._hoverRouteLine)}this._vectorLayer.resetElement(this._hoverRouteLine)},showPOI:function(poiName,isShow){var self=this;function _bindClick(mapIcon,name){$(mapIcon.getHtmlObj()).click(function(){self._map._tip.setTrigger(mapIcon);self._map.openTip(mapIcon.getEarthPos(),name,"",null,5)})}if(this._currRouterLine){var poiList=this._currRouterLine._jsonData["poi"];for(var i in poiList){var poi=poiList[i];if(poiName==poi["type"]){var items=poi["items"];for(var k in items){var item=items[k];if(isShow){if(!item["mapIcon"]){var name=item["name"];var pos=item["pos"];var lat=pos.split(",")[0];var lon=pos.split(",")[1];var mapIcon=new mapwork.MapIcon(poiName+k,"images/"+poiName+".png","images/"+poiName+".png",[7,7],this.k);mapIcon.setEarthPos(new mapwork.EarthPos(lat,lon,true));_bindClick(mapIcon,name);item["mapIcon"]=mapIcon}this._popLayer.addElement(item["mapIcon"]);this._popLayer.resetElement(item["mapIcon"])}else{if(item["mapIcon"]){if(this._map._tip.isDisplay()){if(this._map._tip.getTrigger()==item["mapIcon"]){this._map.hideTip()}}item["mapIcon"].doRemove()}}}}}}},clean:function(){this._startEPos=null;this._endEPos=null;this._startPopo.doRemove();this._endPopo.doRemove();this.clearChannelInfoIcons();if(this._channelInfoControl){this._channelInfoControl.hide()}this._map.hideTip();this.clearAllRouteLines();this._currRouterLine=null},clearChannelInfoIcons:function(){this._map.hideTip();if(this._currRouterLine){var poiList=this._currRouterLine._jsonData["poi"];for(var i in poiList){var poi=poiList[i];var items=poi["items"];for(var k in items){var item=items[k];if(item["mapIcon"]){item["mapIcon"].doRemove()}}}}},clearAllRouteLines:function(){for(var k in this._routerLines){var routeLine=this._routerLines[k];routeLine.doRemove()}this._routerLines={};this._focusRouteLine.doRemove();this._hoverRouteLine.doRemove()}};if(EXTEND){mapwork.utils.inherits(Router,EXTEND)}})();(function(){var tailDiv='<div class="lineWrap">'+"<div>"+"</div>"+"</div>"+'<div class="tips_show">'+'<div class="dis" id="tms1">'+'   <div class="tips_left">'+'        <span><a name="JTSK" href="javascript:void(0);">交通实况</a></span>'+'        <span><a name="JTZB" href="javascript:void(0);">交通直播</a></span>'+'        <span><a name="YDP" href="javascript:void(0);">诱导牌</a></span>'+"    </div>"+'    <div class="tips_right">'+'		 <form name="rangeSearchForm">'+'        <span><input type="text" id="rangeSearchName" class="text_03"></span>'+'        <span><input type="image" src="images/btn_tips_search.gif"></span>'+"		 </form>"+"    </div>"+"</div>"+"</div>"+"</div>";mapwork.ModuleItem=ModuleItem;ModuleItem.tailDiv=tailDiv;var EXTEND=null;ModuleItem.selectItem=null;function ModuleItem(module,index){if(EXTEND){EXTEND.apply(this,arguments)}this._module=module;this._index=index;this._tipOffsetTop4Icon=5;this._tipOffsetTop4Pop=30;this._isEditable=false}ModuleItem.prototype={setSidebar:function(sideBar){this._sideBar=sideBar},setIndex:function(index){this._index=index},setZIndex:function(zIndex){this._zIndex=zIndex},getZIndex:function(){return this._zIndex},setId:function(id){this._id=id},getId:function(){return this._id},setName:function(name){this._name=name},getName:function(){return this._name},setDescribe:function(describe){this._discribe=describe},getDescribe:function(){return this._discribe},setIcon:function(icon){this._icon=icon},getIcon:function(){return this._icon},setHoverIcon:function(icon){this._hoverIcon=icon},getHoverIcon:function(){return this._hoverIcon},setOffsetPos:function(offsetPos){this._offsetPos=offsetPos},getOffsetPos:function(){return this._offsetPos},setJsonData:function(json){this._json=json},getJsonData:function(){return this._json},setMap:function(map){this._map=map},getMap:function(){return this._map},setEarthPos:function(ePos){this._ePos=ePos},getEarthPos:function(){return this._ePos},getSidebarElement:function(){this._$Content=$(this.getSidebarContent(this._id));this._$ContentImage=this._$Content.find("img");var self=this;this._$Content.hover(function(){self.doHover()},function(){self.deHover()});this._$Content.click(function(){self.doFocus()});return this._$Content.get(0)},getMapIcon:function(){if(!this._mapIcon){this._mapIcon=this.createMapIcon();if(this._mapIcon){this._mapIcon.setEarthPos(this._ePos);var self=this;$(this._mapIcon.getHtmlObj()).hover(function(){self.doHover();self.showHoverLabel(event)},function(){self.deHover();self.hideHoverLabel()});this._mapIcon.getHtmlObj().onclick=function(event){self.doFocus()};this._mapIcon.getHtmlObj().ondblclick=function(event){if(event.stopPropagation){event.stopPropagation();event.preventDefault()}else{event.cancelBubble=true;event.returnValue=false}}}}return this._mapIcon},getDetailUrl:function(){return this._module._setting.detailUrl},getDetailParam:function(json){return null},isNeedItemQuery:function(){return true},doItemDetailInfo:function(){var self=this;function onResult(data){self.onItemQueryResult(data)}$.ajax({url:this.getDetailUrl(),async:false,dataType:"json",cache:false,data:this.getDetailParam(),success:onResult})},onItemQueryResult:function(data){mapwork.utils.extend(this._json,data)},doBeforeOpenTip:function(){},getTipTitle:function(){return this._name},getTipContent:function(){return""},getTipTail:function(){var $tailDiv=$(tailDiv);var rangeSearchForm=$tailDiv.find("form[name='rangeSearchForm']").get(0);var rangeSearchHandler=this._map.getHandler(mapwork.RangeSearchHandler.ID);if(rangeSearchForm){var self=this;$tailDiv.find(".tips_left a").each(function(){this.onclick=function(){var tag=$(this).html();rangeSearchHandler.openRangeSearchControl(self._mapIcon.getEarthPos());rangeSearchHandler.doSearch(tag)}});rangeSearchForm.onsubmit=function(){var name=$tailDiv.find("#rangeSearchName").val();rangeSearchHandler.openRangeSearchControl(self._mapIcon.getEarthPos());rangeSearchHandler.doSearch(name);return false}}return $tailDiv},doOpenTip:function(){this.doBeforeOpenTip();if(this._index==undefined){this._map.openTip(this._ePos,this.getTipTitle(),this.getTipContent(),this.getTipTail(),this._tipOffsetTop4Icon)}else{this._map.openTip(this._ePos,this.getTipTitle(),this.getTipContent(),this.getTipTail(),this._tipOffsetTop4Pop)}},doRemove:function(){this._mapIcon.doRemove()},getSidebarContent:function(id){if(id){id="id='"+id+"'"}else{id=""}return"<div "+id+" class='list'>"+"  <div class='list_num'>"+"<img src='"+this.getIcon()+"'></img>"+"</div>"+"  <div class='list_text'>"+"  	<h2><span>"+this.getName()+"</span></h2>"+"		<p>"+this.getDescribe()+"</p>"+"	 </div>"+"</div>"},setHoverImage:function(){if(this._$ContentImage){this._$ContentImage.attr("src",this._hoverIcon)}},setDefaultImage:function(){if(this._$ContentImage){this._$ContentImage.attr("src",this._icon)}},setHoverDiv:function(){if(this._$Content){this._$Content.addClass("on")}},setDefaultDiv:function(){if(this._$Content){this._$Content.removeClass("on")}},showHoverLabel:function(event){if(this._name){var pageX=this._map._mapLocation.getPageX(event);var pageY=this._map._mapLocation.getPageY(event);var ePos=this._map._mapLocation.getEarthPosFromMapPos(pageX,pageY);var mapPopLayer=this._map.getLayer(mapwork.MapPopLayer.ID);if(!this._hoverLabel){this._hoverLabel=new mapwork.MapLabel("hoverLabel");this._hoverLabel._htmlObj.style["zIndex"]=101;this._hoverLabel._offsetPos=[8,8]}this._hoverLabel.setPos(ePos);this._hoverLabel.setName(this._name);mapPopLayer.addElement(this._hoverLabel);mapPopLayer.resetElement(this._hoverLabel)}},hideHoverLabel:function(){if(this._hoverLabel){this._hoverLabel.doRemove()}},doHover:function(){this.setHoverDiv();this.setHoverImage();this.getMapIcon().setHoverImage()},deHover:function(){this.setDefaultDiv();if(this!=ModuleItem.selectItem){this.setDefaultImage();this.getMapIcon().setDefaultImage()}},doFocus:function(){if(this.isNeedItemQuery()){this.doItemDetailInfo()}this.doOpenTip();if(this._index==undefined){this.getMapIcon().setHoverImage()}else{var selectedObject=ModuleItem.selectItem;if(selectedObject&&selectedObject!=this){selectedObject.setDefaultImage();if(selectedObject._$Content){selectedObject._$Content.removeClass("clicked")}selectedObject.getMapIcon().setDefaultImage()}ModuleItem.selectItem=this;if(this._$Content){this._$Content.addClass("clicked")}this.setHoverImage();this.getMapIcon().setHoverImage();if(this._sideBar){this._sideBar._$Content.mCustomScrollbar("scrollTo","#"+this._id)}}},createMapIcon:function(){var id=this._id;var icon=this._icon;var hoverIcon=this._hoverIcon;var iconOffset=this._offsetPos;var mapIcon=new mapwork.MapIcon(id,icon,hoverIcon,iconOffset,this._zIndex);return mapIcon}};if(EXTEND){mapwork.utils.inherits(ModuleItem,EXTEND)}})();(function(){mapwork.BaseSideBar=BaseSideBar;var EXTEND=null;function BaseSideBar(module){if(EXTEND){EXTEND.apply(this,arguments)}this._module=module}BaseSideBar.prototype={init:function(){},resize:function(){},onPageQueryResult:function(jsonResult,objectArray){},onListQueryResult:function(jsonResult,objectArray){},clean:function(){},reset:function(){}};if(EXTEND){mapwork.utils.inherits(BaseSideBar,EXTEND)}})();(function(){mapwork.SideBarPage=SideBarPage;var EXTEND=mapwork.BaseSideBar;var pageHtml="<div>"+'<div class="search_title">'+'<span id="btnReturn" class="left back"><a href="javascript:void(0);">返回</a></span>'+'<div class="right">共有<span class="padlr5"></span>条搜索记录</div>'+"</div>"+'<div class="result_search"></div>'+'<div class="page">'+'<ul><li class="prev"><a>上一页</a></li>'+"<li><a></a></li>"+"<li><a></a></li>"+"<li><a></a></li>"+"<li><a></a></li>"+'<li class="next"><a>下一页</a></li></ul>'+"</div>"+"</div>";function SideBarPage(module){if(EXTEND){EXTEND.apply(this,arguments)}}SideBarPage.prototype={init:function(){$("#indexbox").hide();this._$SideBarDiv=$("#sidebar");this._pageQuery=this._module.doPageQuery;this._$SideBarDiv.empty();this._$ConentDiv=$(pageHtml);this._$Right=this._$ConentDiv.find(".right");this._$RecordCount=this._$ConentDiv.find(".search_title .padlr5");this._$Content=this._$ConentDiv.find(".result_search");this._$Page=this._$ConentDiv.find(".page");this._$A=this._$ConentDiv.find("li a");this._$SideBarDiv.append(this._$ConentDiv);this._$SideBarDiv.show();if(this._pageQuery){var self=this;this._$A.each(function(index){this.onclick=function(){if(this.pageInfo){self._pageQuery.call(self._module,this.pageInfo.pageIndex,this.pageInfo.pageSize)}}})}this.adjustSideBarHeight();$("#btnReturn").click(function(){self.doReturn()})},adjustSideBarHeight:function(){var westHeight=$("#w").height();var titleHeight=$(".search_title").outerHeight();var mbLineHeight=$(".mb_line").height();var pageHeight=this._$Page.outerHeight();this._$Content.height(westHeight-mbLineHeight-titleHeight-pageHeight)},resize:function(){this.adjustSideBarHeight()},onPageQueryResult:function(jsonResult){var data=jsonResult;if(data){if(!data.m_detail){if(jsonResult.rows){this._$Right.show();this._$RecordCount.html(data.total);for(var i in jsonResult.rows){var row=jsonResult.rows[i];if(row._moduleItem){this._$Content.append(row._moduleItem.getSidebarElement())}}this.doPage(data.page,data.pageSize,data.total)}else{this._$Right.hide();this._$Content.html('<td colspan="5" style="text-align:center;">无相关信息</td>')}}else{this._$Right.hide();this._$Content.html('<td colspan="5" style="text-align:center;">'+data.m_message+"</td>")}}else{this._$Right.hide();this._$Content.html('<td colspan="5" style="text-align:center;">无相关信息</td>')}this._$Content.mCustomScrollbar({scrollButtons:{enable:true}})},clean:function(){this._$SideBarDiv.empty();for(var i=0;i<=5;i++){if(i>=1&&i<5){this._$A.eq(i).html("");this._$A.eq(i).removeClass("selected")}this._$A.get(i).pageInfo=null;this._$A.get(i).onclick=null}},reset:function(){this._$Content.empty();this._$RecordCount.empty()},doPage:function(pageIndex,pageSize,total){pageSize=10;var pageCount=parseInt(total/pageSize);pageCount=total%pageSize==0?pageCount:pageCount+1;var preIndex=pageIndex==1?1:pageIndex-1;var nxtIndex=pageIndex==pageCount?pageIndex:pageIndex+1;var bg=1;var ed=pageCount;var numcount=4;if(pageCount>numcount){bg=pageIndex-parseInt(numcount/2);if(bg<1){bg=1}ed=bg+numcount-1;if(ed>pageCount){ed=pageCount;bg=ed-numcount+1}}if(preIndex==pageIndex){this._$A.get(0).pageInfo=null}else{this._$A.get(0).pageInfo={"pageIndex":preIndex,"pageSize":pageSize,"total":total}}var index=1;for(var i=bg;i<=ed;i++){this._$A.eq(index).html(i);if(i==pageIndex){this._$A.eq(index).addClass("selected");this._$A.get(index).pageInfo=null}else{this._$A.eq(index).removeClass("selected");this._$A.get(index).pageInfo={"pageIndex":i,"pageSize":pageSize,"total":total}}index++}if(nxtIndex==pageIndex){this._$A.get(5).pageInfo=null}else{this._$A.get(5).pageInfo={"pageIndex":nxtIndex,"pageSize":pageSize,"total":total}}},doReturn:function(){$("div[name='indexDiv']").show();this._$SideBarDiv.hide();this._module.clean()}};if(EXTEND){mapwork.utils.inherits(SideBarPage,EXTEND)}})();(function(){mapwork.Module=Module;var EXTEND=null;function Module(setting){if(EXTEND){EXTEND.apply(this,arguments)}this._setting=setting;this._isPageFitBounds=true}Module.prototype={init:function(){this._sideBar=this.buildSideBar();this._sideBar.init()},getModuleId:function(){return this._setting.ID},setMap:function(map){this._map=map},buildSideBar:function(){if(this._setting.newSidebar){return this._setting.newSidebar(this)}return new mapwork.SideBarPage(this)},buildModuleItem:function(json,index){var moduleItem=this._setting.newModuleItem(this,index);moduleItem.setJsonData(json);moduleItem.setSidebar(this._sideBar);return moduleItem},doPageQueryTest:function(){this._sideBar.reset();if(this._objectArray){for(var i in this._objectArray){this._objectArray[i].doRemove()}}this._map.hideTip();var queryContent=this.getTestPageResult();this.onPageQueryResult(queryContent)},doListQueryTest:function(){var queryContent=this.getTestListResult();this.onListQueryResult(queryContent)},clean:function(){this._sideBar.clean();this.doRemoveIconList();this.doHideTip();var listLayer=this._map.getLayer("moduleListLayer");if(listLayer){listLayer.empty()}if(this._setting.clean){this._setting.clean(this)}},workAllPageItem:function(callback){if(this._pageQueryResult&&this._pageQueryResult.rows){for(var i in this._pageQueryResult.rows){var item=this._pageQueryResult.rows[i];if(item._moduleItem){callback.call(item._moduleItem,item._moduleItem)}}}},workAllListItem:function(callback){if(this._listQueryResult&&this._listQueryResult.rows){for(var i in this._listQueryResult.rows){var item=this._listQueryResult.rows[i];if(item._moduleItem){callback.call(item._moduleItem,item._moduleItem)}}}},doRemoveIconList:function(){if(this._pageQueryResult&&this._pageQueryResult.rows){for(var i in this._pageQueryResult.rows){var item=this._pageQueryResult.rows[i];if(item._moduleItem){item._moduleItem.doRemove()}}}},doHideTip:function(){this._map.hideTip()},doPageQuery:function(pageIndex,pageSize){this._sideBar.reset();this.workAllPageItem(function(moduleItem){moduleItem.doRemove()});this.doHideTip();var queryParam={};queryParam["pagination.pageIndex"]=pageIndex;queryParam["pagination.pageSize"]=pageSize;var url=this._setting.pageUrl;this._ajaxFlag=(new Date()).getTime();var self=this;if(url&&url.length>0){$.ajax({url:url,data:queryParam,dataType:"json",cache:false,success:function(flag){return function(data){if(flag===self._ajaxFlag){self.onPageQueryResult(data)}}}(self._ajaxFlag)})}},doListQuery:function(){var url=this._setting.listUrl;var self=this;function onResult(data){self.onListQueryResult(data)}if(url&&url.length>0){$.ajax({url:url,dataType:"json",cache:false,success:onResult})}},onPageQueryResult:function(jsonResult){var mapPopLayer=this._map.getLayer(mapwork.MapPopLayer.ID);this._pageQueryResult=jsonResult;if(!jsonResult){return}var bounds=new mapwork.Bounds();if(!jsonResult.m_detail&&jsonResult.rows){for(var i in jsonResult.rows){var row=jsonResult.rows[i];var moduleItem=this.buildModuleItem(row,i);moduleItem.setMap(this._map);row._moduleItem=moduleItem;var ePos=moduleItem.getEarthPos();if(ePos){var gPos=ePos.convert2GlobalPos();if(gPos){bounds.expandToIncludePoint(gPos.posX,gPos.posY)}}var mapIcon=moduleItem.getMapIcon();mapPopLayer.addElement(mapIcon)}}this._sideBar.onPageQueryResult(jsonResult);mapPopLayer.initLayer();if(this._isPageFitBounds){this._map.fitBounds(bounds)}},onListQueryResult:function(jsonResult){var listLayer=this._map.getLayer("moduleListLayer");if(!listLayer){listLayer=new mapwork.MapIconLayer("moduleListLayer");this._map.addLayer(listLayer)}else{listLayer.empty()}this._listQueryResult=jsonResult;if(!jsonResult){return}if(!jsonResult.m_detail&&jsonResult.rows){for(var i in jsonResult.rows){var row=jsonResult.rows[i];var moduleItem=this.buildModuleItem(row);moduleItem.setMap(this._map);row._moduleItem=moduleItem;listLayer.addElement(moduleItem.getMapIcon())}}this._sideBar.onListQueryResult(jsonResult);listLayer.initLayer()},getTestPageResult:function(){return null},getTestListResult:function(){return null}};if(EXTEND){mapwork.utils.inherits(Module,EXTEND)}})();(function(){mapwork.Block=Block;var EXTEND=mapwork.ModuleItem;Block.ID="Block";Block.setting={ID:Block.ID,pageUrl:"queryRoadEvents",listUrl:"queryAllRoadEvents",detailUrl:"queryRoadEventsById",newModuleItem:function(module,index){return new Block(module,index)},clean:function(module){if(module._blockLineArray){for(var i in module._blockLineArray){module._blockLineArray[i].doRemove()}}if(module._breakPointArray){for(var i in module._breakPointArray){module._breakPointArray[i].doRemove()}}if(module._numLabelArray){for(var i in module._numLabelArray){module._numLabelArray[i].doRemove()}}}};function Block(module,index){if(EXTEND){EXTEND.apply(this,arguments)}this._vectorlayer=this._module._map.getLayer(mapwork.MapVectorLayer.ID);this._tipOffsetTop4Icon=5;this._tipOffsetTop4Pop=30}Block.prototype={setJsonData:function(json){var ePos;this._json=json;this._id=json.tableId+"_"+json.tableKey;if(this._index==undefined){this._name=this._json.roadName;this.setIcon("images/block_"+json.imageType+".png");this.setHoverIcon("images/block_"+json.imageType+"H.png");this.setOffsetPos([9,9])}else{this._name=this._json.roadName;this.setZIndex(100-parseInt(this._index));this.setIcon("images/r0"+this._index+".png");this.setHoverIcon("images/b0"+this._index+".png");this.setDescribe("<p>桩号: "+json.startNumDis+" - "+json.endNumDis+"</p>"+"<p>处置措施: "+json.precautionName+"</p>"+"<p>预计恢复时间: "+json.planTime+"</p>");this.setOffsetPos([11,31])}if(json.markingNumber){var arr=json.markingNumber.split(",");var x=parseInt(arr[0]);var y=parseInt(arr[1]);ePos=mapwork.SHPosMapping.convertShPosToEarthPos(x,y);this.setEarthPos(ePos)}},getDetailParam:function(){var queryParam={};queryParam["roadEvents.tableKey"]=this._json.tableKey;queryParam["roadEvents.tableId"]=this._json.tableId;return queryParam},getTipTitle:function(){return this._json.roadName},getTipContent:function(){var content="<div>"+"<p><span style='font-weight:bolder'>路线编号:</span> "+this._json.roadNumber+"&nbsp;&nbsp;&nbsp;"+"<input id='blockButton' style='display:none;' title='放大此路段' type='image' src='images/glass.png'/>"+"</p>"+"<p><span style='font-weight:bolder'>起 止 位 置:</span> 桩号("+this._json.startNumDis+" - "+this._json.endNumDis+")</p>"+"<p><span style='font-weight:bolder'>处置措施:</span> "+this._json.precautionName+"</p>"+"<p><span style='font-weight:bolder'>开 始 时 间:</span> "+this._json.detectionTime+"</p>"+"<p><span style='font-weight:bolder'>预计恢复时间:</span> "+this._json.planTime+"</p>"+"<p><span style='font-weight:bolder'>阻 断 原 因:</span> "+this._json.reasonName+"</p>"+"<p><span style='font-weight:bolder'>描       述:</span> "+this._json.describe1+"</p>"+"</div>";var $Content=$(content);var ePosArray=this.getBlockEPosList();if(ePosArray){var self=this;var blockButton=$Content.find("#blockButton");blockButton.show();blockButton.click(function(){self._module._blockLineArray=[];self.createBlockLine(ePosArray)})}return $Content},getBlockEPosList:function(){var points=this._json.points;if(points.trim().length==0){return null}points=points.replace(new RegExp("[|]","gm"),"");points=points.replace(new RegExp(";","gm"),",");if(points.charAt(points.length-1)==","){points=points.substring(0,points.length-1)}var retList=[];var ss=points.split(",");for(var k=0;k<ss.length;k+=2){var x=parseInt(ss[k]);var y=parseInt(ss[k+1]);retList.push(mapwork.SHPosMapping.convertShPosToEarthPos(x,y))}return retList},createBlockLine:function(ePosArray){var blockLine=new mapwork.MapPath("blockLine");blockLine.setColor("yellowGreen");blockLine.setWidth("5");blockLine.setOpacity("0.7");blockLine.setEPosArray(ePosArray);this._vectorlayer.addElement(blockLine);this._vectorlayer.resetElement(blockLine);this._module._blockLineArray.push(blockLine);var bounds=new mapwork.Bounds();for(i in ePosArray){var gPos=ePosArray[i].convert2GlobalPos();bounds.expandToIncludePoint(gPos.getPosX(),gPos.getPosY())}this._module._map.fitBounds(bounds)},showQueryBlock:function(){$(".result_search").height($(".result_search").height()+$(".page").innerHeight());$(".page").remove();$(".search_title .right").remove();this._sxxList={"0":"无上下行","1":"上行","2":"下行","12":"上下行"};this._module._blockLineArray=[];this.setMap(this._module._map);var queryDiv=$("<div id='queryBlock' style='margin-top:10px; border-bottom:1px #EBEBEB solid;'>"+"<div style='padding:3px 0;margin-left:18px;'>"+"<div style='padding:3px 0;position:relative;'>"+"<span>路线编码:</span><input id='lxbm' style='width:150px; margin-left:20px;' type='text' value=''  />"+"<span class='show' style='display: block; position:absolute;color:#BBB;font-size:10px;left:80px;top:7px; '>请输入以G/Y/X开头的编码</span>"+"</div>"+"<div id='suggest' style='display:none;position:absolute;border:1px solid #96AECE;background:white; overflow:hidden; width:152px; height:150px;left:91px;top:41px;'></div>"+"<div style='padding:3px 0;'>"+"<span>桩号范围:<span>"+"<input id='startNum' style='width:40px; margin-left:20px;' type='text' value='0' />"+" k ~ "+"<input id='endNum' style='width:40px;' type='text' value='0.5' />"+" k "+"</div>"+"<div style='padding:3px 0;'>"+"<span>上下行:<span>"+"<select id='sxx' style='margin-left:32px;'>"+"<option value='1'>上行</option>"+"<option value='2'>下行</option>"+"<option value='12'>上下行</option>"+"<option value='0'>无上下行</option>"+"</select>"+"</div>"+"<div style='padding:2px 0;'><span>步进:<span><input id='step' style='width:40px; margin-left:45px;' type='text' value='0.1' />  公里</div>"+"<div style='margin:8px 8px 5px 200px;'><input id='query' type='image' id='rangeSearchButton' src='images/btn_tips_search.gif'></div>"+"</div>"+"</div>"+"<div id='content'>"+"</div>");var self=this;function doQueryResult(data){if(!self._blockQueryCount){self._blockQueryCount=0}var displayNumStr="";if(data.displayStartNum&&data.displayEndNum){displayNumStr=data.displayStartNum+"k"+" - "+data.displayEndNum+"k"}var result=$("<div class='list'>"+"  <div class='list_num'>"+"<span style='font-size:18px; color:yellowGreen'>"+(++self._blockQueryCount)+"</span>"+"</div>"+"  <div class='list_text'>"+"  	<h2><span>"+data.lxbm+"</span></h2>"+"		<p>查询桩号:"+data.startNum+"k"+" - "+data.endNum+"k"+"</p>"+"		<p>显示桩号:"+displayNumStr+"</p>"+"		<p>路线桩号:"+data.roadStartNum+"k"+" - "+data.roadEndNum+"k"+"</p>"+"		<p>上下行:"+self._sxxList[data.sxx]+"</p>"+"		<p>步进:"+data.step+"公里"+"</p>"+"	 </div>"+"  <div style='position:relative;float:right;top:-115px;'><img style='opacity:0.7' src='images/fork.png' /></div>"+"</div>");result.data("param",{"lxbm":data.lxbm,"startNum":data.startNum,"endNum":data.endNum,"sxx":data.sxx,"step":data.step});result.find("img").hover(function(){$(this).css("opacity","1")},function(){$(this).css("opacity","0.7")});result.find("img").click(function(){result.animate({height:"0",width:"0"},"fast",function(){result.remove()});$(".result_search").mCustomScrollbar("update")});if(data.status=="ok"){result.find("h2").click(function(){var param=result.data("param");var lxbm=param.lxbm;var startNum=param.startNum;var endNum=param.endNum;var sxx=param.sxx;var url=mapwork.configs["segmentQuery_url"]+"?lxbm="+lxbm+"&sxx="+sxx+"&startNum="+startNum+"&endNum="+endNum+"&step=0.1";mapwork.utils.loadJsonData(url,function(json){self.show(json)})});self.show(data)}else{result.find("h2 span").html(data.message)}result.animate({height:"+130px",width:"+260px"},"normal");$(".result_search #content").prepend(result);$(".result_search").mCustomScrollbar("update")}queryDiv.find("#lxbm").bind("keyup",function(event){var str=$("#lxbm").val();if(str&&str.trim().length>0){if(!self._lxbmData){function doAutoSearchResult(data){self._lxbmData=data}var url=mapwork.configs["segmentQuery_url"]+"?list";mapwork.utils.loadJsonData(url,function(json){doAutoSearchResult(json)})}var lxbmArray=[];for(var i in self._lxbmData){var info=self._lxbmData[i];var lxbm=info.lxbm;var sxx=info.sxx;if(lxbm.indexOf(str)==0){var matchStr=str.bold().fontcolor("#0044BB").fontsize(2);var lxbmDis=matchStr+lxbm.substring(str.length);lxbmArray.push({"lxbm":lxbm,"sxx":sxx,"lxbmDis":lxbmDis})}}if(lxbmArray.length>0){var suggestDiv=$("#suggest");suggestDiv.empty();suggestDiv.slideDown();suggestDiv.append("<ul class='suggestList'>");for(var i=0;i<lxbmArray.length;i++){var info=lxbmArray[i];var lxbm=info.lxbm;var lxbmDis=info.lxbmDis;var sxx=info.sxx;var suggestItem=$("<li class='suggestItem' style='padding:2px 10px;cursor: pointer;'>"+"<input type='hidden' id='lxbmStr' value='"+lxbm+"'/><sapn id='lxbmDis'>"+lxbmDis+"</span>"+"</li>");suggestItem.data("sxx",sxx);suggestDiv.append(suggestItem)}suggestDiv.append("</ul>");$("#suggest .suggestItem").mousedown(function(){var itemStr=$(this).find("#lxbmStr").val();$("#lxbm").val(itemStr);var sxxSelects=$(this).data("sxx").split(",");$("#sxx").html("");for(var i=0;i<sxxSelects.length;i++){var selectValue=sxxSelects[i];var selectName=self._sxxList[selectValue];$("#sxx").append("<option value='"+selectValue+"'>"+selectName+"</option>")}suggestDiv.empty();$("#suggest").slideUp()});$("#suggest .suggestItem").hover(function(){$(this).css("background","#F3F7FD")},function(){$(this).css("background","white")})}}else{$("#suggest").empty();$("#suggest").slideUp()}});queryDiv.find(".show,#lxbm").click(function(){$(".show").hide();queryDiv.find("#lxbm").focus()});queryDiv.find("#lxbm").bind("blur",function(){$("#suggest").slideUp()});queryDiv.find("#query").click(function(){var lxbm=$("#queryBlock").find("#lxbm").val();var startNum=$("#queryBlock").find("#startNum").val();var endNum=$("#queryBlock").find("#endNum").val();var sxx=$("#queryBlock").find("#sxx").val();var step=$("#queryBlock").find("#step").val();if(lxbm){var url=mapwork.configs["segmentQuery_url"]+"?lxbm="+lxbm+"&sxx="+sxx+"&startNum="+startNum+"&endNum="+endNum+"&step="+step;mapwork.utils.loadJsonData(url,function(json){doQueryResult(json)})}});$(".result_search").html(queryDiv);$(".result_search").mCustomScrollbar({scrollButtons:{enable:true}})},show:function(json){for(var i in this._module._blockLineArray){this._module._blockLineArray[i].doRemove()}this._module._blockLineArray=[];if(this._module._breakPointArray){for(var i in this._module._breakPointArray){this._module._breakPointArray[i].doRemove()}}if(this._module._numLabelArray){for(var i in this._module._numLabelArray){this._module._numLabelArray[i].doRemove()}}var mapPopLayer=this._map.getLayer(mapwork.MapPopLayer.ID);var points=json.points;this._json={};this._json.startNumDis=json.displayStartNum+"k";this._json.endNumDis=json.displayEndNum+"k";this._module._breakPointArray=[];this._module._numLabelArray=[];if(json.displayStartPoint){var sDisplayStart=json.displayStartPoint.split(",");var startEpos=mapwork.SHPosMapping.convertShPosToEarthPos(sDisplayStart[0],sDisplayStart[1]);var startPoint=new mapwork.MapIcon("startBall","images/spop.png","images/spop.png",[4.5,15],100);this._module._breakPointArray.push(startPoint);startPoint.setPos(startEpos);mapPopLayer.addElement(startPoint);mapPopLayer.resetElement(startPoint);var startNumLabel=new mapwork.MapLabel("startNumLabel");startNumLabel.setPos(startEpos);startNumLabel.setName("起始桩号: "+this._json.startNumDis);startNumLabel._offsetPos=[-50,-35];this._module._numLabelArray.push(startNumLabel);this._vectorlayer.addElement(startNumLabel);this._vectorlayer.resetElement(startNumLabel)}if(json.displayEndPoint){var sDisplayEnd=json.displayEndPoint.split(",");var endEpos=mapwork.SHPosMapping.convertShPosToEarthPos(sDisplayEnd[0],sDisplayEnd[1]);var endPoint=new mapwork.MapIcon("endBall","images/spop.png","images/spop.png",[4.5,15],100);this._module._breakPointArray.push(endPoint);endPoint.setPos(endEpos);mapPopLayer.addElement(endPoint);mapPopLayer.resetElement(endPoint);var endNumLabel=new mapwork.MapLabel("endNumLabel");endNumLabel.setPos(endEpos);endNumLabel.setName("结束桩号: "+this._json.endNumDis);endNumLabel._offsetPos=[-50,-35];this._module._numLabelArray.push(endNumLabel);this._vectorlayer.addElement(endNumLabel);this._vectorlayer.resetElement(endNumLabel)}if(json.steps){var stepsArray=json.steps.split(",");var stepsEposArray=[];for(var i=0;i<stepsArray.length;i+=3){var x=parseInt(stepsArray[i]);var y=parseInt(stepsArray[i+1]);var ePos=mapwork.SHPosMapping.convertShPosToEarthPos(x,y);stepsEposArray.push(ePos);var number=parseFloat(stepsArray[i+2])+"k";var k=0;var point=new mapwork.MapIcon("boll"+k,"images/ball.png","images/ball.png",[5,5],100);this._module._breakPointArray.push(point);point.setPos(ePos);mapPopLayer.addElement(point);mapPopLayer.resetElement(point);var numLabel=new mapwork.MapLabel("numLabel"+k);this._module._numLabelArray.push(numLabel);numLabel.setPos(ePos);numLabel.setName(number);numLabel._offsetPos=[-25,-25];this._vectorlayer.addElement(numLabel);this._vectorlayer.resetElement(numLabel);k++}}var line=points.split("|");for(var i=0;i<line.length;i++){var ePosArray=[];var ss=line[i].split(",");for(var k=0;k<ss.length;k+=2){var x=parseInt(ss[k]);var y=parseInt(ss[k+1]);ePosArray.push(mapwork.SHPosMapping.convertShPosToEarthPos(x,y))}this.createBlockLine(ePosArray)}},showBlockSearchResultDiv:function(json,id){var mapPopLayer=this._map.getLayer(mapwork.MapPopLayer.ID);var focusPoint=json.focusPoint;focusPoint=focusPoint.split(",");var icon=new mapwork.MapIcon("focusPointIcon","images/block_roadevent.png","images/block_roadevent.pngH",[9,9],"");icon.setPos(mapwork.SHPosMapping.convertShPosToEarthPos(focusPoint[0],focusPoint[1]));mapPopLayer.addElement(icon);mapPopLayer.resetElement(icon);var name="交通直播";var rangeSearchHandler=this._map.getHandler(mapwork.RangeSearchHandler.ID);rangeSearchHandler._defaultRadius=2000;rangeSearchHandler.openRangeSearchControl(icon.getEarthPos());rangeSearchHandler.doSearch(name);var currentModule=rangeSearchHandler._map._currentModule;this._searchResult=currentModule._pageQueryResult;var div=$("#"+id);div.append("<div style='height:20px;line-height:20px;width:100px;text-align:center'>"+"搜索半斤:"+rangeSearchHandler._defaultRadius+"米"+"</div>");div.append("<div class='_list' style='width:100px; height:300px;  border:1px solid #e2e2e2; float: left;'></div>");div.append("<div class='_content' style='width:500px; height:300px;  margin-left: 105px;'></div>");if(this._searchResult){for(var i in this._searchResult.rows){var row=this._searchResult.rows[i];div.find("._list").append("<div class='_item' style='height:26px; line-height:26px; cursor:pointer;'>"+row.name+"</div>");$("._list > ._item:last").click(function(){$("._content").empty();$("._content").append("<iframe src='http://114.80.221.26/jsp/gis/jtskForLive.jsp?videoId="+(parseInt(row.pid)-1)+"' height='254' width='330' scrolling='no' name='dlzdInfN'"+" id='dlzdInf' frameborder='0' noresize='' marginheight='0' marginwidth='0'></iframe>")})}}},isNeedItemQuery:function(){if(!this._json.describe1){return true}}};if(EXTEND){mapwork.utils.inherits(Block,EXTEND)}})();(function(){mapwork.JTSK=JTSK;var EXTEND=mapwork.ModuleItem;JTSK.ID="JTSK";JTSK.setting={ID:JTSK.ID,pageUrl:"queryJTSK",listUrl:"queryAllJTSK",detailUrl:"queryJTSKById",newModuleItem:function(module,index){return new JTSK(module,index)}};function JTSK(module,index){if(EXTEND){EXTEND.apply(this,arguments)}}JTSK.prototype={setJsonData:function(json){var ePos;this._json=json;this._id=json.sxjId;if(this._index==undefined){this._name=this._json.name;this.setIcon("images/photo.png");this.setHoverIcon("images/photoH.png");this.setOffsetPos([8,8])}else{this._name=this._json.name;this.setZIndex(100-parseInt(this._index));this.setIcon("images/r0"+this._index+".png");this.setHoverIcon("images/b0"+this._index+".png");this.setDescribe("<p>摄像机编号: "+json.sxjId+"</p>"+"<p>类型: "+json.sxjType+"</p>");this.setOffsetPos([11,31])}if(json.posX&&json.posY){var x=parseInt(json.posX);var y=parseInt(json.posY);ePos=mapwork.SHPosMapping.convertShPosToEarthPos(x,y);this.setEarthPos(ePos)}},getTipTitle:function(){return this._json.name},getTipContent:function(){return"<p>"+"<img width='350' height='250' src='"+this._json.imageUrl+"' />"+"</p>"+"<img src='images/vedio_logo.gif' style='left:245px;top:260px;position:absolute;'>"},getDetailParam:function(){var queryParam={};queryParam["jtsk.sxjId"]=this._id;return queryParam},isNeedItemQuery:function(){if(!this._json.imageUrl){return true}}};if(EXTEND){mapwork.utils.inherits(JTSK,EXTEND)}})();(function(){mapwork.JTZB=JTZB;var EXTEND=mapwork.ModuleItem;JTZB.ID="JTZB";JTZB.setting={ID:JTZB.ID,pageUrl:"queryJTZB",listUrl:"queryAllJTZB",detailUrl:"queryJTZBById",newModuleItem:function(module,index){return new JTZB(module,index)}};function JTZB(module,index){if(EXTEND){EXTEND.apply(this,arguments)}}JTZB.prototype={setJsonData:function(json){this._json=json;this._id=json.id;if(this._index==undefined){this._name=this._json.name;this.setIcon("images/jtzb_2-18.png");this.setHoverIcon("images/jtzb_2-18.png");this.setOffsetPos([9,9])}else{this._name=this._json.name;this.setZIndex(100-parseInt(this._index));this.setIcon("images/r0"+this._index+".png");this.setHoverIcon("images/b0"+this._index+".png");this.setDescribe("<p>类型:道路视频</p>");this.setOffsetPos([11,31])}if(json.posX&&json.posY){var lat=parseFloat(json.posX);var lon=parseFloat(json.posY);this.setEarthPos(new mapwork.EarthPos(lat,lon))}},getTipTitle:function(){return this._json.name},getTipContent:function(){return"<iframe src='http://114.80.221.26/jsp/gis/jtskForLive.jsp?videoId="+(parseInt(this._id)-1)+"' height='254' width='330' scrolling='no' name='dlzdInfN'"+" id='dlzdInf' frameborder='0' noresize='' marginheight='0' marginwidth='0'></iframe>"},getDetailParam:function(){var queryParam={};queryParam["jtzb.id"]=this._id;return queryParam},isNeedItemQuery:function(){if(!this._id){return true}}};if(EXTEND){mapwork.utils.inherits(JTZB,EXTEND)}})();(function(){mapwork.TextBoard=TextBoard;var EXTEND=mapwork.ModuleItem;TextBoard.ID="TextBoard";TextBoard.setting={ID:TextBoard.ID,pageUrl:"queryTextBoard",listUrl:"queryAllTextBoard",detailUrl:"queryTextBoardById",newModuleItem:function(module,index){return new TextBoard(module,index)}};function TextBoard(module,index){if(EXTEND){EXTEND.apply(this,arguments)}}TextBoard.prototype={setJsonData:function(json){var ePos;this._json=json;this._id=json.xxbId;if(this._index==undefined){this._name=this._json.name;this.setIcon("images/block_roadevent.png");this.setHoverIcon("images/block_roadeventH.png");this.setOffsetPos([9,9])}else{this._name=this._json.name;this.setZIndex(100-parseInt(this._index));this.setIcon("images/r0"+this._index+".png");this.setHoverIcon("images/b0"+this._index+".png");this.setDescribe("");this.setOffsetPos([11,31])}if(json.posX&&json.posY){var x=parseInt(json.posX);var y=parseInt(json.posY);ePos=mapwork.SHPosMapping.convertShPosToEarthPos(x,y);this.setEarthPos(ePos)}},getTipTitle:function(){return this._json.name},getTipContent:function(){var board="a_board.gif";if(this._json.xxbType=="A板"){board="a_board.gif"}if(this._json.xxbType=="C板"){board="c_board.gif"}if(this._json.xxbType=="F板"){board="f_board.gif"}var testDis=this._json.fstrTextDis;var textArray="";if(testDis){textArray=testDis.split(":")}this._i=0;var $Text=null;var self=this;function changeText(){if(!$Text){$Text=$("#fstrText")}if($Text&&textArray[self._i]){$Text.html(textArray[self._i])}self._i++;if(self._i>=textArray.length){self._i=0}}if(mapwork.TextBoardInterval){clearInterval(mapwork.TextBoardInterval);mapwork.TextBoardInterval=null}mapwork.TextBoardInterval=setInterval(changeText,1000);return"<p style='text-align:center'>"+"<img src='http://114.80.221.26/resources/images/gis/"+board+"' />"+"<p>"+"<p style='text-align:center;position:relative;top:-70px'><b><font size='4' id='fstrText' color='green'>"+textArray[0]+"</font></b><p>"+"<p style='text-align:center'>"+this._json.fdtTimeDis+"<p>"},getDetailParam:function(){var queryParam={};queryParam["textBoard.xxbId"]=this._json.xxbId;return queryParam}};if(EXTEND){mapwork.utils.inherits(TextBoard,EXTEND)}})();(function(){var myTailDiv='<div style="padding: 0px 15px;"><form><span>经纬度:</span><input type="text" class="text_LatLon"/><input type="button" value="提交"/></form></div>';var $TailDiv=$(myTailDiv);mapwork.Travel=Travel;var EXTEND=mapwork.ModuleItem;Travel.ID="Travel";Travel.setting={ID:Travel.ID,pageUrl:"queryTravelPoi",listUrl:"queryAllTravelPoi",detailUrl:"queryTravelPoiById",newModuleItem:function(module,index){return new Travel(module,index)}};function Travel(module,index){if(EXTEND){EXTEND.apply(this,arguments)}this._tipOffsetTop=[9,30];this._isEditable=false}Travel.prototype={setJsonData:function(json){this._json=json;this._id=json.id;if(this._index==undefined){this._name=this._json.name;this.setIcon("images/point.png");this.setHoverIcon("images/point.png");this.setOffsetPos([4.5,4.5])}else{this._name=this._json.name;this.setZIndex(100-parseInt(this._index));this.setIcon("images/r0"+this._index+".png");this.setHoverIcon("images/b0"+this._index+".png");this.setDescribe("<p>省/市: "+(json.province?json.province:"")+"</p>"+"<p>市/区: "+(json.city?json.city:"")+"</p>");this.setOffsetPos([11,31])}if(json.lat&&json.lon){var x=parseInt(json.lat);var y=parseInt(json.lon);this.setEarthPos(new mapwork.EarthPos(x,y,true))}else{var lat=338101423+parseInt(Math.random()*6000000+1);var lon=1223580530+parseInt(Math.random()*6000000+1);this.setEarthPos(new mapwork.EarthPos(lat,lon,true))}},getTipTitle:function(){return this._json.name},getTipContent:function(){return"<p>"+"<img width='200px' height='200px' src='images/lyjd/"+this._id+"."+this._json.imageFormat+"' style='float:left; margin:0px 10px 0px 0px;'/>"+"</p>"+"<p style='text-indent: 2em;' >"+this._json.content+"</p>"},getTipTail:function(){if(this._isEditable){var self=this;$TailDiv.find(":button").get(0).onclick=function(){var param={};param["poi.id"]=self._json.id;param["poi.latLonString"]=$TailDiv.find(".text_LatLon").val();$.ajax({url:"updatePoi",dataType:"json",data:param,success:function(data){if(!data.m_detail){alert(data.msg)}else{alert(data.m_detail)}}})};return $TailDiv}else{return mapwork.ModuleItem.tailDiv}},getDetailParam:function(){var queryParam={};queryParam["poi.id"]=this._id;return queryParam},doBeforeOpenTip:function(){$TailDiv.find(".text_LatLon").val(this._ePos.getLatLonString())},createMapIcon:function(){var id=this._id;var icon=this._icon;var hoverIcon=this._hoverIcon;var iconOffset=this._offsetPos;var mapIcon=new mapwork.MapDraggableIcon(id,icon,hoverIcon,iconOffset,this._zIndex);return mapIcon},isNeedItemQuery:function(){if(!this._json.imageFormat){return true}}};if(EXTEND){mapwork.utils.inherits(Travel,EXTEND)}})();(function(){mapwork.YDP=YDP;var EXTEND=mapwork.ModuleItem;YDP.ID="YDP";YDP.setting={ID:YDP.ID,pageUrl:"queryYDP",listUrl:"queryAllYDP",detailUrl:"queryYDPById",newModuleItem:function(module,index){return new YDP(module,index)}};function YDP(module,index){if(EXTEND){EXTEND.apply(this,arguments)}}YDP.prototype={setJsonData:function(json){var ePos;this._json=json;this._id=json.xxbId;if(this._index==undefined){this._name=this._json.name;this.setIcon("images/xinxiban-18.png");this.setHoverIcon("images/xinxiban-18.png");this.setOffsetPos([9,9])}else{this._name=this._json.name;this.setZIndex(100-parseInt(this._index));this.setIcon("images/r0"+this._index+".png");this.setHoverIcon("images/b0"+this._index+".png");this.setDescribe("<p>诱导牌编号: "+json.xxbId+"</p>"+"<p>更新时间: "+json.fdtTimeDis+"</p>");this.setOffsetPos([11,31])}if(json.posX&&json.posY){var x=parseInt(json.posX);var y=parseInt(json.posY);ePos=mapwork.SHPosMapping.convertShPosToEarthPos(x,y);this.setEarthPos(ePos)}},getTipTitle:function(){return this._json.name},getTipContent:function(){return"<p>"+"<img width='350' height='300' src='"+this._json.picPath+"' />"+"</p>"+"<p style='text-align:center'>"+this._json.fdtTimeDis+"<p>"},getTipTail:function(){return null},getDetailParam:function(){var queryParam={};queryParam["ydp.xxbId"]=this._id;return queryParam},isNeedItemQuery:function(){if(!this._json.picPath){return true}}};if(EXTEND){mapwork.utils.inherits(YDP,EXTEND)}})();(function(){mapwork.WeatherLabel=WeatherLabel;var EXTEND=mapwork.MapIcon;var labelHtml='<div style="padding:0;margin:0;border:0;overflow:hidden;width:70px;height:48px;cursor:pointer;background: url(images/weatherbg.png) no-repeat;">'+'<div class="city" style="position: absolute;left:8px;top:6px;font-size:14px;color:#FFF;"></div>'+'<div class="temp" style="position: absolute;top:24px;text-align:center;width:100%;color:#e5edfe;font-size:11px;font-weight:bold;font-family:"></div>'+'<img  style="right:-10px; top:-10px; position:absolute;"src="images/transparent.png"> '+"</div>";function WeatherLabel(id,defaultIcon,hoverIcon,imageOffset,zIndex,moduleItem){if(EXTEND){EXTEND.apply(this,arguments)}this._moduleItem=moduleItem;this.init()}WeatherLabel.prototype={init:function(){this._htmlObj=document.createElement("div");this._htmlObj.style.position="absolute";this._$Element=$(this._htmlObj);this._$Element.append(labelHtml);this._$CityDiv=this._$Element.find(".city");this._$TempDiv=this._$Element.find(".temp");this._image=this._$Element.find("img").get(0);this.setIcon(this._defaultIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=this._zIndex}},setIcon:function(icon){if(typeof icon==="string"){this._image.src=icon}else{if(icon instanceof mapwork.SpriteImage){icon.wrapImage(this._image)}}},setLabel:function(city,temp){this._$CityDiv.html(city);this._$TempDiv.html(temp)},setHoverImage:function(){this.setIcon(this._hoverIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=101}this._$CityDiv.css("fontWeight","bold");this._$TempDiv.css("color","black")},setDefaultImage:function(){this.setIcon(this._defaultIcon);if(this._zIndex!=undefined){this._htmlObj.style["zIndex"]=this._zIndex}this._$CityDiv.css("fontWeight","normal");this._$TempDiv.css("color","white")},isDisplayAtZoom:function(zoom){if(this._moduleItem){return this._moduleItem.isDisplayAtZoom(zoom)}return true}};if(EXTEND){mapwork.utils.inherits(WeatherLabel,EXTEND)}})();(function(){mapwork.WeatherSideBar=WeatherSideBar;var EXTEND=mapwork.BaseSideBar;var html="<div class='weatherbox'>"+"<div id='btnReturn' class='wb_top'><a href='javascript:void(0);' title='返回' class='wb_back'>返回</a></div>"+"<div class='wb_title'>点击城市，了解天气状况</div>"+"<ul class='wb_date'>"+"<li id='d0' class='on'>"+" <p class='date'></p>"+" <p class='month'></p>"+"</li>"+"<li id='d1'>"+"	<p class='date'></p>"+" <p class='month'></p>"+"</li>"+"<li id='d2'>"+"	<p class='date'></p>"+" <p class='month'></p>"+"</li>"+"</ul>"+"<ul class='wb_details'>"+"</ul>";var $ConentDiv=$(html);var $Title=$ConentDiv.find(".wb_title");var $Li=$ConentDiv.find(".wb_date li");var $Content=$ConentDiv.find(".wb_details");function WeatherSideBar(module){if(EXTEND){EXTEND.apply(this,arguments)}}WeatherSideBar.prototype={init:function(){$("#indexbox").hide();this._$SideBarDiv=$("#sidebar");this._$SideBarDiv.empty();this._$SideBarDiv.append($ConentDiv);var self=this;$Li.each(function(index){$(this).click(function(){$(this).addClass("on");$(this).siblings().removeClass("on");$("ul.wb_details > li:eq("+index+")").addClass("on");$("ul.wb_details > li:eq("+index+")").siblings().removeClass("on");self._module.workAllListItem(function(moduleItem){moduleItem.changeDate(index)})})});this._$SideBarDiv.show();$("#btnReturn").click(function(){self.doReturn()})},getWeatherDate:function(dayIndex){var date=this._date;if(dayIndex>0){date=new Date();date.setTime(this._date.getTime()+86400000*dayIndex)}return(date.getMonth()+1)+"月:"+date.getDate()},onListQueryResult:function(jsonResult){var data=jsonResult;if(data){if(!data.m_detail){if($.isArray(data.rows)){var weather=data.rows[0];var year=weather.time.substring(0,4);var month=weather.time.substring(4,6);var day=weather.time.substring(6,8);this._date=new Date();this._date.setFullYear(year,parseInt(month-1),day);var self=this;$Li.each(function(index){var date=self.getWeatherDate(index);$(this).find(".date").html(date.split(":")[1]);$(this).find(".month").html(date.split(":")[0])})}}}},clean:function(){$Li.each(function(index){$(this).removeClass("on");$(this).find(".date").empty();$(this).find(".month").empty();$Title.html("点击城市，了解天气状况")});$Li.eq(0).addClass("on");$Content.empty();this._$SideBarDiv.empty()},doReturn:function(){$("div[name='indexDiv']").show();this._$SideBarDiv.hide();this._module.clean()}};if(EXTEND){mapwork.utils.inherits(WeatherSideBar,EXTEND)}})();(function(){mapwork.Weather=Weather;var EXTEND=mapwork.ModuleItem;Weather.ID="Weather";Weather.setting={ID:Weather.ID,pageUrl:null,listUrl:"queryWeatherReport",detailUrl:null,newSidebar:function(module){return new mapwork.WeatherSideBar(module)},newModuleItem:function(module,index){return new Weather(module,index)}};var Weather_xx={"00":"晴","01":"多云","02":"阴","03":"阵雨","04":"雷阵雨","05":"冰雹","06":"雨夹雪","07":"小雨","08":"中雨","09":"大雨","10":"暴雨","11":"大暴雨","12":"特大暴雨","13":"阵雪","14":"小雪","15":"中雪","16":"大雪","17":"暴雪","18":"雾","19":"冻雨","20":"沙尘暴","21":"小雨到中雨","22":"中雨到大雨","23":"大雨到暴雨","24":"暴雨到大暴雨","25":"大暴雨到特大暴雨","26":"小雪到中雪","27":"中雪到大雪","28":"大雪到暴雪","29":"浮尘","30":"扬沙","31":"强沙尘暴"};var Weather_fx={"0":"","1":"东北风","2":"东风","3":"东南风","4":"南风","5":"西南风","6":"西风","7":"西北风","8":"北风","9":"旋转风"};var Weather_fs={"0":"","1":"3-4级","2":"4-5级","3":"5-6级","4":"6-7级","5":"7-8级","6":"8-9级","7":"9-10级","8":"10-11级","9":"11-12级"};var DisplayZoomInfo={"58027_7":true,"58238_7":true,"58321_7":true,"58457_7":true,"58370_7":true,"58752_7":true,"58437_7":true,"58570_7":true,"58044_7":true,"58633_7":true,"58027_8":true,"58238_8":true,"58321_8":true,"58457_8":true,"58370_8":true,"58752_8":true,"58433_8":true,"58221_8":true,"58334_8":true,"58559_8":true,"58567_8":true,"58254_8":true,"58269_8":true,"58647_8":true,"58633_8":true,"58437_8":true,"58424_8":true,"58203_8":true,"58044_8":true,"58145_8":true,"58354_8":true,"58450_8":true,"58570_8":true,"_9":true,"_10":true,"_11":true,"_12":true,"_13":true,"_14":true,"_15":true,"_16":true};var weekday=["周日","周一","周二","周三","周四","周五","周六"];var dayName=["今天","明天","后天","","","",""];var iconWidth=32,iconHeight=32;function Weather(module,index){if(EXTEND){EXTEND.apply(this,arguments)}}Weather.prototype={setJsonData:function(json){this._json=json;this._id=json.id;var iconOffset=this.getDayIconOffset(0);this.setIcon(new mapwork.SpriteImage("images/weathers.png",iconWidth,iconHeight,iconOffset[0],iconOffset[1]));this.setZIndex(50);this.setOffsetPos([35,48]);if(json.posX&&json.posY){var x=parseInt(json.posX);var y=parseInt(json.posY);var ePos=mapwork.SHPosMapping.convertShPosToEarthPos(x,y);this.setEarthPos(ePos)}var year=this._json.time.substring(0,4);var month=this._json.time.substring(4,6);var day=this._json.time.substring(6,8);this._date=new Date();this._date.setFullYear(year,parseInt(month-1),day)},changeDate:function(dayIndex){var offset=this.getDayIconOffset(dayIndex);var weatherLabel=this.getMapIcon();this.getIcon().setOffset(offset[0],offset[1]);weatherLabel.setIcon(this.getIcon());weatherLabel.setLabel(this._json.pointName,this.getWeahterWD(dayIndex))},getDayIconOffset:function(index){var h,l;if(index==0){h=parseInt(this._json.XX1)%8;l=parseInt(parseInt(this._json.XX1)/8)}else{if(index==1){h=parseInt(this._json.XX2)%8;l=parseInt(parseInt(this._json.XX2)/8)}else{if(index==2){h=parseInt(this._json.XX3)%8;l=parseInt(parseInt(this._json.XX3)/8)}}}var offsetX=-h*iconWidth;var offsetY=-l*iconHeight;return[offsetX,offsetY]},getTipContent:function(){return""},getTipTitle:function(){return this._json.pointName},createMapIcon:function(){var id=this._id;var icon=this._icon;var hoverIcon=this._hoverIcon;var iconOffset=this._offsetPos;var weatherLabel=new mapwork.WeatherLabel(id,icon,hoverIcon,iconOffset,this._zIndex,this);weatherLabel.setLabel(this._json.pointName,this.getWeahterWD(0));return weatherLabel},doHover:function(){this.getMapIcon().setHoverImage()},deHover:function(){this.getMapIcon().setDefaultImage()},doFocus:function(){var self=this;$(".wb_details").fadeOut("fast",function(){$(".wb_details").empty();$(".wb_details").fadeIn("fast");$(".wb_details").append(self.getDisplayContent());$("ul.wb_details > li").each(function(index){$(this).click(function(){$(this).addClass("on");$(this).siblings().removeClass("on");$("ul.wb_date > li:eq("+index+")").addClass("on");$("ul.wb_date > li:eq("+index+")").siblings().removeClass("on");var listQueryResult=self._module._listQueryResult;for(var i in listQueryResult.rows){var item=listQueryResult.rows[i];if(item._moduleItem){item._moduleItem.changeDate(index)}}})})})},getDisplayContent:function(){return $(this.getSidebarContent())},getSidebarContent:function(){var html=this.getWeatherInfo(0)+this.getWeatherInfo(1)+this.getWeatherInfo(2);var wrap=$("<div>"+html+"</div>");$(".wb_title").html(this.getTipTitle()+"  "+"未来三天天气预报 ");$("ul.wb_date >li").each(function(index){if($(this).attr("class")){wrap.find("li:eq("+index+")").addClass("on");return false}});return wrap.html()},getWeatherInfo:function(dayIndex){var offset=this.getDayIconOffset(dayIndex);return"<li>"+"	<div class='date'>"+this.getWeatherDate(dayIndex)+"</div>"+"    <div class='weather'>"+"    	<p>"+this.getWeahterXX(dayIndex)+"</p>"+"     <p>"+this.getWeahterWD(dayIndex)+"</p>"+"     <p>"+this.getWeahterFX(dayIndex)+"</p>"+"    </div>"+"    <div class='wd_more'>"+"    <img src='images/transparent.png'  style='width:"+iconWidth+"px; height:"+iconHeight+"px;"+"       background:url("+this.getIcon()._imageUrl+")"+"       no-repeat "+offset[0]+"px "+offset[1]+"px'/>"+"    </div>"+"</li>"},getWeahterDay:function(dayIndex){var index=(this._date.getDay()+dayIndex)%7;var str=dayName[dayIndex]+" ("+weekday[index]+") ";return str},getWeatherDate:function(dayIndex){var date=this._date;if(dayIndex>0){date=new Date();date.setTime(this._date.getTime()+86400000*dayIndex)}return(date.getMonth()+1)+"/"+date.getDate()},getWeahterWD:function(dayIndex){var str;if(dayIndex==0){str=this._json.WD1+"℃~"+this._json.WD1_+"℃"}else{if(dayIndex==1){str=this._json.WD2+"℃~"+this._json.WD2_+"℃"}else{if(dayIndex==2){str=this._json.WD3+"℃~"+this._json.WD3_+"℃"}}}return str},getWeahterXX:function(dayIndex){var str;if(dayIndex==0){str=Weather_xx[this._json.XX1]}else{if(dayIndex==1){str=Weather_xx[this._json.XX2]}else{if(dayIndex==2){str=Weather_xx[this._json.XX3]}}}return str},getWeahterFX:function(dayIndex){var str;if(dayIndex==0){str=Weather_fx[this._json.FX1]+Weather_fs[this._json.FS1]}else{if(dayIndex==1){str=Weather_fx[this._json.FX2]+Weather_fs[this._json.FS2]}else{if(dayIndex==2){str=Weather_fx[this._json.FX3]+Weather_fs[this._json.FS3]}}}return str},isDisplayAtZoom:function(zoom){if(DisplayZoomInfo["_"+zoom]||DisplayZoomInfo[this._id+"_"+zoom]){return true}return false}};if(EXTEND){mapwork.utils.inherits(Weather,EXTEND)}})();(function(){mapwork.Search=Search;var EXTEND=mapwork.ModuleItem;Search.ID="Search";Search.setting={ID:Search.ID,pageUrl:null,listUrl:null,detailUrl:null,newModuleItem:function(module,index){return new Search(module,index)}};function Search(module,index){if(EXTEND){EXTEND.apply(this,arguments)}}Search.prototype={};if(EXTEND){mapwork.utils.inherits(Search,EXTEND)}})();(function(){mapwork.SearchModule=SearchModule;var EXTEND=mapwork.Module;function SearchModule(setting){if(EXTEND){EXTEND.apply(this,arguments)}this._searchType="all"}SearchModule.prototype={setSearchType:function(searchType){this._searchType=searchType},setSearchCenterEPos:function(searchEPos){this._searchEPos=searchEPos},setSearchRadius:function(searchRadius){this._searchRadius=searchRadius},doPageQuery:function(pageIndex,pageSize,name){if(name){this._searchName=name}this._sideBar.reset();this.doRemoveIconList();this.doHideTip();var p=pageIndex?(pageIndex-1):0;var param=this.getSearchParam(p);var url=mapwork.configs["searchLayer_url"];var self=this;mapwork.utils.loadJsonData(url,function(data){if(!data){return}self._isPageFitBounds=self._searchType=="all";if(data.total>0){self.onPageQueryResult(data)}else{}},param)},getSearchParam:function(pageIndex){var param={};param["name"]=this._searchName;param["type"]=this._searchType;param["page"]=pageIndex;if(this._searchType=="all"){}else{if(this._searchType=="bounds"){var ltGlobalPos=this._map._mapLocation.getWindowLeftTopGlobalPos();var rbGlobalPos=this._map._mapLocation.getWindowRightBottomGlobalPos();var ltEpos=ltGlobalPos.convert2EarthPos();var rbEpos=rbGlobalPos.convert2EarthPos();var b1=ltEpos.getILat();var b2=ltEpos.getILon();var b3=rbEpos.getILat();var b4=rbEpos.getILon();param["blat1"]=b1;param["blon1"]=b2;param["blat2"]=b3;param["blon2"]=b4}else{if(this._searchType=="range"){var centerEPos=this._searchEPos;if(!centerEPos){centerEPos=this._map._mapLocation.getMapCenterEarthPos()}param["rlat"]=centerEPos.getILat();param["rlon"]=centerEPos.getILon();param["rlen"]=this._searchRadius}}}return param},buildModuleItem:function(json,index){var moduleId=json.type;var module=this._map.getModule(moduleId);var moduleItem=module._setting.newModuleItem(module,index);moduleItem.setJsonData(json);moduleItem.setSidebar(this._sideBar);moduleItem._id=json.pid;moduleItem._name=json.name;moduleItem.setDescribe("");var tag=json.tag;if(tag){var pos=tag.indexOf("|");var typeName="";if(pos>0){typeName=tag.substring(0,pos)}else{typeName=tag}var describe="<p>类别: "+typeName+"</p>";if(json.describeHtml){describe+=json.describeHtml}moduleItem.setDescribe(describe)}moduleItem.setZIndex(100-parseInt(index));moduleItem.setOffsetPos([11,31]);if(json.pos){var ePos=new mapwork.EarthPos(json.pos.lat,json.pos.lon,true);moduleItem.setEarthPos(ePos)}moduleItem.setMap(this._map);return moduleItem},clean:function(){this._sideBar.clean();this.doRemoveIconList();this.doHideTip();var listLayer=this._map.getLayer("moduleListLayer");if(listLayer){listLayer.empty()}if(this._searchHandler){this._searchHandler.doClose();this._searchHandler.closePin()}},setSearchHandler:function(searchHandler){this._searchHandler=searchHandler}};if(EXTEND){mapwork.utils.inherits(SearchModule,EXTEND)}})();(function(){mapwork.CommonModuleItem=CommonModuleItem;var EXTEND=mapwork.ModuleItem;CommonModuleItem.ID="CommonModuleItem";CommonModuleItem.setting={ID:CommonModuleItem.ID,pageUrl:null,listUrl:null,detailUrl:null,newModuleItem:function(module,index){return new CommonModuleItem(module,index)}};function CommonModuleItem(module,index){if(EXTEND){EXTEND.apply(this,arguments)}}CommonModuleItem.prototype={setJsonData:function(json){var ePos;this._json=json;this.setZIndex(100-parseInt(this._index));this.setIcon("images/r0"+this._index+".png");this.setHoverIcon("images/b0"+this._index+".png");this.setOffsetPos([11,31])},getTipTitle:function(){return this._json.name},getTipContent:function(){return"<p>"+this._json.name+"</p>"},isNeedItemQuery:function(){return false}};if(EXTEND){mapwork.utils.inherits(CommonModuleItem,EXTEND)}})();(function(){mapwork.MapPage=MapPage;var EXTEND=mapwork.WebFrame;function MapPage(mapWrapDiv){if(EXTEND){EXTEND.apply(this,arguments)}this._mapWrapDiv=mapWrapDiv;this.initFrame();this.buildFrame()}MapPage.prototype={createMap:function(){this._map=new mapwork.Map(this._mapWrapDiv,{});this._map.addHandler(new mapwork.KeyHandler());this._map.addHandler(new mapwork.DragHandler());this._map.addHandler(new mapwork.WheelHandler());this._map.addHandler(new mapwork.MeasureHandler());this._map.addHandler(new mapwork.RouterHandler());this._map.addHandler(new mapwork.RangeSearchHandler());this._map.addControl(new mapwork.DetailZoomControl(false));this._map.addControl(new mapwork.MapScaleControl());this._map.addControl(new mapwork.MapChannelInfoControl());this._map.addControl(new mapwork.WheelRectControl());this._map.addControl(new mapwork.MenuControl());this._map.addControl(new mapwork.OverviewControl());this._map.addModule(new mapwork.Module(mapwork.Block.setting));this._map.addModule(new mapwork.Module(mapwork.JTSK.setting));this._map.addModule(new mapwork.Module(mapwork.JTZB.setting));this._map.addModule(new mapwork.Module(mapwork.TextBoard.setting));this._map.addModule(new mapwork.Module(mapwork.Travel.setting));this._map.addModule(new mapwork.Module(mapwork.YDP.setting));this._map.addModule(new mapwork.Module(mapwork.Weather.setting));this._map.addModule(new mapwork.SearchModule(mapwork.Search.setting));this._map.addModule(new mapwork.Module(mapwork.CommonModuleItem.setting))},buildFrame:function(){this.createMap()},onWindowResize:function(){var headHeight=document.getElementById("n").clientHeight;var cnHeight=document.getElementById("cn").clientHeight;var cc=document.getElementById("cc");var mainHeight=mapwork.utils.getClientSize().height-headHeight-cnHeight;cc.style.height=mainHeight+"px";this._map.resetSize();if(mapwork.resizeListener){mapwork.resizeListener()}this.sideBarResize()},sideBarResize:function(){if(this._map._currentModule){var sideBar=this._map._currentModule._sideBar;sideBar.resize()}},doMeasure:function(){var measureHandler=this._map.getHandler(mapwork.MeasureHandler.ID);if(measureHandler){measureHandler.beginMeasure()}},doVectorTest:function(){var vectorLayer=this._map.getLayer(mapwork.MapVectorLayer.ID);if(vectorLayer){vectorLayer.doTest()}},moveToDefaultPos:function(){var lat=mapwork.configs.defaultLat;var lon=mapwork.configs.defaultLon;var ePos=new mapwork.EarthPos(lat,lon);this._map.movedToMapCenter(ePos)},changeMapStyle:function(){if(mapwork.mapStyle==mapwork.mapStyle1){mapwork.mapStyle=mapwork.mapStyle2}else{mapwork.mapStyle=mapwork.mapStyle1}var tileLayer=this._map.getLayer(mapwork.TileLayer.ID);if(tileLayer){tileLayer.changeUrl()}},doSearch:function(name,isBoundsSearch){if(this._map._currentModule){this._map._currentModule.clean()}var searchModule=this._map.getModule(mapwork.Search.ID);if(isBoundsSearch){searchModule.setSearchType("bounds")}else{searchModule.setSearchType("all")}searchModule.init();searchModule.doPageQuery(null,null,name);this._map._currentModule=searchModule}};if(EXTEND){mapwork.utils.inherits(MapPage,EXTEND)}})();(function(){mapwork.MapPanel=MapPanel;var EXTEND=mapwork.WebPanel;function MapPanel(mapWrapDiv){if(EXTEND){EXTEND.apply(this,arguments)}this._mapWrapDiv=mapWrapDiv;this.createMap()}MapPanel.prototype={createMap:function(){this._map=new mapwork.Map(this._mapWrapDiv,{});this._map.addLayer(new mapwork.TileLayer("tileLayer"));this._map.addHandler(new mapwork.KeyHandler());this._map.addHandler(new mapwork.WheelHandler());this._map.addHandler(new mapwork.RangeSearchHandler());this._map.addControl(new mapwork.MapScaleControl());this._map.addModule(new mapwork.SearchModule(mapwork.Search.setting));this._map.addModule(new mapwork.Module(mapwork.JTZB.setting));this._map.resetSize()},getMap:function(){return this._map},showBlock:function(json,searchResult){var blockModule=new mapwork.Module();blockModule.setMap(this._map);var block=new mapwork.Block(blockModule);block.setMap(this._map);block.show(json);block.showBlockSearchResultDiv(json,searchResult)}};if(EXTEND){mapwork.utils.inherits(MapPanel,EXTEND)}})();